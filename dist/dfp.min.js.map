{"version":3,"file":"dfp.min.js","sources":["../src/utils/cookieUtils.js","../src/globalConfig.js","../src/utils/time.js","../src/utils/breakpoints.js","../src/objects/impressionsManager.js","../src/objects/user.js","../src/objects/conflictResolver.js","../src/objects/adSlot.js","../src/utils/arrays.js","../src/objects/adManager.js","../src/dfp.js","../src/index.js"],"sourcesContent":["/**\n * Htz-cookie-util\n * @module htzCookieUtil\n * @author Elia Grady elia.grady@haaretz.co.il\n * @license MIT\n */\n\n/**\n * Translates Key-Value string into a convenient map.\n * @param {string} string String in format of \"key<operator>value<separator>.....\"\n * @param {object} options object for overriding defaults:\n * options.separator is a String or regExp that separates between each key value pairs\n * (default is ';'). options.operator is a String or regExp that separates between each key\n * and value within a pair (default is '=').\n * @returns {object} a map object, with key-value mapping according to the passed configuration.\n */\nfunction stringToMap(string,\n  { separator = ';', operator = '=' } = {}) {\n  const map = {};\n  const itemsArr = string.split(separator);\n  //console.log(`called stringToMap with separator:`, separator, `therefore, itemsArr is now:`,itemsArr);\n  for (const key in itemsArr) {\n    if (itemsArr.hasOwnProperty(key)) {\n      const keyValue = itemsArr[key].split(operator);\n      if(keyValue.length == 2 ) { //Only operate on valid splits\n        map[keyValue[0]] = decodeURIComponent(keyValue[1]);\n      }\n    }\n  }\n  return map;\n}\nexport const ssoKey = window.location.hostname.indexOf('haaretz.com') > -1 ? 'engsso' : 'tmsso';\n\n// Translates Cookie string into a convenient map.\nexport default function getCookieAsMap() {\n  const map = stringToMap(document.cookie, { separator: /;\\s?/ });\n  if (typeof map['tmsso'] === 'string') {\n    map['tmsso'] = stringToMap(map['tmsso'], { separator: ':' });\n  }\n  if (typeof map['engsso'] === 'string') {\n    map['engsso'] = stringToMap(map['engsso'], { separator: ':' });\n  }\n  return map;\n}\n\n","/*global dfpBaseConf*/\nimport getCookieAsMap, { ssoKey } from './utils/cookieUtils';\n//globalConfig for DFP\nconst dfpConfig = Object.assign({\n  get referrer() {\n    return document.referrer ? document.referrer : \"\";\n  },\n  get isMobile() {\n    return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\n      .test(window.navigator.userAgent || \"\"));\n  },\n  /**\n   * Returns true iff the loaded page is the homepage (no inner path)\n   * @returns {boolean}\n   */\n  get isHomepage() {\n    return window.location.pathname === \"/\" || this.environment === 3; //'prod'\n  },\n  get department() {\n    return this.isHomepage ? '_homepage' : '_section';\n  },\n  /**\n   * returns the domain the page was loaded to. i.e: 'haaretz.co.il', 'haaretz.com'\n   * @returns {string} the domain name from the windows's location hostname property\n   */\n  get domain() {\n    const regexMatch = /([\\d|\\w]+)(\\.co\\.il|\\.com)(.*)?/.exec(window.location.hostname);\n    const result = regexMatch ? regexMatch[0] : window.location.hostname;\n    return result;\n  },\n  /**\n   * Returns an array of concatenated paths, separated by a dot.\n   * For example, for the URL:\n   * http://www.haaretz.co.il/news/world/america/us-election-2016/LIVE-1.2869045\n   * the path is '/news/world/america/us-election-2016/LIVE-1.2869045'.\n   * This function takes the directories ['news', 'world', 'america', 'us-election-2016']\n   * and converts it to the following format:\n   * ['.news', '.news.world', '.news.world.america', '.news.world.america.us-election-2016']\n   * This denotes the path configuration for the given adSlot\n   * @returns {Array.<T>} an array of path names\n   */\n  get path() {\n    let sectionArray = this.articleId ?\n      window.location.pathname.split('/').slice(1,-1) :\n      window.location.pathname.split('/').slice(1);\n    sectionArray = sectionArray.filter(path => path != 'wwwMobileSite' && path != 'whtzMobileSite');\n    return sectionArray\n      .map(section => `.${section}`)\n      .map((section, index, arr) => arr.slice(0,index+1)\n        .reduce((last, current) => last.concat(current)));\n  },\n  /**\n   * Returns the current environment targeting param, if such is defined.\n   * @returns {number} targeting param, 1 for local development, 2 for test servers and 3 for prod.\n   * May return undefined if no targeting is specified.\n   */\n  get environment() {\n    const env = {\n      dev: 1,\n      test: 2,\n      prod: 3,\n    };\n    return window.location.port === '8080' ? env.dev :\n      (window.location.hostname.indexOf('pre.haaretz.co.il') > -1\n      || window.location.hostname.indexOf('tmtest.themarker.com') > -1) ? env.test :\n        (window.location.pathname.indexOf('/cmlink/Haaretz.HomePage') > -1\n        || window.location.pathname.indexOf('/cmlink/TheMarker.HomePage') > -1) ? env.prod : undefined;\n  },\n  /**\n   * Returns the articleIf if on an article page, or null otherwise\n   * @returns {string} an articleId string from the pathname, or null if none is found\n   */\n  get articleId() {\n    const articleIdMatch = /\\d\\.\\d+/g.exec(window.location.pathname);\n    let articleId;\n    if(articleIdMatch) {\n      articleId = articleIdMatch.pop(); //Converts [\"1.23145\"] to \"1.23145\"\n    }\n    return articleId;\n  },\n  utm_ : {\n    get content() {\n      return this.getUrlParam('utm_content');\n    },\n    get source() {\n      return this.getUrlParam('utm_source');\n    },\n    get medium() {\n      return this.getUrlParam('utm_medium');\n    },\n    get campaign() {\n      return this.getUrlParam('utm_campaign');\n    },\n    getUrlParam(key) {\n      let results = RegExp(`(${key})(=)([^&\"]+)`).exec(window.location.search);\n      return results && results[3] ? results[3] : undefined;\n    },\n  },\n  get adBlockRemoved() {\n    let adBlockRemoved = false;\n    try {\n      adBlockRemoved = localStorage.getItem('adblock_removed') ? true : false;\n    }\n    catch (err) {}\n    return adBlockRemoved;\n  },\n  get wifiLocation() {\n    let wifiLocation = '';\n    let cookieMap = getCookieAsMap();\n    try {\n      if(cookieMap && cookieMap['_htzwif']) {\n        wifiLocation = (cookieMap['_htzwif'] == 'arcaffe')? 'ArCafe' : 'university';\n      }\n    }\n    catch (err) {\n\n    }\n    return wifiLocation;\n  },\n  get gStatCampaignNumber() {\n    let gstatCampaign;\n    try {\n      gstatCampaign = localStorage.getItem('GstatCampaign') ?\n        JSON.parse(localStorage.getItem('GstatCampaign')) : undefined;\n    }\n    catch (err) {\n      //In case of thrown 'SecurityError' or 'QuotaExceededError', the variable should be undefined\n      gstatCampaign = undefined;\n    }\n    return gstatCampaign ? gstatCampaign['CampaignNumber'] : undefined;\n  },\n  adSlotConfig: {\n    \"haaretz.co.il.example.slot\" : {\n      id: \"slotId\",\n      //path : \"/network/base/slotId/slotId_subsection\", Will be calculated from AdManager\n      responsive: true,\n      adSizeMapping: [['width1','height1'],...['widthN','heightN']],\n      priority: 'normal',\n      fluid: false,\n      responsiveAdSizeMapping : {\n        xxs: [['width1','height1'],...['widthN','heightN'],],\n        xs: [['width1','height1'],...['widthN','heightN'],],\n        s: [['width1','height1'],...['widthN','heightN'],],\n        m: [['width1','height1'],...['widthN','heightN'],],\n        l: [['width1','height1'],...['widthN','heightN'],],\n        xl: [['width1','height1'],...['widthN','heightN'],],\n        xxl: [['width1','height1'],...['widthN','heightN'],],\n      },\n      blacklistReferrers: \"comma, delimited, blacklisted, referrer, list\",\n      whitelistReferrers: \"comma, delimited, referrer, list\",\n    }\n  },\n  adManagerConfig : {\n    network: '9401',\n    adUnitBase: 'haaretz.co.il_Web',\n  },\n  breakpointsConfig : {\n    get breakpoints() {\n      const isType1 = true; //Override in VM from backend to control this toggle.\n      return isType1 ? this.breakpoints1 : this.breakpoints2;\n    },\n    // Type 1\n    breakpoints1 : {\n      xxs: 600,\n      xs: 761,\n      s: 993,\n      m: 1009,\n      l: 1291,\n      xl: 1600,\n      xxl: 1900,\n    },\n    // Type 2\n    breakpoints2 : {\n      xxs: 600,\n      xs: 1000,\n      s: 1150,\n      m: 1281,\n      l: 1600,\n      xl: 1920,\n      xxl: 1920,\n    }\n  },\n  userConfig: {\n    type : undefined,\n    age: undefined,\n    gender: undefined,\n  },\n  conflictManagementConfig: {\n    \"blocking.ad.unit.name\": [\n      {\n        onsize: \"1280x200,970x250,3x3\",\n        avoid: \"blocked.ad.unit.name\"\n      },\n      {\n        onsize: \"1280x200,970x250,3x3\",\n        avoid: \"blocked.ad.unit.name\"\n      }\n    ]\n  },\n  impressionManagerConfig: {\n    \"ad.unit.name\": {\n      target: 'all|section|homepage',\n      frequency: '$1/$2(day|hour)',\n      exposed: 0,\n      expires: (new Date).getTime()\n    }\n  },\n  sso: ssoKey,\n\n},window.dfpConfig);\n\nexport default dfpConfig;\n","/**\n * Helper function. Adds N hours to a given date object.\n * @param date the date to derive from\n * @param hours the amount of hours to add, in whole numbers\n * @returns {Date} the new date, derived from adding the given hours\n */\nexport function addHours(date, hours) {\n  if(!date) {\n    throw new SyntaxError(`addHours called without a required 'date' parameter!`);\n  }\n  if(!hours) {\n    throw new SyntaxError(`addHours called without a required 'hours' parameter!`);\n  }\n  else if(isNaN(parseInt(hours))) {\n    throw new TypeError(`addHours called with an invalid integer 'hours' parameter!`);\n  }\n  const result = new Date(date);\n  result.setHours(result.getHours() + parseInt(hours));\n  return result;\n}\n\n/**\n * Helper function. Adds N days to a given date object.\n * @param date the date to derive from\n * @param hours the amount of days to add, in whole numbers\n * @returns {Date} the new date, derived from adding the given days\n */\nexport function addDays(date, days) {\n  if(!date) {\n    throw new SyntaxError(`addDays called without a required 'date' parameter!`);\n  }\n  if(!days) {\n    throw new SyntaxError(`addDays called without a required 'hours' parameter!`);\n  }\n  else if(isNaN(parseInt(days))) {\n    throw new TypeError(`addDays called with an invalid integer 'hours' parameter!`);\n  }\n  const result = new Date(date);\n  result.setDate(result.getDate() + parseInt(days));\n  return result;\n}\n","import globalConfig from '../globalConfig';\n\nconst breakpoints = globalConfig.breakpointsConfig.breakpoints;\n\n/**\n * Returns a function, that, as long as it continues to be invoked, will not\n * be triggered. The function will be called after it stops being called for\n * N milliseconds. If `immediate` is passed, trigger the function on the\n * leading edge, instead of the trailing.\n * @param func the function to run\n * @param wait the timeout period to avoid running the function\n * @param immediate leading edge modifier\n * @returns {Function} the debounced function\n * //TODO translate to ES6 format - in progress...\n */\nexport function debounce(func, wait = 100, immediate) {\n  let timeout;\n  return function() {\n    const context = this, args = arguments;\n    const later = () => {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n}\n\n/**\n * Returns the current breakpoint that is closest to the window's width\n * @returns {number} the break that the current width represents\n */\nexport function getBreakpoint() {\n  let breakpoint = breakpoints.xxl;\n  let windowWidth = window.innerWidth;\n  if(windowWidth < breakpoints.xxl) { breakpoint = breakpoints.xl } else { return breakpoint }\n  if(windowWidth < breakpoints.xl) { breakpoint = breakpoints.l } else { return breakpoint }\n  if(windowWidth < breakpoints.l) { breakpoint = breakpoints.m } else { return breakpoint }\n  if(windowWidth < breakpoints.m) { breakpoint = breakpoints.s } else { return breakpoint }\n  if(windowWidth < breakpoints.s) { breakpoint = breakpoints.xs } else { return breakpoint }\n  if(windowWidth < breakpoints.xs) { breakpoint = breakpoints.xxs } else { return breakpoint }\n  return breakpoint\n}\n/**\n * Returns the current breakpoint that is closest to the window's width\n * @returns {string} the breakpoint label that the current width represents\n */\nexport function getBreakpointName(breakpoint) {\n  let resultBreakpoint = 'xxl';\n  let windowWidth = breakpoint || window.innerWidth;\n  if(windowWidth < breakpoints.xxl) { resultBreakpoint = 'xl' } else { return resultBreakpoint }\n  if(windowWidth < breakpoints.xl) { resultBreakpoint = 'l' } else { return resultBreakpoint }\n  if(windowWidth < breakpoints.l) { resultBreakpoint = 'm' } else { return resultBreakpoint }\n  if(windowWidth < breakpoints.m) { resultBreakpoint = 's' } else { return resultBreakpoint }\n  if(windowWidth < breakpoints.s) { resultBreakpoint = 'xs' } else { return resultBreakpoint }\n  if(windowWidth < breakpoints.xs) { resultBreakpoint = 'xxs' } else { return resultBreakpoint }\n  return resultBreakpoint\n}\n\n","import globalConfig from '../globalConfig';\nimport { addHours, addDays } from '../utils/time';\nimport { debounce }  from '../utils/breakpoints';\n\nexport const keys = {\n  impressions : 'impressions',\n  frequency : 'frequency',\n  /**\n   * [0] - full match\n   * [1] - impression count i.e: \"1\" | \"22\"\n   * [2] - impression expiry range quantifier  i.e: \"1\" | \"22\"\n   * [3] - impression expiry range unit i.e: \"day\" | \"hour\"\n   */\n  frequencyRegex: /(\\d+)\\/(\\d+)(day|hour)/,\n  expires : 'expires',\n  exposed : 'exposed',\n  target : 'target',\n  maxImpressions : 'maxImpressions',\n  hours : 'hour',\n  days : 'day',\n  adSlotId : 'id',\n};\n\n\n\n\nexport default class ImpressionsManager {\n\n  constructor(impressionManagerConfig) {\n    this.now = (new Date).getTime(); //this date is used for comparisons only\n    this.config = Object.assign({}, impressionManagerConfig);\n    this.impressions = this.retrieveImpressionsData();\n    this.initImpressionMap();\n  }\n\n  retrieveImpressionsData() {\n    let impressions = this.migrateImpressionsData();\n    //Merge migrated data with new data\n    //console.log('Migrated: ',impressions);\n    Object.keys(impressions).map((key, index) => {\n      impressions[key] = Object.assign({},impressions[key],this.config[key]);\n    });\n    //console.log('Merged: ',impressions);\n    //Filter out entries without frequency\n    for(const key in impressions) {\n      if(impressions.hasOwnProperty(key)) {\n        if(!impressions[key][keys.frequency]) {\n          //console.log(`Removing ${key} - since it does not have a frequency`,impressions[key]);\n          delete impressions[key];\n        }\n      }\n    }\n    //console.log('Filtered: ',impressions);\n    return impressions;\n  }\n\n  migrateImpressionsData() {\n    let impressions;\n    let impressionsData;\n    try {\n      impressionsData = window.localStorage.getItem(keys.impressions);\n    }\n    catch (err) {\n      //In case of thrown 'SecurityError' or 'QuotaExceededError', the variable should be undefined\n      impressionsData = undefined;\n    }\n    try {\n      impressions = JSON.parse(impressionsData);\n    }\n    catch (err) {\n      //Here is where old impression data is converted to new format\n      impressions = {};\n      const oldImpressionsArray = impressionsData.split(';').filter(e => e);\n\n      oldImpressionsArray.forEach((impression) => {\n        try {\n          const adUnitImpression = impression.split(' = ');\n          const name = adUnitImpression[0];\n          const data = adUnitImpression[1];\n          let tmp = name.split('.');\n          let target = tmp.pop();\n          if(target && target == 'hp') {\n            target = 'homepage';\n          }\n          const slotId = tmp.join('.');\n          const id = `${slotId}_${target}`;\n          const exposed = parseInt(data.split('/')[0]) || 0;\n          const expires = parseInt(data.split('/')[1]) || this.now;\n          impressions[id] = {};\n          impressions[id][keys.adSlotId] = slotId;\n          impressions[id][keys.target] = target;\n          impressions[id][keys.exposed] = exposed;\n          impressions[id][keys.expires] = expires;\n        }\n        catch (err) {\n          console.log(`Failed converting impression: ${impression}`,err);\n        }\n\n      });\n    }\n    return impressions || {};\n  }\n\n  /**\n   * Define the debounced version of the local storage save\n   */\n  saveImpressionsToLocalStorage() {\n    if(this.debouncedSave && typeof this.debouncedSave === 'function') {\n      this.debouncedSave();\n    }\n    else {\n      this.debouncedSave = debounce(this.saveImpressionsToLocalStorageImpl, 250, false);\n      this.debouncedSave();\n    }\n  }\n\n  /**\n   * Implementation of saving the impression map to localstorage\n   */\n  saveImpressionsToLocalStorageImpl() {\n    try {\n      localStorage.setItem(keys.impressions, JSON.stringify(this.impressions));\n    }\n    catch (err) {\n      //In case of thrown 'SecurityError' or 'QuotaExceededError', the operation should not break\n      console.log(`localStorage isn't available:`,err);\n    }\n  }\n\n  /**\n   * Initializes the impression map based on the retrieved impressions and the global\n   * configuration.\n   */\n  initImpressionMap() {\n    Object.keys(this.config).map((key, index) => {\n      const adSlotId = key;\n      let slot, shouldUpdateExpiryDate = false;\n      // Case I: Existing slot (update)\n      if(slot = this.impressions[adSlotId]) {\n        // Case I.I Existing slot, frequency has changed\n        if( this.config[adSlotId][keys.frequency] =!  slot[keys.frequency]) {\n          // Updating the frequency will trigger a new expiry date\n          shouldUpdateExpiryDate = true;\n          this.impressions[adSlotId][keys.frequency] = this.config[adSlotId][keys.frequency];\n        } // Case I.II Existing slot, old expiry date\n        else if(this.now >  slot[keys.expires]) {\n          // Old value that should trigger a new expiry date\n          shouldUpdateExpiryDate = true;\n        }\n      } // Case II: Non-existing slot (create new slot)\n      else {\n        this.initSlotFromConfig(adSlotId);\n      } //Finally, updates the expiry date (cases I.I and I.II)\n      if(shouldUpdateExpiryDate) {\n        this.updateExpiryDate(adSlotId);\n      }\n    });\n  }\n\n  /**\n   * Updates the expiry date of a slotName based on the configured slot frequency\n   * @param slotName the slotName to update.\n   */\n  updateExpiryDate(slotName) {\n    let now = new Date();\n    if(!(this.impressions[slotName] && this.impressions[slotName][keys.frequency])) {\n      throw new Error(`Unable to update expiry date for slot: ${slotName}\n      - this.impressions[slotName]:`,this.impressions[slotName]);\n    }\n    const frequencyMap = this.impressions[slotName][keys.frequency].match(keys.frequencyRegex);\n    now.setMilliseconds(0);\n    now.setSeconds(0);\n    now.setMinutes(0);\n    if(frequencyMap.indexOf(keys.days) > -1) {\n      now.setHours(0);\n    }\n    this.impressions[slotName][keys.expires] = (frequencyMap.indexOf(keys.days) > -1 ?\n      addDays(now, frequencyMap[2]) : addHours(now, frequencyMap[2])).getTime();\n\n    //Set max impressions:\n    this.impressions[slotName][keys.maxImpressions] = parseInt(frequencyMap[1]);\n    //Reset exposed\n    this.impressions[slotName][keys.exposed] = 0;\n  }\n\n\n\n  /**\n   * Initializes a non-existing slot from the passed global configuration for the slot\n   * @param slotName the name of the slot to create\n   */\n  initSlotFromConfig(slotName) {\n    let slot = this.impressions[slotName] || {};\n    slot[keys.frequency] = this.config[slotName][keys.frequency];\n    slot[keys.target] = this.config[slotName][keys.target];\n    slot[keys.exposed] = 0;\n    this.impressions[slotName] = slot;\n    this.updateExpiryDate(slotName);\n  }\n\n  /**\n   * Registers an impression for a given adSlot.\n   * @param adSlotId the adSlot id to register an impression for\n   * @returns {boolean} returns true iff the impression has been registered\n   */\n  registerImpression(adSlotId) {\n    if(adSlotId) {\n      const slot = this.impressions[adSlotId];\n      if(slot) {\n        const exposed = slot[keys.exposed];\n        if(isNaN(parseInt(exposed)) === false) {\n          this.impressions[adSlotId][keys.exposed] += 1;\n          try {\n            this.saveImpressionsToLocalStorage();\n          }\n          catch (err) {\n            console.log('Error saving ad impressions to localStorage!', err);\n          }\n          return true;\n        }\n      }\n\n    }\n    return false;\n  }\n\n  /**\n   * Checks whether an adSlot has reached it's allocated impressions count.\n   * @param adSlotId the adSlot to check\n   * @returns {boolean} true iff there is a quota for the adSlot, and it has been reached\n   */\n  reachedQuota(adSlotId) {\n    // An adSlotId is suffixed with _homepage | _section if it's targeting is different\n    // between the two. If there is no difference, an _all suffix can be used.\n    adSlotId = this.impressions[`${adSlotId}${globalConfig.department}`] ?\n      `${adSlotId}${globalConfig.department}`: `${adSlotId}_all`;\n\n    let slot = this.impressions[adSlotId];\n    let atQuota = false;\n    if(slot) {\n      let now = (new Date()).getTime();\n      //Second element of 2/4day matches '2'\n      const expires = this.impressions[adSlotId][keys.expires];\n      if(expires < now) {\n        this.updateExpiryDate(adSlotId);\n      }\n      else {\n        const maxImpressions = this.impressions[adSlotId][keys.maxImpressions];\n        //Not expired, did reach max impressions?\n        if(maxImpressions) {\n          atQuota = this.impressions[adSlotId][keys.exposed] >= maxImpressions;\n        }\n      }\n\n    }\n    return atQuota;\n  }\n\n\n  /**\n   * Clears the impression map from 'exposed' impressions\n   */\n  resetImpressions() {\n    const impressions = this.impressions;\n    for(const key in impressions) {\n      if(impressions.hasOwnProperty(key)) {\n        if(impressions[key][keys.exposed]) {\n          impressions[key][keys.exposed] = 0;\n        }\n      }\n    }\n    this.saveImpressionsToLocalStorage();\n  }\n}\n","import getCookieAsMap, { ssoKey } from '../utils/cookieUtils';\nimport ImpressionManager from './impressionsManager';\nimport globalConfig from '../globalConfig';\n\nexport const userTypes = {\n  payer: 'payer',\n  registered: 'registered',\n  anonymous: 'anonymous'\n};\n\nexport default class User {\n  constructor(config) {\n    this.config = Object.assign({}, config.userConfig);\n    let cookieMap = getCookieAsMap();\n    this.ssoKey = globalConfig.sso;\n    if(!cookieMap[this.ssoKey]) {\n      //console.log(`ssoKey flipped! - was ${this.ssoKey}`);\n      //Flips the ssoKey, since cookieMap.ssoKey cannot be used to retrieve data\n      this.ssoKey = this.ssoKey === 'tmsso' ? 'engsso' : 'tmsso';\n      //console.log(`ssoKey flipped! - now ${this.ssoKey}`);\n    }\n    this.type = this.getUserType(cookieMap);\n    this.impressionManager = new ImpressionManager(config.impressionManagerConfig);\n    this.age = this.getUserAge(cookieMap);\n    this.gender = this.getUserGender(cookieMap);\n  }\n\n  getUserType(cookieMap) {\n    if(cookieMap && cookieMap[this.ssoKey]) {\n      const payerProp = window.location.hostname.indexOf(\"haaretz.com\") > -1 ? 'HdcPusr' : 'HtzPusr';\n      return cookieMap[payerProp] ? userTypes.payer : userTypes.registered\n    }\n    else {\n      return userTypes.anonymous;\n    }\n  }\n\n  getUserAge(cookieMap) {\n    let age;\n    const usrae = cookieMap[this.ssoKey] && cookieMap[this.ssoKey].usrae;\n    if(usrae) {\n      age = parseInt(cookieMap[this.ssoKey].usrae);\n      age = age > 0 ? age : undefined;\n    }\n    return age;\n  }\n\n  getUserGender(cookieMap) {\n    let gender;\n    const urgdr = cookieMap[this.ssoKey] && cookieMap[this.ssoKey].urgdr;\n    if(urgdr) {\n      gender = parseInt(cookieMap[this.ssoKey].urgdr);\n      gender = gender === 2 || gender === 1 ? gender : undefined;\n    }\n    return gender;\n  }\n}\n","class ConflictResolver {\n  constructor(conflictManagementConfig) {\n    this.dependencyMap = this.initializeDependencyMap(conflictManagementConfig);\n    this.deferredSlots = new Set();\n  }\n  initializeDependencyMap(conflictManagementJson) {\n    let queue = new Map();\n    Object.keys(conflictManagementJson).map(function(key, value) {\n      let rules = conflictManagementJson[key];\n      if(rules) {\n        rules = rules.filter((item) => item.onsize && item.avoid);\n      }\n      queue.set(key, {\n        id: key,\n        rules: rules,\n        resolvedWith: null\n      })\n    });\n    return queue;\n  }\n\n  updateResolvedSlot(adSlotId,resolvedSize) {\n    if(!adSlotId) {\n      throw new Error(\"updateResolvedSlot must be called with an adSlotId!\");\n    }\n    if(!resolvedSize) {\n      throw new Error(\"updateResolvedSlot must be called with a resolved size!\");\n    }\n    if(this.dependencyMap.has(adSlotId)) {\n      this.dependencyMap.get(adSlotId).resolvedWith = resolvedSize;\n    }\n  }\n\n\n  isBlocked(adSlotId) {\n    if(!adSlotId) {\n      throw new Error(\"isBlocked must be called with an adSlotId!\");\n    }\n    let isBlocked = false;\n    for(const adSlotKey of this.dependencyMap.keys()) {\n      const adSlot = this.dependencyMap.get(adSlotKey);\n      for(const adSlotRule of adSlot.rules) {\n        //Found rule specific to our target\n        if(adSlotRule.avoid === adSlotId) {\n          const parentResolvedWith = adSlot.resolvedWith;\n          // Fail fast: parent is not resolved yet - unknown returned size.\n          if(!parentResolvedWith) {\n            isBlocked = true;\n            this.deferredSlots.add(adSlotId);\n          }\n          if(adSlotRule.onsize.split(',').find(size => {\n              size = size.split('x').map(numberStr => parseInt(numberStr));\n              return this.arraysEqual(size,parentResolvedWith)\n            })) {\n            //Block found\n            this.deferredSlots.add(adSlotId);\n            isBlocked = true;\n          }\n        }\n      }\n    }\n    return isBlocked;\n  }\n\n  isBlocking(adSlotId) {\n    if(!adSlotId) {\n      throw new Error(\"isBlocking must be called with an adSlotId!\");\n    }\n    let isBlocking = false;\n    for(const adSlotKey of this.dependencyMap.keys()) {\n      if(adSlotKey === adSlotId) {\n        isBlocking = true;\n      }\n    }\n    return isBlocking;\n  }\n\n  getBlockedSlotsIds(adSlotId) {\n    if(this.dependencyMap.has(adSlotId)) {\n      return Array.from(this.dependencyMap.get(adSlotId).rules.map(adSlot => adSlot.avoid));\n    }\n  }\n\n  arraysEqual(a, b) {\n    if (a === b) return true;\n    if (a == null || b == null) return false;\n    if (a.length != b.length) return false;\n    for (let i = 0; i < a.length; ++i) {\n      if (a[i] !== b[i]) return false;\n    }\n    return true;\n  }\n}\nConflictResolver.EMPTY_SIZE = []; //TODO : add this to the testing scenarios\nexport default ConflictResolver;\n","import { adTargets, adTypes } from '../objects/adManager';\nimport globalConfig from '../globalConfig';\nimport dfpInstance from '../index';\nexport default class adSlot {\n\n  constructor(adSlotConfig) {\n    this.config = Object.assign({}, adSlotConfig);\n\n    // Part I : Markup configuration - passed from AdManager\n    this.id = this.config.id;\n    if(!this.config.id) {\n      throw new Error(\"an adSlot requires an id!\")\n    }\n    this.target = this.config.target;\n    this.type = this.config.type;\n    this.responsive = this.config.responsive;\n    this.fluid = this.config.fluid;\n    this.user = this.config.user;\n    this.adManager = this.config.adManager;\n    this.htmlElement = this.config.htmlElement;\n    this.priority = this.config.priority;\n    this.deferredSlot = this.config.deferredSlot;\n\n    // Part II : Global, general ad configuration - passed from AdManager\n    this.department = this.config.department;\n    this.network = this.config.network;\n    this.adUnitBase = this.config.adUnitBase;\n\n    // Part III : ad specific configuration - passed from globalConfig.adSlotConfig\n    this.adSizeMapping = this.config.adSizeMapping;\n    this.responsiveAdSizeMapping = this.config.responsiveAdSizeMapping;\n    this.blacklistReferrers = this.config.blacklistReferrers ?\n      this.config.blacklistReferrers.split(',') : [];\n    this.whitelistReferrers = this.config.whitelistReferrers ?\n      this.config.whitelistReferrers.split(',') : [];\n\n\n    // Part IV : Runtime configuration - calculated data - only present in runtime\n    this.lastResolvedSize = undefined; // Initialized in 'slotRenderEnded' callback\n    this.lastResolvedWithBreakpoint = undefined; // Initialized in 'slotRenderEnded' callback\n    this.slot  = undefined; // Holds a googletag.Slot object\n    // [https://developers.google.com/doubleclick-gpt/reference#googletag.Slot]\n    try {\n      if(!this.deferredSlot) {\n        this.slot = this.defineSlot();\n      }\n    }\n    catch (err) {\n      console.log(err);\n    }\n  }\n\n  /**\n   * Checks whether this adSlot is an 'Out-of-page' slot or not.\n   * An Out-of-page slot is a slot that is not embedded in the page 'normally'.\n   * @returns {boolean} true iff this adSlot is one of the predefined 'out-of-page' slots.\n   */\n  isOutOfPage() {\n    if(typeof this.type != 'string') {\n      throw new Error(\"An adSlot cannot by typeless!\",this);\n    }\n    if(this.isMobile() == true) {\n      return false;\n    }\n    switch(this.type) {\n      case adTypes.maavaron: return true;\n      case adTypes.popunder: return true;\n      case adTypes.talkback: return false;\n      case adTypes.regular: return false;\n      default: return false;\n    }\n  }\n\n  /**\n   * Checks whether this adSlot is a 'maavaron' slot or not.\n   * An Out-of-page slot is a slot that is not embedded in the page 'normally'.\n   * @returns {boolean} true iff this adSlot is one of the predefined 'out-of-page' slots.\n   */\n  isMaavaron() {\n    if(typeof this.type != 'string') {\n      throw new Error(\"An adSlot cannot by typeless!\",this);\n    }\n    if(this.isMobile() == true) {\n      return false;\n    }\n    switch(this.type) {\n      case adTypes.maavaron: return true;\n      default: return false;\n    }\n  }\n\n  isMobile() {\n    return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\n      .test(window.navigator.userAgent || \"\"));\n  }\n  /**\n   * Checks whether or not this adSlot has a non-empty whitelist, and if so, that the current\n   * referrer appears in the whitelist.\n   * Should return false iff there is a whitelist for the current adSlot, but the referrer is not\n   * mentioned in the whitelist.\n   * @returns {boolean} true iff the ad can be displayed.\n   */\n  isWhitelisted() {\n    let whitelisted = false;\n    if (this.whitelistReferrers.length !== 0) {\n      for (const referrer of this.whitelistReferrers) {\n        if (globalConfig.referrer.indexOf(referrer) > -1) {\n          whitelisted = true;\n          break;\n        }\n      }\n    }\n    else {\n      whitelisted = true;\n    }\n    return whitelisted;\n  }\n\n  /**\n   * Checks whether or not this adSlot has a non-empty blacklist, and if so, that the current\n   * referrer does not appear in the blacklist.\n   * Should return true iff there is a blacklist for the current adSlot, and the referrer is\n   * mentioned in the blacklist - to indicate that the adSlot is 'blocked'.\n   * @returns {boolean} true iff the ad cannot be displayed.\n   */\n  isBlacklisted() {\n    let blacklisted = false;\n    if (this.blacklistReferrers.length !== 0) {\n      for (const referrer of this.blacklistReferrers) {\n        if (globalConfig.referrer.indexOf(referrer) > -1) {\n          blacklisted = true;\n          break;\n        }\n      }\n    }\n    return blacklisted;\n  }\n\n\n  /**\n   * Shows the current adSlot.\n   * It assumes a markup is available for this slot (any tag with an id attribute = this.id)\n   */\n  show() {\n    if(!this.shown === true) {\n      this.shown = true; //Ensure show will be called once per adSlot\n      googletag.cmd.push(() =>  {\n        if(this.deferredSlot) {\n          this.slot = this.defineSlot();\n        }\n        //console.log('calling show for slot',this.id,' called @',window.performance.now());\n        document.getElementById(this.id).classList.remove('h-hidden');\n        googletag.display(this.id);\n      })\n    }\n  }\n\n  /**\n   * Shows the current adSlot.\n   * It assumes a markup is available for this slot (any tag with an id attribute = this.id)\n   */\n  hide() {\n    googletag.cmd.push(() =>  {\n      document.getElementById(this.id).classList.add('h-hidden');\n    })\n  }\n\n  /**\n   * Initializes page-level slot definition for the current slot\n   */\n  defineSlot() {\n    if(this.isMaavaron()) {\n      const maavaronSlot = this.defineMaavaron();\n      if(this.adManager.shouldSendRequestToDfp(this)) {\n        if(!this.shown) {\n          this.shown = true; //Ensure show will be called once\n          maavaronSlot.display();\n        }\n      }\n      return maavaronSlot;\n    }\n    const googletag = window.googletag;\n    const pubads = googletag.pubads();\n    let args = [];\n    let defineFn = this.isOutOfPage() ? googletag.defineOutOfPageSlot : googletag.defineSlot;\n    //3 or 2 params according to the function that we want to activate.\n    args.push(this.getPath());\n    if(this.isOutOfPage() === false) {\n      if(this.fluid) {\n        args.push('fluid');\n      }\n      else {\n        args.push(this.adSizeMapping);\n      }\n    }\n    args.push(this.id);\n    let slot = defineFn.apply(defineFn, args);\n    if(slot) {\n      // Responsive size Mapping\n      if(this.responsive) {\n        let responsiveSlotSizeMapping = googletag.sizeMapping();\n        const breakpoints = globalConfig.breakpointsConfig.breakpoints;\n        const keys = Object.keys(this.responsiveAdSizeMapping);\n        for(const key of keys) { //['xxs','xs',...]\n          responsiveSlotSizeMapping.addSize(\n            [breakpoints[key],100],//100 is a default height, since it is height agnostic\n            this.responsiveAdSizeMapping[key]);\n        }\n        responsiveSlotSizeMapping = responsiveSlotSizeMapping.build();\n        slot = slot.defineSizeMapping(responsiveSlotSizeMapping);\n      }\n      slot = slot.addService(pubads);\n      if(this.isOutOfPage() === false) {\n        slot.setCollapseEmptyDiv(true);\n      }\n    }\n    return slot;\n  }\n\n  /**\n   * Returns the current path calculated for the adSlot\n   * @returns {*} a formatted string that represent the path for the slot definition\n   */\n  getPath() {\n    let path = globalConfig.path || [];\n    path = path.filter(path => path != '.');\n    path = path.map(section => `${this.id}${this.department}${section}`).join('/');\n    //If a path exist, it will be preceded with a forward slash\n    path = path && this.config.department !== '_homepage' ? `/${path}` : '';\n    const calculatedPath = `/${this.config.network}/${this.config.adUnitBase}/${this.id}/${this.id}${this.department}${path}`;\n    return calculatedPath.toLowerCase();\n  }\n\n  slotRendered(event) {\n    const id = event.slot.getAdUnitPath().split('/')[3]; // Convention: [0]/[1]network/[2]base/[3]id\n    const isEmpty = event.isEmpty; // Did the ad return as empty?\n    const resolvedSize = event.size; // What 'creative' size did the ad return with?\n    // Empty or onload callback should be called next?\n\n  }\n\n  /**\n   * Refresh this adSlot\n   */\n  refresh() {\n    googletag.cmd.push(() => {\n      googletag.pubads().refresh([this.slot]);\n    });\n  }\n\n  /**\n   * Shows 'Maavaron' type adSlot using Passback definition\n   */\n  defineMaavaron() {\n    if(!document.referrer.match('loc.haaretz')) {\n      const adUnitMaavaronPath = this.getPath();\n      const adUnitMaavaronSize = [\n        [2, 1]\n      ];\n      const slot = googletag.pubads().definePassback(adUnitMaavaronPath, adUnitMaavaronSize)\n        .setTargeting('UserType', [this.user.type])\n        .setTargeting('age', [this.user.age])\n        .setTargeting('urgdr', [this.user.gender])\n        .setTargeting('articleId', [globalConfig.articleId])\n        .setTargeting('stg', [globalConfig.environment]);\n      return slot;\n    }\n  }\n  /*\n   These functions were on the adUnitDFP prototype:\n   getNumOfImpressions: ()\n   getPeriodImpression: ()\n   hasMoreImpressions: ()\n   hasValidReferrer: ()\n   hide: ()\n   isMaavaron: ()\n   maxImpressions: ()\n   maxImpressionsPeriod: ()\n   nextExpiresDate: ()\n   onEmptyCallBack: ()\n   onLoaded: ()\n   refresh: ()\n   setNumOfImpressions: ()\n   show: ()\n   updateNumOfImpressions: ()\n   */\n}\n","/**\n * Checks whether two arrays are equal\n * @param a the first array to check\n * @param b the second array to check\n * @returns {boolean} true iff both a and b are arrays, with equal values\n */\nexport function arraysEqual(a, b) {\n  if (!a || !b) return false;\n  if (!Array.isArray(a) || !Array.isArray(b)) return false;\n  if (a === b) return true;\n  if (a.length != b.length) return false;\n  for (let i = 0; i < a.length; ++i) {\n    if (a[i] !== b[i]) return false;\n  }\n  return true;\n}\n","/*global googletag*/\nimport User from '../objects/user';\nimport ConflictResolver from '../objects/conflictResolver';\nimport AdSlot from '../objects/adSlot';\nimport { getBreakpoint, getBreakpointName } from '../utils/breakpoints';\nimport { arraysEqual } from '../utils/arrays';\n\n// There are a total of 7 adTargets:\n// \"all\",\"nonPaying\",\"anonymous\",\"registered\",\"paying\",\"digitalOnly\" and \"digitalAndPrint\"\nexport const adPriorities = {\n  high: 'high',\n  normal: 'normal',\n  low: 'low',\n};\n\nexport const adTargets = {\n  all: 'all',\n  nonPaying: 'nonPaying',\n  anonymous: 'anonymous',\n  registered: 'registered',\n  paying: 'paying',\n  digitalOnly: 'digitalOnly',\n  digitalAndPrint: 'digitalAndPrint',\n};\n\n// There are a total of 3 userTypes: \"anonymous\", \"registered\" and \"payer\"\nexport const userTypes = {\n  anonymous: 'anonymous',\n  registered: 'registered',\n  payer: 'payer',\n};\n\nexport const adTypes = {\n  maavaron: '.maavaron',\n  popunder: '.popunder',\n  talkback: '.talkback',\n  regular: '',\n};\n\n\nexport default class AdManager {\n\n  constructor(config) {\n    this.config = Object.assign({}, config);\n    this.user = new User(config);\n    this.conflictResolver = new ConflictResolver(config.conflictManagementConfig);\n    /**\n     * Avoid race conditions by making sure to respect the usual timing of GPT.\n     * This DFP implementation uses Enable-Define-Display:\n     * Define page-level settings\n     * enableServices()\n     * Define slots\n     * Display slots\n     */\n    try {\n      googletag.cmd.push(() => {\n        this.initGoogleTargetingParams(); //  Define page-level settings\n        this.initGoogleGlobalSettings();  //  enableServices()\n        this.initSlotRenderedCallback();  //  Define callbacks\n      });\n      // Holds adSlot objects as soon as possible.\n      googletag.cmd.push(() => {\n        this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.high);\n      });\n      // Once DOM ready, add more adSlots.\n      document.addEventListener('DOMContentLoaded', () => {\n        googletag.cmd.push(() => {\n          this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.high);\n          googletag.cmd.push(() => {\n            this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.normal);\n          });\n        });\n      });\n      // Once window was loaded, add the rest of the adSlots.\n      window.addEventListener('load', () => {\n        googletag.cmd.push(() => {\n          this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.low);\n        });\n      });\n    }\n    catch (err) {\n      console.log(err);\n    }\n  }\n\n  /**\n   * Shows all of the adSlots that can be displayed.\n   */\n  showAllSlots() {\n    for(const adSlotKey of this.adSlots.keys()) {\n      const adSlot = this.adSlots.get(adSlotKey);\n      if(adSlot.type !== adTypes.talkback && this.shouldSendRequestToDfp(adSlot)) {\n        adSlot.show();\n      }\n    }\n  }\n\n  /**\n   * Gets all adSlots that has a certain priority\n   */\n  getAdSlotsByPriority(priority) {\n    function priorityFilter(adSlot) {\n      return adSlot.priority === priority;\n    }\n    return Array.from(this.adSlots.values()).filter(priorityFilter);\n  }\n\n  showAllDeferredSlots() {\n    for(const deferredSlotId of this.conflictResolver.deferredSlots) {\n      if(this.adSlots.has(deferredSlotId)) {\n        if(!this.conflictResolver.isBlocked(deferredSlotId)) {\n          const deferredAdSlot = this.adSlots.get(deferredSlotId);\n          if(this.shouldSendRequestToDfp(deferredAdSlot)) {\n            deferredAdSlot.show();\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * Refreshes all responsive adSlots\n   */\n  refreshAllSlots() {\n    const currentBreakpoint = getBreakpoint();\n    for(const adSlotKey of this.adSlots.keys()) {\n      const adSlot = this.adSlots.get(adSlotKey);\n      if(adSlot.responsive) {\n        if(adSlot.lastResolvedWithBreakpoint != currentBreakpoint && this.shouldSendRequestToDfp(adSlot)) {\n          //console.log(`calling refresh for adSlot: ${adSlot.id}`);\n          adSlot.refresh();\n        } else {\n          adSlot.hide();\n        }\n      }\n    }\n  }\n\n  /**\n   * Initializes adSlots based on the currently found slot markup (HTML page specific),\n   * and the predefined configuration for the slots.\n   * @param adSlotConfig\n   * @returns {Map}\n   */\n  initAdSlots(adSlotConfig, filteredPriority) {\n    let adSlots = new Map(this.adSlots);\n    let adSlotPlaceholders = Array.from(document.getElementsByClassName('js-dfp-ad'));\n    adSlotPlaceholders = adSlotPlaceholders.filter(node => node.id); //only nodes with an id\n    const adSlotNodeSet = new Set();\n    adSlotPlaceholders = Array.prototype.filter.call(adSlotPlaceholders, node => {\n      if(adSlotNodeSet.has(node.id) === false) { //first occurrence of Node\n        adSlotNodeSet.add(node.id);\n        return true;\n      }\n      return false;\n    });\n    //adSlotPlaceholders = adSlotPlaceholders.sort((a,b) => a.offsetTop - b.offsetTop);\n    adSlotPlaceholders.forEach(adSlot => {\n      const adSlotPriority = adSlotConfig[adSlot.id] ? adSlotConfig[adSlot.id].priority || adPriorities.normal : undefined;\n      if(adSlotConfig[adSlot.id] && adSlots.has(adSlot.id) === false && adSlotPriority === filteredPriority) {\n        //the markup has a matching configuration from adSlotConfig AND was not already defined\n        try {\n          // adSlotConfig is built from globalConfig, but can be overridden by markup\n          const computedAdSlotConfig = Object.assign({},adSlotConfig[adSlot.id],{\n            id: adSlot.id,\n            target: adSlot.attributes['data-audtarget'] ? adSlot.attributes['data-audtarget'].value : adTargets.all,\n            type: this.getAdType(adSlot.id),\n            responsive: adSlotConfig[adSlot.id].responsive,\n            fluid: adSlotConfig[adSlot.id].fluid || false,\n            user: this.user,\n            adManager: this,\n            htmlElement: adSlot,\n            department: this.config.department,\n            network: this.config.adManagerConfig.network,\n            adUnitBase: this.config.adManagerConfig.adUnitBase,\n            deferredSlot: this.conflictResolver.isBlocked(adSlot.id),\n            priority: adSlotPriority,\n          });\n          const adSlotInstance = new AdSlot(computedAdSlotConfig);\n          adSlots.set(adSlot.id, adSlotInstance);\n          if(adSlotInstance.type !== adTypes.talkback && adSlotInstance.priority === adPriorities.high && this.shouldSendRequestToDfp(adSlotInstance)) {\n            //console.log('calling show for high priority slot', adSlotInstance.id, ' called @', window.performance.now());\n            adSlotInstance.show();\n          }\n        }\n        catch (err) {\n          console.log(err);\n        }\n      }\n    });\n    return adSlots;\n  }\n\n  isPriority(adSlotId) {\n    return (typeof adSlotId === 'string' && (adSlotId.indexOf('plazma') > 0 || adSlotId.indexOf('maavaron') > 0 || adSlotId.indexOf('popunder') > 0 ));\n  }\n\n  /**\n   * Returns the adType based on the adSlot name.\n   * @param adSlotId the adSlot's identifier.\n   * @returns {*} enumerated export 'adTypes'\n   */\n  getAdType(adSlotId) {\n    if(!adSlotId) {\n      throw new Error(`Missing argument: a call to getAdType must have an adSlotId`,this);\n    }\n    if(adSlotId.indexOf(adTypes.maavaron) > -1) return adTypes.maavaron;\n    if(adSlotId.indexOf(adTypes.popunder) > -1) return adTypes.popunder;\n    if(adSlotId.indexOf(adTypes.talkback) > -1) return adTypes.talkback;\n    return adTypes.regular;\n  }\n\n  /**\n   * @param {object} adSlot the AdSlot\n   * @returns {boolean|*}\n   */\n  shouldSendRequestToDfp(adSlot) {\n    // TODO: go over each one of the following and mark as checked once implemented\n    // Conflict management check\n    return this.conflictResolver.isBlocked(adSlot.id) === false &&\n        // Valid Referrer check\n      adSlot.isWhitelisted() &&\n        // Not in referrer Blacklist\n      adSlot.isBlacklisted() === false &&\n      this.shouldDisplayAdAfterAdBlockRemoval(adSlot) &&\n        // Responsive: breakpoint contains ad?\n      this.doesBreakpointContainAd(adSlot) &&\n        // Targeting check (userType vs. slotTargeting)\n      this.doesUserTypeMatchBannerTargeting(adSlot) &&\n        // Impressions Manager check (limits number of impressions per slot)\n      this.user.impressionManager.reachedQuota(adSlot.id) === false;\n  }\n\n  shouldDisplayAdAfterAdBlockRemoval(adSlot) {\n    return !(this.config.adBlockRemoved === true && (adSlot.type === adTypes.maavaron || adSlot.type === adTypes.popunder));\n  }\n\n  /**\n   * Check whether or not an ad slot should appear for the current user type\n   * @param adSlotOrTarget the adSlot to check or the target as a sting\n   * @returns {boolean} true iff the slot should appear for the user type\n   */\n  doesUserTypeMatchBannerTargeting(adSlotOrTarget) {\n\n    const userType = this.user.type;\n    const adTarget = typeof adSlotOrTarget === 'string' ? adSlotOrTarget : adSlotOrTarget.target;\n\n    switch (adTarget) {\n      case adTargets.all : return true;\n      case adTargets.nonPaying : return userType === userTypes.anonymous || userType === userTypes.registered;\n      case adTargets.anonymous : return userType === userTypes.anonymous;\n      case adTargets.registered : return userType === userTypes.registered;\n      case adTargets.paying : return userType === userTypes.payer;\n      case adTargets.digitalOnly : return userType === userTypes.payer;\n      case adTargets.digitalAndPrint : return userType === userTypes.payer;\n      default: return false;\n    }\n  }\n\n  /**\n   * Report to the AdManager that a breakpoint has been switched (passed from one break to\n   * another). Should there be a responsive slot with a\n   * @param breakpoint the breakpoint that is currently being displayed\n   * @returns {number} the number of adSlots affected by the change\n   */\n  switchedToBreakpoint(breakpoint) {\n    if(!breakpoint) {\n      throw new Error(`Missing argument: a call to switchedToBreakpoint must have an breakpoint`,this);\n    }\n    let count = 0;\n    for(const adSlotKey of this.adSlots.keys()) {\n      const adSlot = this.adSlots.get(adSlotKey);\n      if(adSlot.responsive === true && adSlot.lastResolvedWithBreakpoint) {\n        if(adSlot.lastResolvedWithBreakpoint !== breakpoint) {\n          adSlot.refresh();\n          count++;\n        }\n      }\n    }\n    return count;\n  }\n\n  /**\n   * Checks whether an adSlot is defined for a given breakpoint (Default: current breakpoint)\n   * @returns {boolean} true iff the adSlot is defined for the given breakpoint.\n   */\n  doesBreakpointContainAd(adSlot, breakpoint = getBreakpoint()) {\n    if(!adSlot) {\n      throw new Error(`Missing argument: a call to doesBreakpointContainAd must have an adSlot`,this);\n    }\n    let containsBreakpoint = true;\n    if(adSlot.responsive === true) {\n      const mapping = adSlot.responsiveAdSizeMapping[getBreakpointName(breakpoint)];\n      if(Array.isArray(mapping) === false) {\n        throw new Error(`Invalid argument: breakpoint:${breakpoint} doesn't exist!`,this);\n      }\n      containsBreakpoint = mapping.length > 0 && !arraysEqual(mapping,[0,0]);\n    }\n    return containsBreakpoint;\n  }\n\n  /**\n   * Initializes the callback from the 'slotRenderEnded' event for each slot\n   */\n  initSlotRenderedCallback() {\n    if(window.googletag && window.googletag.apiReady) {\n      const pubads = window.googletag.pubads();\n      pubads.addEventListener('slotRenderEnded', event => {\n        const id = event.slot.getAdUnitPath().split('/')[3];\n        const isEmpty = event.isEmpty;\n        const resolvedSize = event.size;\n        //console.log('slotRenderEnded for slot',id,' called @',window.performance.now());\n        if(this.adSlots.has(id)) {\n          const adSlot = this.adSlots.get(id);\n          adSlot.lastResolvedSize = resolvedSize;\n          adSlot.lastResolvedWithBreakpoint = getBreakpoint();\n          if(isEmpty) {\n            adSlot.lastResolvedSize = ConflictResolver.EMPTY_SIZE;\n            adSlot.hide();\n            this.releaseSlotDependencies(adSlot);\n          }\n          else {\n            this.user.impressionManager.registerImpression(`${adSlot.id}${this.config.department}`);\n            this.user.impressionManager.registerImpression(`${adSlot.id}_all`);\n            this.releaseSlotDependencies(adSlot, adSlot.lastResolvedSize);\n          }\n        }\n        else {\n          console.error(`Cannot find an adSlot with id: ${id} - Ad Unit path is ${event.slot.getAdUnitPath()}`);\n        }\n      });\n    }\n    else {\n      throw new Error(`googletag api was not ready when 'initSlotRenderedCallback' was called!`);\n    }\n  }\n\n  releaseSlotDependencies(adSlot) {\n    try {\n      const id = adSlot.id;\n      this.conflictResolver.updateResolvedSlot(id, adSlot.lastResolvedSize);\n      if(this.conflictResolver.isBlocking(id)) {\n        // Hide all blocked adSlots\n        for(const blockedSlot of this.conflictResolver.getBlockedSlotsIds(id)) {\n          if(this.conflictResolver.isBlocked(blockedSlot)) {\n            if(this.adSlots.has(blockedSlot)) {\n              this.adSlots.get(blockedSlot).hide();\n            }\n          }\n        }\n        // Show the non blocked\n        for(const deferredSlotKey of this.conflictResolver.deferredSlots.keys()) {\n          const deferredAdSlot = this.adSlots.get(deferredSlotKey);\n          if(deferredAdSlot && this.shouldSendRequestToDfp(deferredAdSlot)) {\n            this.conflictResolver.deferredSlots.delete(deferredSlotKey);\n            if(deferredAdSlot.deferredSlot) {\n              deferredAdSlot.defineSlot();\n              deferredAdSlot.deferredSlot = false;\n            }\n            deferredAdSlot.show();\n          }\n        }\n      }\n    }\n    catch (err) {\n      console.error(`Cannot updateSlotDependencies for adSlot: ${adSlot.id}`);\n    }\n  }\n\n  //TODO - move these to a separate service\n  /**\n   * Initializes page-level targeting params.\n   */\n  initGoogleTargetingParams() {\n    if(window.googletag && window.googletag.apiReady) {\n\n      //Returns a reference to the pubads service.\n      const pubads = googletag.pubads();\n\n      // Environment targeting (dev, test, prod)\n      if (this.config.environment) {\n        pubads.setTargeting('stg', [this.config.environment]);\n      }\n\n      // User targeting\n      if (this.user.type) {\n        pubads.setTargeting('UserType', [this.user.type]);\n      }\n      if (this.user.age) {\n        pubads.setTargeting('age', [this.user.age]);\n      }\n      if (this.user.gender) {\n        pubads.setTargeting('urgdr', [this.user.gender]);\n      }\n\n      // Context targeting\n      if (this.config.articleId) {\n        pubads.setTargeting('articleId', [this.config.articleId]);\n      }\n      if (this.config.gStatCampaignNumber && this.config.gStatCampaignNumber != -1) {\n        pubads.setTargeting('gstat_campaign_id', [this.config.gStatCampaignNumber]);\n      }\n\n      // UTM targeting\n      if (this.config.utm_.content) {\n        pubads.setTargeting('utm_content', [this.config.utm_.content]);\n      }\n      if (this.config.utm_.source) {\n        pubads.setTargeting('utm_source', [this.config.utm_.source]);\n      }\n      if (this.config.utm_.medium) {\n        pubads.setTargeting('utm_medium', [this.config.utm_.medium]);\n      }\n      if (this.config.utm_.campaign) {\n        pubads.setTargeting('utm_campaign', [this.config.utm_.campaign]);\n      }\n      // AdBlock removal\n      if (this.config.adBlockRemoved) {\n        pubads.setTargeting('adblock_removed', [this.config.adBlockRemoved]);\n      }\n      // University targeting - triggered via cookie\n      if (this.config.wifiLocation) {\n        pubads.setTargeting('wifi', [this.config.wifiLocation]);\n      }\n\n      // Ads Centering\n      pubads.setCentering(true);\n    }\n    else {\n      throw new Error(`googletag api was not ready when 'initGoogleTargetingParams' was called!`);\n    }\n  }\n\n  /**\n   * Initializes googletag services.\n   */\n  initGoogleGlobalSettings() {\n    if(window.googletag && window.googletag.apiReady) {\n      if(window.location.search && window.location.search.indexOf('sraon') > 0) {\n        console.log('enableSingleRequest mode: active');\n        googletag.pubads().enableSingleRequest();\n      }\n      if(!this.config.isMobile) {\n        googletag.pubads().enableAsyncRendering();\n      }\n      else {\n        googletag.pubads().enableAsyncRendering(); // disabled: googletag.pubads().enableSyncRendering();\n      }\n      // Enables all GPT services that have been defined for ad slots on the page.\n      googletag.enableServices();\n    }\n    else {\n      throw new Error(`googletag api was not ready when 'initGoogleGlobalSettings' was called!`);\n    }\n  }\n}\n","/* globals googletag */\nimport AdManager  from '../src/objects/adManager';\nimport globalConfig from './globalConfig';\nconst defaultConfig = globalConfig || {};\nimport { getBreakpoint, debounce }  from '../src/utils/breakpoints';\nconst googletagInitTimeout = 10000;\nconst resizeTimeout = 250;\n\nexport default class DFP {\n\n  constructor(config) {\n    this.config = Object.assign({}, defaultConfig, config);\n    this.wasInitialized = false;\n    this.breakpoint = getBreakpoint();\n    this.initWindowResizeListener();\n  }\n\n  /**\n   * This part of the object's construction is dependent on the call to 'init'\n   */\n  resumeInit() {\n    try{\n      this.adManager = new AdManager(this.config);\n    }\n    catch (err) {\n      console.log(err);\n    }\n  }\n\n  /**\n   * initializes the 'googletag' global namespace and add the\n   * google publish tags library to the page\n   * @returns {Promise} that resolves to true once the googletag api is ready to use\n   * (googletag.apiReady = true)\n   */\n  initGoogleTag() {\n    const dfpThis = this;\n    return new Promise((resolve,reject) => {\n      if (dfpThis.wasInitialized == true || (window.googletag && window.googletag.apiReady)) {\n        this.adManager = this.adManager || new AdManager(this.config);\n        dfpThis.wasInitialized = true;\n        resolve(this.isGoogleTagReady);\n      }\n      else {\n        // set up a place holder for the gpt code downloaded from google\n        window.googletag = window.googletag || {};\n\n        // this is a command queue used by GPT any methods added to it will be\n        // executed when GPT code is available, if GPT is already available they\n        // will be executed immediately\n        window.googletag.cmd = window.googletag.cmd || [];\n        //load google tag services JavaScript\n        (() => {\n          const tag = window.document.createElement('script');\n          tag.async = false;\n          tag.type = 'text/javascript';\n          //var useSSL = 'https:' == document.location.protocol;\n          tag.setAttribute('src','//www.googletagservices.com/tag/js/gpt.js');\n          var node = window.document.getElementsByTagName('script')[0];\n          tag.onload = (() => {\n            dfpThis.wasInitialized = true;\n            dfpThis.resumeInit();\n            resolve(this.isGoogleTagReady);\n          });\n          tag.onerror = ((error) => {\n            dfpThis.wasInitialized = false;\n            reject(error);\n          });\n          node.parentNode.insertBefore(tag, node);\n        })();\n      }\n    });\n  }\n\n  /**\n   *\n   * @returns {Promise}\n   */\n  isGoogleTagReady() {\n    let promise = new Promise((resolve,reject) => {\n      googletag.cmd.push(() => {\n        resolve(this);\n      });\n      setTimeout(() => {\n        if(!(googletag && googletag.apiReady === true)) {\n          reject(new Error(\"googletag failed to initialize on the page!\"));\n        }\n      },googletagInitTimeout);\n    });\n    return promise;\n  }\n\n  /**\n   * Initializes the window resize listener to support responsive ad refreshes\n   */\n  initWindowResizeListener() {\n    const dfpThis = this;\n    function onResize() {\n      const currentBreakpoint = getBreakpoint();\n      if(dfpThis.breakpoint != currentBreakpoint) {\n        dfpThis.breakpoint = currentBreakpoint;\n        if(dfpThis.adManager) {\n          dfpThis.adManager.refreshAllSlots();\n        }\n        else {\n          throw new Error(\"initWindowResizeListener error - adManager instance is not available\")\n        }\n      }\n    }\n    const debouncedFunction = debounce(onResize,resizeTimeout);\n    window.onresize = debouncedFunction;\n  }\n}\n","import DFP from './dfp';\nimport globalConfig from './globalConfig';\n\n// Correct version will be set with the 'rollup-replace plugin'\nDFP.version = 'VERSION';\n\n//// Only for development mode\n//if ( process.env.NODE_ENV !== 'production' ) {\n//  DFP.dev = '123';\n//}\n\nexport const config = globalConfig;\nexport const version = DFP.version;\nexport default DFP;\n"],"names":["stringToMap","string","separator","operator","map","itemsArr","split","key","hasOwnProperty","keyValue","length","decodeURIComponent","getCookieAsMap","document","cookie","addHours","date","hours","SyntaxError","isNaN","parseInt","TypeError","result","Date","setHours","getHours","addDays","days","setDate","getDate","debounce","func","wait","immediate","timeout","context","this","args","arguments","later","apply","callNow","setTimeout","getBreakpoint","breakpoint","breakpoints","xxl","windowWidth","window","innerWidth","xl","l","m","s","xs","xxs","getBreakpointName","resultBreakpoint","arraysEqual","a","b","Array","isArray","i","ssoKey","location","hostname","indexOf","dfpConfig","Object","assign","referrer","isMobile","test","navigator","userAgent","isHomepage","pathname","environment","department","domain","regexMatch","exec","path","sectionArray","articleId","slice","filter","section","index","arr","reduce","last","current","concat","env","port","dev","prod","undefined","articleIdMatch","pop","content","getUrlParam","source","medium","campaign","results","RegExp","search","adBlockRemoved","localStorage","getItem","err","wifiLocation","cookieMap","gStatCampaignNumber","gstatCampaign","JSON","parse","isType1","breakpoints1","breakpoints2","getTime","globalConfig","breakpointsConfig","keys","ImpressionsManager","impressionManagerConfig","now","config","impressions","retrieveImpressionsData","initImpressionMap","migrateImpressionsData","_this","frequency","impressionsData","oldImpressionsArray","e","forEach","impression","adUnitImpression","name","data","tmp","target","slotId","join","id","exposed","expires","_this2","adSlotId","log","debouncedSave","saveImpressionsToLocalStorageImpl","setItem","stringify","slot","shouldUpdateExpiryDate","_this3","initSlotFromConfig","updateExpiryDate","slotName","Error","frequencyMap","match","frequencyRegex","setMilliseconds","setSeconds","setMinutes","maxImpressions","saveImpressionsToLocalStorage","atQuota","userTypes","User","userConfig","sso","type","getUserType","impressionManager","ImpressionManager","age","getUserAge","gender","getUserGender","payerProp","payer","registered","anonymous","usrae","urgdr","ConflictResolver","conflictManagementConfig","dependencyMap","initializeDependencyMap","deferredSlots","Set","conflictManagementJson","queue","Map","value","rules","item","onsize","avoid","set","resolvedSize","has","get","resolvedWith","isBlocked","adSlotKey","adSlot","adSlotRule","parentResolvedWith","add","find","size","numberStr","isBlocking","from","EMPTY_SIZE","adSlotConfig","responsive","fluid","user","adManager","htmlElement","priority","deferredSlot","network","adUnitBase","adSizeMapping","responsiveAdSizeMapping","blacklistReferrers","whitelistReferrers","lastResolvedSize","lastResolvedWithBreakpoint","defineSlot","adTypes","maavaron","popunder","talkback","regular","whitelisted","blacklisted","shown","cmd","push","getElementById","classList","remove","display","isMaavaron","maavaronSlot","defineMaavaron","shouldSendRequestToDfp","googletag","pubads","defineFn","isOutOfPage","defineOutOfPageSlot","getPath","responsiveSlotSizeMapping","sizeMapping","addSize","build","defineSizeMapping","addService","setCollapseEmptyDiv","calculatedPath","toLowerCase","event","getAdUnitPath","isEmpty","refresh","_this4","adUnitMaavaronPath","adUnitMaavaronSize","definePassback","setTargeting","adPriorities","adTargets","AdManager","conflictResolver","initGoogleTargetingParams","initGoogleGlobalSettings","initSlotRenderedCallback","adSlots","initAdSlots","high","addEventListener","normal","low","show","priorityFilter","values","deferredSlotId","deferredAdSlot","currentBreakpoint","hide","filteredPriority","adSlotPlaceholders","getElementsByClassName","node","adSlotNodeSet","prototype","call","adSlotPriority","computedAdSlotConfig","attributes","all","getAdType","adManagerConfig","adSlotInstance","AdSlot","isWhitelisted","isBlacklisted","shouldDisplayAdAfterAdBlockRemoval","doesBreakpointContainAd","doesUserTypeMatchBannerTargeting","reachedQuota","adSlotOrTarget","userType","adTarget","nonPaying","paying","digitalOnly","digitalAndPrint","count","containsBreakpoint","mapping","apiReady","releaseSlotDependencies","registerImpression","error","updateResolvedSlot","getBlockedSlotsIds","blockedSlot","deferredSlotKey","delete","utm_","setCentering","enableSingleRequest","enableAsyncRendering","enableServices","defaultConfig","googletagInitTimeout","resizeTimeout","DFP","wasInitialized","initWindowResizeListener","dfpThis","Promise","resolve","reject","isGoogleTagReady","tag","createElement","async","setAttribute","getElementsByTagName","onload","resumeInit","onerror","parentNode","insertBefore","promise","onResize","refreshAllSlots","debouncedFunction","onresize","version"],"mappings":"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"}