{"version":3,"sources":["../src/utils/cookieUtils.js","../src/utils/time.js","../src/utils/breakpoints.js","../src/utils/arrays.js","../jspm_packages/npm/systemjs-plugin-babel@0.0.17/babel-helpers/classCallCheck.js","../jspm_packages/npm/systemjs-plugin-babel@0.0.17/babel-helpers/createClass.js","../src/globalConfig.js","../src/objects/impressionsManager.js","../src/objects/user.js","../src/objects/conflictResolver.js","../src/objects/adSlot.js","../src/objects/adManager.js","../src/dfp.js","../src/index.js"],"names":["stringToMap","string","separator","undefined","_ref$separator","operator","_ref$operator","map","itemsArr","split","forEach","element","keyValue","length","decodeURIComponent","e","getCookieAsMap","document","cookie","tmsso","engsso","addHours","date","hours","SyntaxError","isNaN","parseInt","TypeError","result","Date","setHours","getHours","addDays","days","setDate","getDate","debounce","func","wait","arguments","immediate","timeout","context","this","args","later","apply","callNow","setTimeout","getBreakpoint","breakpoint","windowWidth","window","innerWidth","documentElement","clientWidth","body","breakpoints","xs","xxs","s","m","l","xl","xxl","getBreakpointName","resultBreakpoint","arraysEqual$1","a","b","Array","isArray","i","version","_","instance","Constructor","defineProperties","target","props","descriptor","enumerable","configurable","writable","defineProperty","key","protoProps","staticProps","prototype","ssoKey","location","hostname","indexOf","dfpConfig","Object","assign","referrer","isMobile","test","navigator","userAgent","isHomepage","pathname","environment","department","domain","regexMatch","exec","path","sectionArray","articleId","slice","filter","section","index","arr","reduce","last","current","concat","site","env","port","dev","prod","articleIdMatch","pop","content","getUrlParam","source","medium","campaign","results","RegExp","search","adBlockRemoved","localStorage","getItem","err","isWriterAlerts","wifiLocation","cookieMap","_htzwif","gStatCampaignNumber","gstatCampaign","JSON","parse","CampaignNumber","googleGlobalSettings","breakpointType","breakpoints1","breakpoints2","breakpoints3","breakpoints4","getTime","breakpointsConfig","keys","ImpressionsManager","impressionManagerConfig","now","config","impressions","retrieveImpressionsData","initImpressionMap","migrateImpressionsData","_this","hasOwnProperty","call","frequency","impressionsData","oldImpressionsArray","impression","adUnitImpression","name","data","tmp","slotId","join","id","exposed","expires","_this2","adSlotId","err1","debouncedSave","saveImpressionsToLocalStorageImpl","setItem","stringify","error","slot","_this3","shouldUpdateExpiryDate","initSlotFromConfig","updateExpiryDate","slotName","Error","frequencyMap","match","frequencyRegex","setMilliseconds","setSeconds","setMinutes","maxImpressions","saveImpressionsToLocalStorage","atQuota","userTypes$1","User","userConfig","sso","type","getUserType","impressionManager","age","getUserAge","gender","getUserGender","userType","payerProp","payer","registered","anonymous","usrae","urgdr","ConflictResolver","conflictManagementConfig","dependencyMap","initializeDependencyMap","deferredSlots","Set","conflictManagementJson","queue","Map","value","rules","item","onsize","avoid","set","resolvedSize","has","get","resolvedWith","isBlocked","_step","Symbol","iterator","_iteratorNormalCompletion","_iterator","next","done","adSlotKey","adSlot","_step2","_iteratorNormalCompletion2","_iterator2","adSlotRule","parentResolvedWith","add","find","sizeString","size","numberStr","arraysEqual","isBlocking","_step3","_iteratorNormalCompletion3","_iterator3","from","EMPTY_SIZE","hiddenClass","adSlotConfig","responsive","fluid","user","adManager","htmlElement","priority","deferredSlot","network","adUnitBase","adSizeMapping","responsiveAdSizeMapping","blacklistReferrers","whitelistReferrers","lastResolvedSize","lastResolvedWithBreakpoint","defineSlot","adTypes","maavaron","popunder","talkback","regular","whitelisted","blacklisted","shown","cmd","push","getElementById","classList","remove","display","isMaavaron","maavaronSlot","defineMaavaron","shouldSendRequestToDfp","googletag","pubads","defineFn","isOutOfPage","defineOutOfPageSlot","getPath","responsiveSlotSizeMapping","sizeMapping","addSize","build","defineSizeMapping","addService","setCollapseEmptyDiv","calculatedPath","toLowerCase","event","getAdUnitPath","isEmpty","refresh","_this4","adUnitMaavaronPath","adUnitMaavaronSize","definePassback","setTargeting","adPriorities","adTargets","userTypes$$1","AdManager","conflictResolver","initGoogleTargetingParams","initGoogleGlobalSettings","initSlotRenderedCallback","currentBreakpointName","adManagerConfig","adSlots","initAdSlots","high","onDomLoaded","normal","log","onWindowLoaded","low","readyState","addEventListener","adSlot$$1","show","priorityFilter","values","deferredSlotId","deferredAdSlot","currentBreakpoint","hide","_step4","_iteratorNormalCompletion4","_iterator4","filteredPriority","adSlotPlaceholders","getElementsByClassName","node","adSlotNodeSet","adSlotPriority","computedAdSlotConfig","attributes","all","getAdType","adSlotInstance","isWhitelisted","isBlacklisted","shouldDisplayAdAfterAdBlockRemoval","doesBreakpointContainAd","doesUserTypeMatchBannerTargeting","reachedQuota","adSlotOrTarget","adTarget","nonPaying","paying","digitalOnly","digitalAndPrint","count","_step5","_iteratorNormalCompletion5","_iterator5","containsBreakpoint","mapping","apiReady","releaseSlotDependencies","registerImpression","updateResolvedSlot","_step6","getBlockedSlotsIds","_iteratorNormalCompletion6","_iterator6","blockedSlot","_step7","_iteratorNormalCompletion7","_iterator7","deferredSlotKey","delete","utm_","setCentering","enableSingleRequest","enableAsyncRendering","enableSyncRendering","enableServices","defaultConfig","resizeTimeout","DFP$1","wasInitialized","initStarted","initWindowResizeListener","dfpThis","Promise","resolve","reject","tag","createElement","async","setAttribute","getElementsByTagName","resumeInit","parentNode","insertBefore","onResize","refreshAllSlots","debouncedFunction","onresize","version$1"],"mappings":"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","file":"dfp.min.js","sourcesContent":["/**\r\n * Htz-cookie-util\r\n * @module htzCookieUtil\r\n * @author Elia Grady elia.grady@haaretz.co.il\r\n * @license MIT\r\n */\r\n\r\n/**\r\n * Translates Key-Value string into a convenient map.\r\n * @param {String} string String in format of \"key<operator>value<separator>.....\"\r\n * @param {object} options object for overriding defaults:\r\n * options.separator is a String or regExp that separates between each key value pairs\r\n * (default is ';'). options.operator is a String or regExp that separates between each key\r\n * and value within a pair (default is '=').\r\n * @returns {object} a map object, with key-value mapping according to the passed configuration.\r\n */\r\nfunction stringToMap(string,\r\n  { separator = ';', operator = '=' } = {}) {\r\n  const map = {};\r\n  const itemsArr = string.split(separator);\r\n  itemsArr.forEach(element => {\r\n    if (typeof element === 'string') {\r\n      const keyValue = element.split(operator);\r\n      if (keyValue.length === 2) {\r\n        try {\r\n          map[keyValue[0]] = decodeURIComponent(keyValue[1]);\r\n        }\r\n        catch (e) {\r\n          // Do nothing, malformed URI\r\n        }\r\n      }\r\n    }\r\n  });\r\n  return map;\r\n}\r\nexport const ssoKey = window.location.hostname.indexOf('haaretz.com') > -1 ? 'engsso' : 'tmsso';\r\n\r\n// Translates Cookie string into a convenient map.\r\nexport default function getCookieAsMap() {\r\n  const map = stringToMap(document.cookie, { separator: /;\\s?/ });\r\n  if (typeof map.tmsso === 'string') {\r\n    map.tmsso = stringToMap(map.tmsso, { separator: ':' });\r\n  }\r\n  if (typeof map.engsso === 'string') {\r\n    map.engsso = stringToMap(map.engsso, { separator: ':' });\r\n  }\r\n  return map;\r\n}\r\n","/**\r\n * Helper function. Adds N hours to a given date object.\r\n * @param {Date} date - the date to derive from\r\n * @param {Number} hours - the amount of hours to add, in whole numbers\r\n * @throws {SyntaxError} Will throw if the 'date' param is not provided\r\n * @throws {SyntaxError} Will throw if the 'hours' param is not provided\r\n * @throws {TypeError} Will throw if the 'hours' param is not a valid integer\r\n * @returns {Date} date - the new date, derived from adding the given hours\r\n */\r\nexport function addHours(date, hours) {\r\n  if (!date) {\r\n    throw new SyntaxError('addHours called without a required \\'date\\' parameter!');\r\n  }\r\n  if (!hours) {\r\n    throw new SyntaxError('addHours called without a required \\'hours\\' parameter!');\r\n  }\r\n  else if (isNaN(parseInt(hours, 10))) {\r\n    throw new TypeError('addHours called with an invalid integer \\'hours\\' parameter!');\r\n  }\r\n  const result = new Date(date);\r\n  result.setHours(result.getHours() + parseInt(hours, 10));\r\n  return result;\r\n}\r\n\r\n/**\r\n * Helper function. Adds N days to a given date object.\r\n * @param {Date} date - the date to derive from\r\n * @param {Integer} days - the amount of days to add\r\n * @throws {SyntaxError} Will throw if the 'date' param is not provided\r\n * @throws {SyntaxError} Will throw if the 'days' param is not provided\r\n * @throws {TypeError} Will throw if the 'hours' param is not a valid integer\r\n * @returns {Date} date - the new date, derived from adding the given days\r\n */\r\nexport function addDays(date, days) {\r\n  if (!date) {\r\n    throw new SyntaxError('addDays called without a required \\'date\\' parameter!');\r\n  }\r\n  if (!days) {\r\n    throw new SyntaxError('addDays called without a required \\'days\\' parameter!');\r\n  }\r\n  else if (isNaN(parseInt(days, 10))) {\r\n    throw new TypeError('addDays called with an invalid integer \\'days\\' parameter!');\r\n  }\r\n  const result = new Date(date);\r\n  result.setDate(result.getDate() + parseInt(days, 10));\r\n  return result;\r\n}\r\n","import globalConfig from '../globalConfig';\r\n\r\nconst breakpoints = globalConfig.breakpointsConfig.breakpoints;\r\n\r\n/**\r\n * Returns a function, that, as long as it continues to be invoked, will not\r\n * be triggered. The function will be called after it stops being called for\r\n * N milliseconds. If `immediate` is passed, trigger the function on the\r\n * leading edge, instead of the trailing.\r\n * @param { function } func - the function to run\r\n * @param { number } wait - the timeout period to avoid running the function\r\n * @param { boolean } immediate - leading edge modifier\r\n * @returns {function } the debounced function\r\n */\r\nexport function debounce(func, wait = 100, immediate) {\r\n  let timeout;\r\n  return function debounced() {\r\n    const context = this;\r\n    const args = arguments;// eslint-disable-line prefer-rest-params\r\n    const later = () => {\r\n      timeout = null;\r\n      if (!immediate) func.apply(context, args);\r\n    };\r\n    const callNow = immediate && !timeout;\r\n    clearTimeout(timeout);\r\n    timeout = setTimeout(later, wait);\r\n    if (callNow) func.apply(context, args);\r\n  };\r\n}\r\n\r\n/**\r\n * Returns the current breakpoint that is closest to the window's width\r\n * @returns {number} the break that the current width represents\r\n */\r\nexport function getBreakpoint() {\r\n  let breakpoint;\r\n  const windowWidth = window.innerWidth\r\n    || document.documentElement.clientWidth\r\n    || document.body.clientWidth;\r\n  switch (true) {\r\n    case windowWidth < breakpoints.xs: breakpoint = breakpoints.xxs; break;\r\n    case windowWidth < breakpoints.s: breakpoint = breakpoints.xs; break;\r\n    case windowWidth < breakpoints.m: breakpoint = breakpoints.s; break;\r\n    case windowWidth < breakpoints.l: breakpoint = breakpoints.m; break;\r\n    case windowWidth < breakpoints.xl: breakpoint = breakpoints.l; break;\r\n    case windowWidth < breakpoints.xxl: breakpoint = breakpoints.xl; break;\r\n    default: breakpoint = breakpoints.xxl;\r\n  }\r\n  return breakpoint;\r\n}\r\n/**\r\n * Returns the current breakpoint that is closest to the window's width\r\n * @param {number} breakpoint - the breakpoint label enumerator that the current width represents\r\n * (yield with a getBreakpoint() call or passed manually )\r\n * @returns {string} breakpoint - the breakpoint label that the current width represents,\r\n * as a string\r\n */\r\nexport function getBreakpointName(breakpoint) {\r\n  let resultBreakpoint;\r\n  const windowWidth = breakpoint || window.innerWidth;\r\n  switch (true) {\r\n    case windowWidth < breakpoints.xs: resultBreakpoint = 'xxs'; break;\r\n    case windowWidth < breakpoints.s: resultBreakpoint = 'xs'; break;\r\n    case windowWidth < breakpoints.m: resultBreakpoint = 's'; break;\r\n    case windowWidth < breakpoints.l: resultBreakpoint = 'm'; break;\r\n    case windowWidth < breakpoints.xl: resultBreakpoint = 'l'; break;\r\n    case windowWidth < breakpoints.xxl: resultBreakpoint = 'xl'; break;\r\n    default: resultBreakpoint = 'xxl';\r\n  }\r\n  return resultBreakpoint;\r\n}\r\n","/**\n * Checks whether two arrays are equal\n * @param {Array} a - the first array to check\n * @param {Array} b - the second array to check\n * @returns {Boolean} true iff both a and b are arrays, with equal values\n */\nexport function arraysEqual(a, b) {\n  if (!a || !b) return false;\n  if (!Array.isArray(a) || !Array.isArray(b)) return false;\n  if (a === b) return true;\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; ++i) {\n    if (Array.isArray(a[i]) && Array.isArray(b[i])) {\n      if (!arraysEqual(a[i], b[i])) return false;\n    }\n    else if (a[i] !== b[i]) {\n      return false;\n    }\n  }\n  return true;\n}\nexport default arraysEqual;\n","export default (function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n});","export default (function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n})();","/* global dfpConfig */\nimport getCookieAsMap, { ssoKey } from './utils/cookieUtils';\n// globalConfig for DFP\n// eslint-disable-next-line no-use-before-define\nconst dfpConfig = Object.assign(dfpConfig || {}, {\n  get referrer() {\n    return document.referrer ? document.referrer : '';\n  },\n  get isMobile() {\n    return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\n      .test(window.navigator.userAgent || ''));\n  },\n  /**\n   * Returns true iff the loaded page is the homepage (no inner path)\n   * @returns {boolean}\n   */\n  get isHomepage() {\n    return window.location.pathname === '/' || this.environment === 3; // 'prod'\n  },\n  get department() {\n    return this.isHomepage ? '_homepage' : '_section';\n  },\n  /**\n   * returns the domain the page was loaded to. i.e: 'haaretz.co.il', 'haaretz.com'\n   * @returns {string} the domain name from the windows's location hostname property\n   */\n  get domain() {\n    const regexMatch = /([\\d|\\w]+)(\\.co\\.il|\\.com)(.*)?/.exec(window.location.hostname);\n    const result = regexMatch ? regexMatch[0] : window.location.hostname;\n    return result;\n  },\n  /**\n   * Returns an array of concatenated paths, separated by a dot.\n   * For example, for the URL:\n   * http://www.haaretz.co.il/news/world/america/us-election-2016/LIVE-1.2869045\n   * the path is '/news/world/america/us-election-2016/LIVE-1.2869045'.\n   * This function takes the directories ['news', 'world', 'america', 'us-election-2016']\n   * and converts it to the following format:\n   * ['.news', '.news.world', '.news.world.america', '.news.world.america.us-election-2016']\n   * This denotes the path configuration for the given adSlot\n   * non articles (sections) will be given a '0' - no articleId value for targeting purposes)\n   * @returns {Array.<T>} an array of path names\n   */\n  get path() {\n    let sectionArray = this.articleId && this.articleId !== '0' ?\n      window.location.pathname.split('/').slice(1, -1) :\n      window.location.pathname.split('/').slice(1);\n    sectionArray = sectionArray.filter(path =>\n    path !== 'wwwMobileSite' && path !== 'whtzMobileSite');\n    return sectionArray\n      .map(section => `.${section}`)\n      .map((section, index, arr) => arr.slice(0, index + 1)\n        .reduce((last, current) => last.concat(current)));\n  },\n  /**\n   * Returns a string representation for the name of the site\n   * @return {*|string}\n   */\n  get site() {\n    let site;\n    if (window.location.hostname.indexOf('haaretz.co.il') > -1) {\n      site = 'haaretz';\n    }\n    else if (window.location.hostname.indexOf('themarker.com') > -1) {\n      site = 'themarker';\n    }\n    else if (window.location.hostname.indexOf('mouse.co.il') > -1) {\n      site = 'mouse';\n    }\n    return site || 'haaretz';\n  },\n  /**\n   * Returns the current environment targeting param, if such is defined.\n   * @returns {number} targeting param, 1 for local development, 2 for test servers and 3 for prod.\n   * May return undefined if no targeting is specified.\n   */\n  get environment() {\n    const env = {\n      dev: 1,\n      test: 2,\n      prod: 3,\n    };\n    return window.location.port === '8080' ? env.dev :\n      (window.location.hostname.indexOf('pre.haaretz.co.il') > -1\n      || window.location.hostname.indexOf('tmtest.themarker.com') > -1\n      || window.location.hostname.indexOf('prodmouse.mouse.co.il') > -1) ? env.test :\n        (window.location.pathname.indexOf('/cmlink/Haaretz.HomePage') > -1\n        || window.location.pathname.indexOf('/cmlink/TheMarker.HomePage') > -1\n        || window.location.pathname.indexOf('/cmlink/Mouse.HomePage') > -1)\n          ? env.prod : undefined;\n  },\n  /**\n   * Returns the articleIf if on an article page, or null otherwise\n   * @returns {string} an articleId string from the pathname, or 0 if not found\n   */\n  get articleId() {\n    const articleIdMatch = /\\d\\.\\d+/g.exec(window.location.pathname);\n    let articleId = '0';\n    if (articleIdMatch) {\n      articleId = articleIdMatch.pop(); // Converts [\"1.23145\"] to \"1.23145\"\n    }\n    return articleId;\n  },\n  utm_: {\n    get content() {\n      return this.getUrlParam('utm_content');\n    },\n    get source() {\n      return this.getUrlParam('utm_source');\n    },\n    get medium() {\n      return this.getUrlParam('utm_medium');\n    },\n    get campaign() {\n      return this.getUrlParam('utm_campaign');\n    },\n    getUrlParam(key) {\n      const results = RegExp(`(${key})(=)([^&\"]+)`).exec(window.location.search);\n      return results && results[3] ? results[3] : undefined;\n    },\n  },\n  get adBlockRemoved() {\n    let adBlockRemoved = false;\n    try {\n      if (localStorage.getItem('adblock_removed')) {\n        adBlockRemoved = true;\n      }\n    }\n    catch (err) {\n      // do nothing\n    }\n    return adBlockRemoved;\n  },\n  get isWriterAlerts() {\n    return (location.search.indexOf('writerAlerts=true') > -1);\n  },\n  get wifiLocation() {\n    let wifiLocation = '';\n    const cookieMap = getCookieAsMap();\n    try {\n      if (cookieMap && cookieMap._htzwif) { // eslint-disable-line no-underscore-dangle\n        wifiLocation = (cookieMap._htzwif === 'arcaffe') // eslint-disable-line no-underscore-dangle\n          ? 'ArCafe' : 'university';\n      }\n    }\n    catch (err) {\n      // do nothing\n    }\n    return wifiLocation;\n  },\n  get gStatCampaignNumber() {\n    let gstatCampaign;\n    try {\n      gstatCampaign = localStorage.getItem('GstatCampaign') ?\n        JSON.parse(localStorage.getItem('GstatCampaign')) : undefined;\n    }\n    catch (err) {\n      /* In case of thrown 'SecurityError' or 'QuotaExceededError',\n       the variable should be undefined */\n      gstatCampaign = undefined;\n    }\n    return gstatCampaign ? gstatCampaign.CampaignNumber : undefined;\n  },\n  adSlotConfig: {\n    'haaretz.co.il.example.slot': {\n      id: 'slotId',\n      // path : \"/network/base/slotId/slotId_subsection\", Will be calculated from AdManager\n      responsive: true,\n      adSizeMapping: [['width1', 'height1'], ...['widthN', 'heightN']],\n      priority: 'normal',\n      fluid: false,\n      responsiveAdSizeMapping: {\n        xxs: [['width1', 'height1'], ...['widthN', 'heightN']],\n        xs: [['width1', 'height1'], ...['widthN', 'heightN']],\n        s: [['width1', 'height1'], ...['widthN', 'heightN']],\n        m: [['width1', 'height1'], ...['widthN', 'heightN']],\n        l: [['width1', 'height1'], ...['widthN', 'heightN']],\n        xl: [['width1', 'height1'], ...['widthN', 'heightN']],\n        xxl: [['width1', 'height1'], ...['widthN', 'heightN']],\n      },\n      blacklistReferrers: 'comma, delimited, blacklisted, referrer, list',\n      whitelistReferrers: 'comma, delimited, referrer, list',\n    },\n  },\n  adManagerConfig: {\n    network: '9401',\n    adUnitBase: 'haaretz.co.il_Web',\n  },\n  breakpointsConfig: {\n    get breakpoints() {\n      // Override in VM from backend to control this toggle.\n      let breakpoints;\n      switch (dfpConfig.googleGlobalSettings.breakpointType) {\n        case 'type1': breakpoints = this.breakpoints1; break;\n        case 'type2': breakpoints = this.breakpoints2; break;\n        case 'type3': breakpoints = this.breakpoints3; break;\n        case 'type4': breakpoints = this.breakpoints4; break;\n        default: breakpoints = this.breakpoints1;\n      }\n      return breakpoints;\n    },\n    // Type 1\n    breakpoints1: {\n      xxs: 600,\n      xs: 761,\n      s: 993,\n      m: 1009,\n      l: 1291,\n      xl: 1600,\n      xxl: 1900,\n    },\n    // Type 2\n    breakpoints2: {\n      xxs: 600,\n      xs: 1000,\n      s: 1150,\n      m: 1281,\n      l: 1600,\n      xl: 1920,\n      xxl: 1920,\n    },\n    // Type 3\n    breakpoints3: {\n      xxs: 100,\n      xs: 480,\n      s: 600,\n      m: 768,\n      l: 1024,\n      xl: 1280,\n      xxl: 1900,\n    },\n    // Type 4\n    breakpoints4: {\n      xxs: 600,\n      xs: 768,\n      s: 1024,\n      m: 1280,\n      l: 1900,\n      xl: 1900,\n      xxl: 1900,\n    },\n  },\n  userConfig: {\n    type: undefined,\n    age: undefined,\n    gender: undefined,\n  },\n  conflictManagementConfig: {\n    'blocking.ad.unit.name': [\n      {\n        onsize: '1280x200,970x250,3x3',\n        avoid: 'blocked.ad.unit.name',\n      },\n      {\n        onsize: '1280x200,970x250,3x3',\n        avoid: 'blocked.ad.unit.name',\n      },\n    ],\n  },\n  impressionManagerConfig: {\n    'ad.unit.name': {\n      target: 'all|section|homepage',\n      frequency: '$1/$2(day|hour)',\n      exposed: 0,\n      expires: (new Date()).getTime(),\n    },\n  },\n  googleGlobalSettings: {\n    enableSingleRequest: true,\n    enableAsyncRendering: true,\n    refreshIntervalTime: 1000,\n    breakpointType: 'type1',\n  },\n  sso: ssoKey,\n\n});\n\nexport default dfpConfig;\n","import globalConfig from '../globalConfig';\r\nimport { addHours, addDays } from '../utils/time';\r\nimport { debounce } from '../utils/breakpoints';\r\n\r\nexport const keys = {\r\n  impressions: 'impressions',\r\n  frequency: 'frequency',\r\n  /**\r\n   * [0] - full match\r\n   * [1] - impression count i.e: \"1\" | \"22\"\r\n   * [2] - impression expiry range quantifier  i.e: \"1\" | \"22\"\r\n   * [3] - impression expiry range unit i.e: \"day\" | \"hour\"\r\n   */\r\n  frequencyRegex: /(\\d+)\\/(\\d+)(day|hour)/,\r\n  expires: 'expires',\r\n  exposed: 'exposed',\r\n  target: 'target',\r\n  maxImpressions: 'maxImpressions',\r\n  hours: 'hour',\r\n  days: 'day',\r\n  adSlotId: 'id',\r\n};\r\n\r\nexport default class ImpressionsManager {\r\n\r\n  constructor(impressionManagerConfig) {\r\n    this.now = (new Date()).getTime(); // this date is used for comparisons only\r\n    this.config = Object.assign({}, impressionManagerConfig);\r\n    this.impressions = this.retrieveImpressionsData();\r\n    this.initImpressionMap();\r\n  }\r\n\r\n  retrieveImpressionsData() {\r\n    const impressions = this.migrateImpressionsData();\r\n    /*\r\n     Merge migrated data with new data\r\n     console.log('Migrated: ',impressions);\r\n     */\r\n    Object.keys(impressions).map((key, index) => {\r\n      impressions[key] = Object.assign({}, impressions[key], this.config[key]);\r\n      return this;\r\n    });\r\n    /*\r\n     console.log('Merged: ',impressions);\r\n     Filter out entries without frequency\r\n     */\r\n    for (const key in impressions) {\r\n      if ({}.hasOwnProperty.call(impressions, key)) {\r\n        if (!impressions[key][keys.frequency]) {\r\n          // console.log(`Removing ${key} - since it does not have a frequency`,impressions[key]);\r\n          delete impressions[key];\r\n        }\r\n      }\r\n    }\r\n    // console.log('Filtered: ',impressions);\r\n    return impressions;\r\n  }\r\n\r\n  migrateImpressionsData() {\r\n    let impressions;\r\n    let impressionsData;\r\n    try {\r\n      impressionsData = window.localStorage.getItem(keys.impressions);\r\n    }\r\n    catch (err) {\r\n      // In case of thrown 'SecurityError' or 'QuotaExceededError', the variable should be undefined\r\n      impressionsData = undefined;\r\n    }\r\n    try {\r\n      impressions = JSON.parse(impressionsData);\r\n    }\r\n    catch (err) {\r\n      // Here is where old impression data is converted to new format\r\n      impressions = {};\r\n      const oldImpressionsArray = impressionsData.split(';').filter(e => e);\r\n\r\n      oldImpressionsArray.forEach((impression) => {\r\n        try {\r\n          const adUnitImpression = impression.split(' = ');\r\n          const name = adUnitImpression[0];\r\n          const data = adUnitImpression[1];\r\n          const tmp = name.split('.');\r\n          let target = tmp.pop();\r\n          if (target && target === 'hp') {\r\n            target = 'homepage';\r\n          }\r\n          const slotId = tmp.join('.');\r\n          const id = `${slotId}_${target}`;\r\n          const exposed = parseInt(data.split('/')[0], 10) || 0;\r\n          const expires = parseInt(data.split('/')[1], 10) || this.now;\r\n          impressions[id] = {};\r\n          impressions[id][keys.adSlotId] = slotId;\r\n          impressions[id][keys.target] = target;\r\n          impressions[id][keys.exposed] = exposed;\r\n          impressions[id][keys.expires] = expires;\r\n        }\r\n        catch (err1) {\r\n          // console.log(`Failed converting impression: ${impression}`, err1);\r\n        }\r\n      });\r\n    }\r\n    return impressions || {};\r\n  }\r\n\r\n  /**\r\n   * Define the debounced version of the local storage save\r\n   */\r\n  saveImpressionsToLocalStorage() {\r\n    if (this.debouncedSave && typeof this.debouncedSave === 'function') {\r\n      this.debouncedSave();\r\n    }\r\n    else {\r\n      this.debouncedSave = debounce(this.saveImpressionsToLocalStorageImpl, 250, false);\r\n      this.debouncedSave();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Implementation of saving the impression map to localstorage\r\n   */\r\n  saveImpressionsToLocalStorageImpl() {\r\n    try {\r\n      localStorage.setItem(keys.impressions, JSON.stringify(this.impressions));\r\n    }\r\n    catch (err) {\r\n      /* In case of thrown 'SecurityError' or 'QuotaExceededError',\r\n       the operation should not break*/\r\n      console.error('localStorage isn\\'t available:', err); // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes the impression map based on the retrieved impressions and the global\r\n   * configuration.\r\n   */\r\n  initImpressionMap() {\r\n    Object.keys(this.config).map((key, index) => {\r\n      const adSlotId = key;\r\n      const slot = this.impressions[adSlotId];\r\n      let shouldUpdateExpiryDate = false;\r\n      // Case I: Existing slot (update)\r\n      if (slot) {\r\n        // Case I.I Existing slot, frequency has changed\r\n        if (this.config[adSlotId][keys.frequency] !== slot[keys.frequency]) {\r\n          // Updating the frequency will trigger a new expiry date\r\n          shouldUpdateExpiryDate = true;\r\n          this.impressions[adSlotId][keys.frequency] = this.config[adSlotId][keys.frequency];\r\n        } // Case I.II Existing slot, old expiry date\r\n        else if (this.now > slot[keys.expires]) {\r\n          // Old value that should trigger a new expiry date\r\n          shouldUpdateExpiryDate = true;\r\n        }\r\n      } // Case II: Non-existing slot (create new slot)\r\n      else {\r\n        this.initSlotFromConfig(adSlotId);\r\n      } // Finally, updates the expiry date (cases I.I and I.II)\r\n      if (shouldUpdateExpiryDate) {\r\n        this.updateExpiryDate(adSlotId);\r\n      }\r\n      return this;\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Updates the expiry date of a slotName based on the configured slot frequency\r\n   * @param {String} slotName - the slotName to update.\r\n   */\r\n  updateExpiryDate(slotName) {\r\n    const now = new Date();\r\n    if (!(this.impressions[slotName] && this.impressions[slotName][keys.frequency])) {\r\n      throw new Error(`Unable to update expiry date for slot: ${slotName}\r\n      - this.impressions[slotName]:`, this.impressions[slotName]);\r\n    }\r\n    const frequencyMap = this.impressions[slotName][keys.frequency].match(keys.frequencyRegex);\r\n    now.setMilliseconds(0);\r\n    now.setSeconds(0);\r\n    now.setMinutes(0);\r\n    if (frequencyMap.indexOf(keys.days) > -1) {\r\n      now.setHours(0);\r\n    }\r\n    this.impressions[slotName][keys.expires] = (frequencyMap.indexOf(keys.days) > -1 ?\r\n      addDays(now, frequencyMap[2]) : addHours(now, frequencyMap[2])).getTime();\r\n\r\n    // Set max impressions:\r\n    this.impressions[slotName][keys.maxImpressions] = parseInt(frequencyMap[1], 10);\r\n    // Reset exposed\r\n    this.impressions[slotName][keys.exposed] = 0;\r\n  }\r\n\r\n  /**\r\n   * Initializes a non-existing slot from the passed global configuration for the slot\r\n   * @param {String} slotName - the name of the slot to create\r\n   */\r\n  initSlotFromConfig(slotName) {\r\n    const slot = this.impressions[slotName] || {};\r\n    slot[keys.frequency] = this.config[slotName][keys.frequency];\r\n    slot[keys.target] = this.config[slotName][keys.target];\r\n    slot[keys.exposed] = 0;\r\n    this.impressions[slotName] = slot;\r\n    this.updateExpiryDate(slotName);\r\n  }\r\n\r\n  /**\r\n   * Registers an impression for a given adSlot.\r\n   * @param {String} adSlotId - the adSlot id to register an impression for\r\n   * @returns {boolean} returns true iff the impression has been registered\r\n   */\r\n  registerImpression(adSlotId) {\r\n    if (adSlotId) {\r\n      const slot = this.impressions[adSlotId];\r\n      if (slot) {\r\n        const exposed = slot[keys.exposed];\r\n        if (isNaN(parseInt(exposed, 10)) === false) {\r\n          this.impressions[adSlotId][keys.exposed] += 1;\r\n          try {\r\n            this.saveImpressionsToLocalStorage();\r\n          }\r\n          catch (err) {\r\n            // console.log('Error saving ad impressions to localStorage!', err);\r\n          }\r\n          return true;\r\n        }\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  /**\r\n   * Checks whether an adSlot has reached it's allocated impressions count.\r\n   * @param {String} adSlotId - the adSlot to check\r\n   * @returns {boolean} true iff there is a quota for the adSlot, and it has been reached\r\n   */\r\n  reachedQuota(adSlotId) {\r\n    // An adSlotId is suffixed with _homepage | _section if it's targeting is different\r\n    // between the two. If there is no difference, an _all suffix can be used.\r\n    const slotName = this.impressions[`${adSlotId}${globalConfig.department}`] ?\r\n      `${adSlotId}${globalConfig.department}` : `${adSlotId}_all`;\r\n\r\n    const slot = this.impressions[slotName];\r\n    let atQuota = false;\r\n    if (slot) {\r\n      const now = (new Date()).getTime();\r\n      // Second element of 2/4day matches '2'\r\n      const expires = this.impressions[slotName][keys.expires];\r\n      if (expires < now) {\r\n        this.updateExpiryDate(slotName);\r\n      }\r\n      else {\r\n        const maxImpressions = this.impressions[slotName][keys.maxImpressions];\r\n        // Not expired, did reach max impressions?\r\n        if (maxImpressions) {\r\n          atQuota = this.impressions[slotName][keys.exposed] >= maxImpressions;\r\n        }\r\n      }\r\n    }\r\n    return atQuota;\r\n  }\r\n\r\n\r\n  /**\r\n   * Clears the impression map from 'exposed' impressions\r\n   */\r\n  resetImpressions() {\r\n    const impressions = this.impressions;\r\n    for (const key in impressions) {\r\n      if ({}.hasOwnProperty.call(impressions, key)) {\r\n        if (impressions[key][keys.exposed]) {\r\n          impressions[key][keys.exposed] = 0;\r\n        }\r\n      }\r\n    }\r\n    this.saveImpressionsToLocalStorage();\r\n  }\r\n}\r\n","import getCookieAsMap from '../utils/cookieUtils';\r\nimport ImpressionManager from './impressionsManager';\r\nimport globalConfig from '../globalConfig';\r\n\r\nexport const userTypes = {\r\n  payer: 'payer',\r\n  registered: 'registered',\r\n  anonymous: 'anonymous',\r\n};\r\n\r\nexport default class User {\r\n  constructor(config) {\r\n    this.config = Object.assign({}, config.userConfig);\r\n    const cookieMap = getCookieAsMap();\r\n    this.ssoKey = globalConfig.sso;\r\n    if (!cookieMap[this.ssoKey]) {\r\n      // Flips the ssoKey, since cookieMap.ssoKey cannot be used to retrieve data\r\n      this.ssoKey = this.ssoKey === 'tmsso' ? 'engsso' : 'tmsso';\r\n    }\r\n    this.type = this.getUserType(cookieMap);\r\n    this.impressionManager = new ImpressionManager(config.impressionManagerConfig);\r\n    this.age = this.getUserAge(cookieMap);\r\n    this.gender = this.getUserGender(cookieMap);\r\n  }\r\n\r\n  getUserType(cookieMap) {\r\n    let userType;\r\n    if (cookieMap && cookieMap[this.ssoKey]) {\r\n      const payerProp = window.location.hostname.indexOf('haaretz.com') > -1 ?\r\n        'HdcPusr' : 'HtzPusr';\r\n      userType = cookieMap[payerProp] ? userTypes.payer : userTypes.registered;\r\n    }\r\n    else {\r\n      userType = userTypes.anonymous;\r\n    }\r\n    return userType;\r\n  }\r\n\r\n  getUserAge(cookieMap) {\r\n    let age;\r\n    const usrae = cookieMap[this.ssoKey] && cookieMap[this.ssoKey].usrae;\r\n    if (usrae) {\r\n      age = parseInt(cookieMap[this.ssoKey].usrae, 10);\r\n      age = age > 0 ? age : undefined;\r\n    }\r\n    return age;\r\n  }\r\n\r\n  getUserGender(cookieMap) {\r\n    let gender;\r\n    const urgdr = cookieMap[this.ssoKey] && cookieMap[this.ssoKey].urgdr;\r\n    if (urgdr) {\r\n      gender = parseInt(cookieMap[this.ssoKey].urgdr, 10);\r\n      gender = gender === 2 || gender === 1 ? gender : undefined;\r\n    }\r\n    return gender;\r\n  }\r\n}\r\n","class ConflictResolver {\r\n  constructor(conflictManagementConfig) {\r\n    this.dependencyMap = this.initializeDependencyMap(conflictManagementConfig);\r\n    this.deferredSlots = new Set();\r\n  }\r\n  initializeDependencyMap(conflictManagementJson) {\r\n    const queue = new Map();\r\n    Object.keys(conflictManagementJson).map((key, value) => {\r\n      let rules = conflictManagementJson[key];\r\n      if (rules) {\r\n        rules = rules.filter((item) => item.onsize && item.avoid);\r\n      }\r\n      queue.set(key, {\r\n        id: key,\r\n        rules,\r\n        resolvedWith: null,\r\n      });\r\n      return this;\r\n    });\r\n    return queue;\r\n  }\r\n\r\n  updateResolvedSlot(adSlotId, resolvedSize) {\r\n    if (!adSlotId) {\r\n      throw new Error('updateResolvedSlot must be called with an adSlotId!');\r\n    }\r\n    if (!resolvedSize) {\r\n      throw new Error('updateResolvedSlot must be called with a resolved size!');\r\n    }\r\n    if (this.dependencyMap.has(adSlotId)) {\r\n      this.dependencyMap.get(adSlotId).resolvedWith = resolvedSize;\r\n    }\r\n  }\r\n\r\n\r\n  isBlocked(adSlotId) {\r\n    if (!adSlotId) {\r\n      throw new Error('isBlocked must be called with an adSlotId!');\r\n    }\r\n    let isBlocked = false;\r\n    for (const adSlotKey of this.dependencyMap.keys()) {\r\n      const adSlot = this.dependencyMap.get(adSlotKey);\r\n      for (const adSlotRule of adSlot.rules) {\r\n        // Found rule specific to our target\r\n        if (adSlotRule.avoid === adSlotId) {\r\n          const parentResolvedWith = adSlot.resolvedWith;\r\n          // Fail fast: parent is not resolved yet - unknown returned size.\r\n          if (!parentResolvedWith) {\r\n            isBlocked = true;\r\n            this.deferredSlots.add(adSlotId);\r\n          }\r\n          if (adSlotRule.onsize.split(',').find(sizeString => { // eslint-disable-line\r\n            const size = sizeString.split('x').map(numberStr => parseInt(numberStr, 10));\r\n            return this.arraysEqual(size, parentResolvedWith);\r\n          })) {\r\n            // Block found\r\n            this.deferredSlots.add(adSlotId);\r\n            isBlocked = true;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return isBlocked;\r\n  }\r\n\r\n  isBlocking(adSlotId) {\r\n    if (!adSlotId) {\r\n      throw new Error('isBlocking must be called with an adSlotId!');\r\n    }\r\n    let isBlocking = false;\r\n    for (const adSlotKey of this.dependencyMap.keys()) {\r\n      if (adSlotKey === adSlotId) {\r\n        isBlocking = true;\r\n      }\r\n    }\r\n    return isBlocking;\r\n  }\r\n\r\n  /**\r\n   * Gets an array of adSlot Ids for a given adSlotId, that are dependent on (blocked by)\r\n   * @param {String} adSlotId - the blocking slot id\r\n   * @return {Array} an array of blocked slot, that has a dependency on the given slot\r\n   */\r\n  getBlockedSlotsIds(adSlotId) {\r\n    let result;\r\n    if (this.dependencyMap.has(adSlotId)) {\r\n      result = Array.from(this.dependencyMap.get(adSlotId).rules.map(adSlot => adSlot.avoid));\r\n    }\r\n    return result || [];\r\n  }\r\n\r\n  arraysEqual(a, b) {\r\n    if (a === b) return true;\r\n    if (a === null || b === null) return false;\r\n    if (a.length !== b.length) return false;\r\n    for (let i = 0; i < a.length; ++i) {\r\n      if (a[i] !== b[i]) return false;\r\n    }\r\n    return true;\r\n  }\r\n}\r\nConflictResolver.EMPTY_SIZE = [];\r\nexport default ConflictResolver;\r\n","/* global googletag */\r\nimport { adTypes } from '../objects/adManager';\r\nimport globalConfig from '../globalConfig';\r\nimport { arraysEqual } from '../utils/arrays';\r\n\r\nconst hiddenClass = globalConfig.site.indexOf('mouse') > -1 ? 'u-is-hidden' : 'h-hidden';\r\n\r\nexport default class adSlot {\r\n\r\n  constructor(adSlotConfig) {\r\n    this.config = Object.assign({}, adSlotConfig);\r\n\r\n    // Part I : Markup configuration - passed from AdManager\r\n    this.id = this.config.id;\r\n    if (!this.config.id) {\r\n      throw new Error('an adSlot requires an id!');\r\n    }\r\n    this.target = this.config.target;\r\n    this.type = this.config.type;\r\n    this.responsive = this.config.responsive;\r\n    this.fluid = this.config.fluid;\r\n    this.user = this.config.user;\r\n    this.adManager = this.config.adManager;\r\n    this.htmlElement = this.config.htmlElement;\r\n    this.priority = this.config.priority;\r\n    this.deferredSlot = this.config.deferredSlot;\r\n\r\n    // Part II : Global, general ad configuration - passed from AdManager\r\n    this.department = this.config.department;\r\n    this.network = this.config.network;\r\n    this.adUnitBase = this.config.adUnitBase;\r\n\r\n    // Part III : ad specific configuration - passed from globalConfig.adSlotConfig\r\n    this.adSizeMapping = this.config.adSizeMapping;\r\n    this.responsiveAdSizeMapping = this.config.responsiveAdSizeMapping;\r\n    this.blacklistReferrers = this.config.blacklistReferrers ?\r\n      this.config.blacklistReferrers.split(',') : [];\r\n    this.whitelistReferrers = this.config.whitelistReferrers ?\r\n      this.config.whitelistReferrers.split(',') : [];\r\n\r\n\r\n    // Part IV : Runtime configuration - calculated data - only present in runtime\r\n    this.lastResolvedSize = undefined; // Initialized in 'slotRenderEnded' callback\r\n    this.lastResolvedWithBreakpoint = undefined; // Initialized in 'slotRenderEnded' callback\r\n    this.slot = undefined; // Holds a googletag.Slot object\r\n    // [https://developers.google.com/doubleclick-gpt/reference#googletag.Slot]\r\n    try {\r\n      if (!this.deferredSlot) {\r\n        this.slot = this.defineSlot();\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.error(err); // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks whether this adSlot is an 'Out-of-page' slot or not.\r\n   * An Out-of-page slot is a slot that is not embedded in the page 'normally'.\r\n   * @returns {boolean} true iff this adSlot is one of the predefined 'out-of-page' slots.\r\n   */\r\n  isOutOfPage() {\r\n    if (typeof this.type !== 'string') {\r\n      throw new Error('An adSlot cannot by typeless!', this);\r\n    }\r\n    if (this.isMobile() === true) {\r\n      return false;\r\n    }\r\n    switch (this.type) {\r\n      case adTypes.maavaron: return false;\r\n      case adTypes.popunder: return true;\r\n      case adTypes.talkback: return false;\r\n      case adTypes.regular: return false;\r\n      default: return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Checks whether this adSlot is a 'maavaron' slot or not.\r\n   * An Out-of-page slot is a slot that is not embedded in the page 'normally'.\r\n   * @returns {boolean} true iff this adSlot is one of the predefined 'out-of-page' slots.\r\n   */\r\n  isMaavaron() {\r\n    if (typeof this.type !== 'string') {\r\n      throw new Error('An adSlot cannot by typeless!', this);\r\n    }\r\n    if (this.isMobile() === true) {\r\n      return false;\r\n    }\r\n    switch (this.type) {\r\n      case adTypes.maavaron: return false;\r\n      default: return false;\r\n    }\r\n  }\r\n\r\n  isMobile() {\r\n    return (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i\r\n      .test(window.navigator.userAgent || ''));\r\n  }\r\n  /**\r\n   * Checks whether or not this adSlot has a non-empty whitelist, and if so, that the current\r\n   * referrer appears in the whitelist.\r\n   * Should return false iff there is a whitelist for the current adSlot, but the referrer is not\r\n   * mentioned in the whitelist.\r\n   * @returns {boolean} true iff the ad can be displayed.\r\n   */\r\n  isWhitelisted() {\r\n    let whitelisted = false;\r\n    if (this.whitelistReferrers.length !== 0) {\r\n      for (const referrer of this.whitelistReferrers) {\r\n        if (globalConfig.referrer.indexOf(referrer) > -1) {\r\n          whitelisted = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    else {\r\n      whitelisted = true;\r\n    }\r\n    return whitelisted;\r\n  }\r\n\r\n  /**\r\n   * Checks whether or not this adSlot has a non-empty blacklist, and if so, that the current\r\n   * referrer does not appear in the blacklist.\r\n   * Should return true iff there is a blacklist for the current adSlot, and the referrer is\r\n   * mentioned in the blacklist - to indicate that the adSlot is 'blocked'.\r\n   * @returns {boolean} true iff the ad cannot be displayed.\r\n   */\r\n  isBlacklisted() {\r\n    let blacklisted = false;\r\n    if (this.blacklistReferrers.length !== 0) {\r\n      for (const referrer of this.blacklistReferrers) {\r\n        if (globalConfig.referrer.indexOf(referrer) > -1) {\r\n          blacklisted = true;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    return blacklisted;\r\n  }\r\n\r\n\r\n  /**\r\n   * Shows the current adSlot.\r\n   * It assumes a markup is available for this slot (any tag with an id attribute = this.id)\r\n   */\r\n  show() {\r\n    if (!this.shown === true) {\r\n      this.shown = true; // Ensure show will be called once per adSlot\r\n      googletag.cmd.push(() => {\r\n        if (this.deferredSlot) {\r\n          this.slot = this.defineSlot();\r\n        }\r\n        // console.log('calling show for slot',this.id,' called @',window.performance.now());\r\n        document.getElementById(this.id).classList.remove(hiddenClass);\r\n        googletag.display(this.id);\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows the current adSlot.\r\n   * It assumes a markup is available for this slot (any tag with an id attribute = this.id)\r\n   */\r\n  hide() {\r\n    googletag.cmd.push(() => {\r\n      document.getElementById(this.id).classList.add(hiddenClass);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initializes page-level slot definition for the current slot\r\n   * @return {Slot} slot - the Google Slot that was defined from this AdSlot configuration\r\n   */\r\n  defineSlot() {\r\n    if (this.isMaavaron()) {\r\n      const maavaronSlot = this.defineMaavaron();\r\n      if (this.adManager.shouldSendRequestToDfp(this)) {\r\n        if (!this.shown) {\r\n          this.shown = true; // Ensure show will be called once\r\n          maavaronSlot.display();\r\n        }\r\n      }\r\n      return maavaronSlot;\r\n    }\r\n    const googletag = window.googletag;\r\n    const pubads = googletag.pubads();\r\n    const args = [];\r\n    const defineFn = this.isOutOfPage() ? googletag.defineOutOfPageSlot : googletag.defineSlot;\r\n    // 3 or 2 params according to the function that we want to activate.\r\n    args.push(this.getPath());\r\n    if (this.isOutOfPage() === false) {\r\n      if (this.fluid) {\r\n        args.push('fluid');\r\n      }\r\n      else {\r\n        args.push(this.adSizeMapping);\r\n      }\r\n    }\r\n    args.push(this.id);\r\n    let slot = defineFn.apply(defineFn, args);\r\n    if (slot) {\r\n      // Responsive size Mapping\r\n      if (this.responsive) {\r\n        let responsiveSlotSizeMapping = googletag.sizeMapping();\r\n        const breakpoints = globalConfig.breakpointsConfig.breakpoints;\r\n        const keys = Object.keys(this.responsiveAdSizeMapping);\r\n        for (const key of keys) { // ['xxs','xs',...]\r\n          responsiveSlotSizeMapping.addSize(\r\n            [breakpoints[key], 100], // 100 is a default height, since it is height agnostic\r\n            !arraysEqual(this.responsiveAdSizeMapping[key], [[0, 0]]) ?\r\n              this.responsiveAdSizeMapping[key] : []);\r\n        }\r\n        responsiveSlotSizeMapping = responsiveSlotSizeMapping.build();\r\n        slot = slot.defineSizeMapping(responsiveSlotSizeMapping);\r\n      }\r\n      slot = slot.addService(pubads);\r\n      if (this.isOutOfPage() === false) {\r\n        slot.setCollapseEmptyDiv(true);\r\n      }\r\n    }\r\n    return slot;\r\n  }\r\n\r\n  /**\r\n   * Returns the current path calculated for the adSlot\r\n   * @returns {String} a formatted string that represent the path for the slot definition\r\n   */\r\n  getPath() {\r\n    /* eslint-disable no-shadow */\r\n    let path = globalConfig.path || [];\r\n    path = path.filter(path => path !== '.');\r\n    path = path.map(section => `${this.id}${this.department}${section}`).join('/');\r\n    // If a path exist, it will be preceded with a forward slash\r\n    path = path && this.config.department !== '_homepage' ? `/${path}` : '';\r\n    /* eslint-enable no-shadow */\r\n    const calculatedPath = `/${this.config.network}/${this.config.adUnitBase}/${this.id}/${this.id}${this.department}${path}`; // eslint-disable-line max-len\r\n    return calculatedPath.toLowerCase();\r\n  }\r\n\r\n  /* eslint-disable */\r\n  slotRendered(event) {\r\n    const id = event.slot.getAdUnitPath().split('/')[3]; // Convention: [0]/[1]network/[2]base/[3]id\r\n    const isEmpty = event.isEmpty; // Did the ad return as empty?\r\n    const resolvedSize = event.size; // What 'creative' size did the ad return with?\r\n    // Empty or onload callback should be called next?\r\n  }\r\n  /* eslint-enable */\r\n\r\n  /**\r\n   * Refresh this adSlot\r\n   */\r\n  refresh() {\r\n    googletag.cmd.push(() => {\r\n      googletag.pubads().refresh([this.slot]);\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Shows 'Maavaron' type adSlot using Passback definition\r\n   * @return {Slot} slot - the Google Slot that was defined for Maavaron\r\n   */\r\n  defineMaavaron() {\r\n    if (!document.referrer.match('loc.haaretz')) {\r\n      const adUnitMaavaronPath = this.getPath();\r\n      const adUnitMaavaronSize = [\r\n        [2, 1],\r\n      ];\r\n      const slot = googletag.pubads().definePassback(adUnitMaavaronPath, adUnitMaavaronSize)\r\n        .setTargeting('UserType', [this.user.type])\r\n        .setTargeting('age', [this.user.age])\r\n        .setTargeting('urgdr', [this.user.gender])\r\n        .setTargeting('articleId', [globalConfig.articleId])\r\n        .setTargeting('stg', [globalConfig.environment]);\r\n      return slot;\r\n    }\r\n    return null;\r\n  }\r\n}\r\n","/* global googletag */\r\nimport User from '../objects/user';\r\nimport ConflictResolver from '../objects/conflictResolver';\r\nimport AdSlot from '../objects/adSlot';\r\nimport { getBreakpoint, getBreakpointName } from '../utils/breakpoints';\r\nimport { arraysEqual } from '../utils/arrays';\r\n\r\n// There are a total of 7 adTargets:\r\n// \"all\",\"nonPaying\",\"anonymous\",\"registered\",\"paying\",\"digitalOnly\" and \"digitalAndPrint\"\r\nexport const adPriorities = {\r\n  high: 'high',\r\n  normal: 'normal',\r\n  low: 'low',\r\n};\r\n\r\nexport const adTargets = {\r\n  all: 'all',\r\n  nonPaying: 'nonPaying',\r\n  anonymous: 'anonymous',\r\n  registered: 'registered',\r\n  paying: 'paying',\r\n  digitalOnly: 'digitalOnly',\r\n  digitalAndPrint: 'digitalAndPrint',\r\n};\r\n\r\n// There are a total of 3 userTypes: \"anonymous\", \"registered\" and \"payer\"\r\nexport const userTypes = {\r\n  anonymous: 'anonymous',\r\n  registered: 'registered',\r\n  payer: 'payer',\r\n};\r\n\r\nexport const adTypes = {\r\n  maavaron: '.maavaron',\r\n  popunder: '.popunder',\r\n  talkback: '.talkback',\r\n  regular: '',\r\n};\r\n\r\n\r\nexport default class AdManager {\r\n\r\n  constructor(config) {\r\n    this.config = Object.assign({}, config);\r\n    this.user = new User(config);\r\n    this.conflictResolver = new ConflictResolver(config.conflictManagementConfig);\r\n    /**\r\n     * Avoid race conditions by making sure to respect the usual timing of GPT.\r\n     * This DFP implementation uses Enable-Define-Display:\r\n     * Define page-level settings\r\n     * enableServices()\r\n     * Define slots\r\n     * Display slots\r\n     */\r\n    try {\r\n      googletag.cmd.push(() => {\r\n        this.initGoogleTargetingParams(); //  Define page-level settings\r\n        this.initGoogleGlobalSettings();  //  enableServices()\r\n        this.initSlotRenderedCallback();  //  Define callbacks\r\n      });\r\n      // Mouse special treatment to base path on mobile breakpoints\r\n      const currentBreakpointName = getBreakpointName(getBreakpoint());\r\n      if (this.config.adManagerConfig.adUnitBase.indexOf('mouse.co.il') > -1 &&\r\n        currentBreakpointName.indexOf('xs') > -1) {\r\n        this.config.adManagerConfig.adUnitBase = 'mouse.co.il.mobile_web';\r\n      }\r\n      // Holds adSlot objects as soon as possible.\r\n      googletag.cmd.push(() => {\r\n        this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.high);\r\n      });\r\n      // Once DOM ready, add more adSlots.\r\n      const onDomLoaded = () => { // eslint-disable-line no-inner-declarations\r\n        try {\r\n          googletag.cmd.push(() => {\r\n            this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.high);\r\n            googletag.cmd.push(() => {\r\n              this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.normal);\r\n            });\r\n          });\r\n        }\r\n        catch (err) {\r\n          console.log(err); // eslint-disable-line no-console\r\n        }\r\n      };\r\n      // Once window was loaded, add the rest of the adSlots.\r\n      const onWindowLoaded = () => { // eslint-disable-line no-inner-declarations\r\n        googletag.cmd.push(() => {\r\n          this.adSlots = this.initAdSlots(config.adSlotConfig, adPriorities.low);\r\n        });\r\n      };\r\n      switch (document.readyState) {\r\n        case 'loading':\r\n          document.addEventListener('DOMContentLoaded', onDomLoaded);\r\n          window.addEventListener('load', onWindowLoaded);\r\n          break;\r\n        case 'interactive':\r\n          onDomLoaded();\r\n          window.addEventListener('load', onWindowLoaded);\r\n          break;\r\n        default: // 'complete' - no need for event listeners.\r\n          onDomLoaded();\r\n          onWindowLoaded();\r\n      }\r\n    }\r\n    catch (err) {\r\n      console.error(err); // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Shows all of the adSlots that can be displayed.\r\n   */\r\n  showAllSlots() {\r\n    for (const adSlotKey of this.adSlots.keys()) {\r\n      const adSlot = this.adSlots.get(adSlotKey);\r\n      if (adSlot.type !== adTypes.talkback && this.shouldSendRequestToDfp(adSlot)) {\r\n        adSlot.show();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Gets all adSlots that has a certain priority\r\n   * @param {adPriority} priority - the priority of the ad {high, normal, low}\r\n   * @return {Array<AdSlot>} adSlots - all of the defined adSlots that matches\r\n   * the given priority\r\n   */\r\n  getAdSlotsByPriority(priority) {\r\n    function priorityFilter(adSlot) {\r\n      return adSlot.priority === priority;\r\n    }\r\n    return Array.from(this.adSlots.values()).filter(priorityFilter);\r\n  }\r\n\r\n  showAllDeferredSlots() {\r\n    for (const deferredSlotId of this.conflictResolver.deferredSlots) {\r\n      if (this.adSlots.has(deferredSlotId)) {\r\n        if (!this.conflictResolver.isBlocked(deferredSlotId)) {\r\n          const deferredAdSlot = this.adSlots.get(deferredSlotId);\r\n          if (this.shouldSendRequestToDfp(deferredAdSlot)) {\r\n            deferredAdSlot.show();\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes all responsive adSlots\r\n   */\r\n  refreshAllSlots() {\r\n    const currentBreakpoint = getBreakpoint();\r\n    for (const adSlotKey of this.adSlots.keys()) {\r\n      const adSlot = this.adSlots.get(adSlotKey);\r\n      if (adSlot.responsive && adSlot.type !== adTypes.maavaron) {\r\n        if (adSlot.lastResolvedWithBreakpoint !== currentBreakpoint &&\r\n          this.shouldSendRequestToDfp(adSlot)) {\r\n          // console.log(`calling refresh for adSlot: ${adSlot.id}`);\r\n          adSlot.refresh();\r\n        }\r\n        else {\r\n          adSlot.hide();\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Refreshes all adSlots\r\n   */\r\n  refreshAllSlotsInPage() {\r\n    for (const adSlotKey of this.adSlots.keys()) {\r\n      const adSlot = this.adSlots.get(adSlotKey);\r\n      if (this.shouldSendRequestToDfp(adSlot)) {\r\n        // console.log(`calling refresh for adSlot: ${adSlot.id}`);\r\n        adSlot.refresh();\r\n      }\r\n      else {\r\n        adSlot.hide();\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes adSlots based on the currently found slot markup (HTML page specific),\r\n   * and the predefined configuration for the slots.\r\n   * @param {Object} adSlotConfig - the AdSlots configuration object (see: globalConfig)\r\n   * @param {String} filteredPriority - filters out all adSlots that does not match\r\n   * a given adPriority. This is used to cherry pick the init process of ads.\r\n   * @returns {Map}\r\n   */\r\n  initAdSlots(adSlotConfig, filteredPriority) {\r\n    const adSlots = new Map(this.adSlots);\r\n    let adSlotPlaceholders = Array.from(document.getElementsByClassName('js-dfp-ad'));\r\n    adSlotPlaceholders = adSlotPlaceholders.filter(node => node.id); // only nodes with an id\r\n    const adSlotNodeSet = new Set();\r\n    adSlotPlaceholders = Array.prototype.filter.call(adSlotPlaceholders, node => {\r\n      if (adSlotNodeSet.has(node.id) === false) { // first occurrence of Node\r\n        adSlotNodeSet.add(node.id);\r\n        return true;\r\n      }\r\n      return false;\r\n    });\r\n    // adSlotPlaceholders = adSlotPlaceholders.sort((a, b) => a.offsetTop - b.offsetTop);\r\n    adSlotPlaceholders.forEach(adSlot => {\r\n      const adSlotPriority = adSlotConfig[adSlot.id] ?\r\n      adSlotConfig[adSlot.id].priority || adPriorities.normal : undefined;\r\n      if (adSlotConfig[adSlot.id] && adSlots.has(adSlot.id) === false &&\r\n        adSlotPriority === filteredPriority) {\r\n        // The markup has a matching configuration from adSlotConfig AND was not already defined\r\n        try {\r\n          // adSlotConfig is built from globalConfig, but can be overridden by markup\r\n          const computedAdSlotConfig = Object.assign({}, adSlotConfig[adSlot.id], {\r\n            id: adSlot.id,\r\n            target: adSlot.attributes['data-audtarget'] ?\r\n              adSlot.attributes['data-audtarget'].value : adTargets.all,\r\n            type: this.getAdType(adSlot.id),\r\n            responsive: adSlotConfig[adSlot.id].responsive,\r\n            fluid: adSlotConfig[adSlot.id].fluid || false,\r\n            user: this.user,\r\n            adManager: this,\r\n            htmlElement: adSlot,\r\n            department: this.config.department,\r\n            network: this.config.adManagerConfig.network,\r\n            adUnitBase: this.config.adManagerConfig.adUnitBase,\r\n            deferredSlot: this.conflictResolver.isBlocked(adSlot.id),\r\n            priority: adSlotPriority,\r\n          });\r\n          const adSlotInstance = new AdSlot(computedAdSlotConfig);\r\n          adSlots.set(adSlot.id, adSlotInstance);\r\n          if (adSlotInstance.type !== adTypes.talkback &&\r\n            adSlotInstance.priority === adPriorities.high &&\r\n            this.shouldSendRequestToDfp(adSlotInstance)) {\r\n            /*\r\n             console.log('calling show for high priority slot', adSlotInstance.id, ' called @',\r\n             window.performance.now());\r\n             */\r\n            adSlotInstance.show();\r\n          }\r\n        }\r\n        catch (err) {\r\n          console.error(err); // eslint-disable-line no-console\r\n        }\r\n      }\r\n    });\r\n    return adSlots;\r\n  }\r\n\r\n  isPriority(adSlotId) {\r\n    return (typeof adSlotId === 'string' &&\r\n    (adSlotId.indexOf('plazma') > 0 ||\r\n    adSlotId.indexOf('maavaron') > 0 ||\r\n    adSlotId.indexOf('popunder') > 0));\r\n  }\r\n\r\n  /**\r\n   * Returns the adType based on the adSlot name.\r\n   * @param {String} adSlotId - the adSlot's identifier.\r\n   * @returns {*} enumerated export 'adTypes'\r\n   */\r\n  getAdType(adSlotId) {\r\n    if (!adSlotId) {\r\n      throw new Error('Missing argument: a call to getAdType must have an adSlotId');\r\n    }\r\n    if (adSlotId.indexOf(adTypes.maavaron) > -1) return adTypes.maavaron;\r\n    if (adSlotId.indexOf(adTypes.popunder) > -1) return adTypes.popunder;\r\n    if (adSlotId.indexOf(adTypes.talkback) > -1) return adTypes.talkback;\r\n    return adTypes.regular;\r\n  }\r\n\r\n  /**\r\n   * @param {object} adSlot the AdSlot\r\n   * @returns {boolean|*}\r\n   */\r\n  shouldSendRequestToDfp(adSlot) {\r\n    // Conflict management check\r\n    return this.conflictResolver.isBlocked(adSlot.id) === false &&\r\n      // Valid Referrer check\r\n      adSlot.isWhitelisted() &&\r\n      // Not in referrer Blacklist\r\n      adSlot.isBlacklisted() === false &&\r\n      this.shouldDisplayAdAfterAdBlockRemoval(adSlot) &&\r\n      // Responsive: breakpoint contains ad?\r\n      this.doesBreakpointContainAd(adSlot) &&\r\n      // Targeting check (userType vs. slotTargeting)\r\n      this.doesUserTypeMatchBannerTargeting(adSlot) &&\r\n      // Impressions Manager check (limits number of impressions per slot)\r\n      this.user.impressionManager.reachedQuota(adSlot.id) === false;\r\n  }\r\n\r\n  shouldDisplayAdAfterAdBlockRemoval(adSlot) {\r\n    return !(this.config.adBlockRemoved === true &&\r\n    (adSlot.type === adTypes.maavaron ||\r\n    adSlot.type === adTypes.popunder));\r\n  }\r\n\r\n  /**\r\n   * Check whether or not an ad slot should appear for the current user type\r\n   * @param {String} adSlotOrTarget the adSlot to check or the target as a string\r\n   * @returns {boolean} true iff the slot should appear for the user type\r\n   */\r\n  doesUserTypeMatchBannerTargeting(adSlotOrTarget) {\r\n    const userType = this.user.type;\r\n    const adTarget = typeof adSlotOrTarget === 'string' ? adSlotOrTarget : adSlotOrTarget.target;\r\n\r\n    switch (adTarget) {\r\n      case adTargets.all : return true;\r\n      case adTargets.nonPaying :\r\n        return userType === userTypes.anonymous || userType === userTypes.registered;\r\n      case adTargets.anonymous : return userType === userTypes.anonymous;\r\n      case adTargets.registered : return userType === userTypes.registered;\r\n      case adTargets.paying : return userType === userTypes.payer;\r\n      case adTargets.digitalOnly : return userType === userTypes.payer;\r\n      case adTargets.digitalAndPrint : return userType === userTypes.payer;\r\n      default: return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Report to the AdManager that a breakpoint has been switched (passed from one break to\r\n   * another). Should there be a responsive slot with a\r\n   * @param {Breakpoint} breakpoint - the breakpoint that is currently being displayed\r\n   * @returns {Integer} affected - the number of adSlots affected by the change\r\n   */\r\n  switchedToBreakpoint(breakpoint) {\r\n    if (!breakpoint) {\r\n      throw new Error('Missing argument: a call to switchedToBreakpoint must have an breakpoint');\r\n    }\r\n    let count = 0;\r\n    for (const adSlotKey of this.adSlots.keys()) {\r\n      const adSlot = this.adSlots.get(adSlotKey);\r\n      if (adSlot.responsive === true && adSlot.lastResolvedWithBreakpoint) {\r\n        if (adSlot.lastResolvedWithBreakpoint !== breakpoint) {\r\n          adSlot.refresh();\r\n          count++;\r\n        }\r\n      }\r\n    }\r\n    return count;\r\n  }\r\n\r\n  /**\r\n   * Checks whether an adSlot is defined for a given breakpoint (Default: current breakpoint)\r\n   * @param {AdSlot} adSlot - the adSlot to check.\r\n   * @param {Breakpoint} [breakpoint=currentBreakpoint] - the breakpoint to check this ad in.\r\n   * @returns {boolean} true iff the adSlot is defined for the given breakpoint.\r\n   */\r\n  doesBreakpointContainAd(adSlot, breakpoint = getBreakpoint()) {\r\n    if (!adSlot) {\r\n      throw new Error('Missing argument: a call to doesBreakpointContainAd must have an adSlot');\r\n    }\r\n    let containsBreakpoint = true;\r\n    if (adSlot.responsive === true) {\r\n      const mapping = adSlot.responsiveAdSizeMapping[getBreakpointName(breakpoint)];\r\n      if (Array.isArray(mapping) === false) {\r\n        throw new Error(`Invalid argument: breakpoint:${breakpoint} doesn't exist!`, this);\r\n      }\r\n      containsBreakpoint = mapping.length > 0 && !arraysEqual(mapping, [[0, 0]]);\r\n    }\r\n    return containsBreakpoint;\r\n  }\r\n\r\n  /**\r\n   * Initializes the callback from the 'slotRenderEnded' event for each slot\r\n   */\r\n  initSlotRenderedCallback() {\r\n    if (window.googletag && window.googletag.apiReady) {\r\n      const pubads = window.googletag.pubads();\r\n      pubads.addEventListener('slotRenderEnded', event => {\r\n        const id = event.slot.getAdUnitPath().split('/')[3];\r\n        const isEmpty = event.isEmpty;\r\n        const resolvedSize = event.size;\r\n        // console.log('slotRenderEnded for slot',id,' called @',window.performance.now());\r\n        if (this.adSlots.has(id)) {\r\n          const adSlot = this.adSlots.get(id);\r\n          adSlot.lastResolvedSize = resolvedSize;\r\n          adSlot.lastResolvedWithBreakpoint = getBreakpoint();\r\n          if (isEmpty) {\r\n            adSlot.lastResolvedSize = ConflictResolver.EMPTY_SIZE;\r\n            adSlot.hide();\r\n            this.releaseSlotDependencies(adSlot);\r\n          }\r\n          else {\r\n            this.user.impressionManager.registerImpression(`${adSlot.id}${this.config.department}`);\r\n            this.user.impressionManager.registerImpression(`${adSlot.id}_all`);\r\n            this.releaseSlotDependencies(adSlot, adSlot.lastResolvedSize);\r\n          }\r\n        }\r\n        else {\r\n          /*\r\n           console.error(`Cannot find an adSlot with id: ${id} - Ad Unit path is\r\n           ${event.slot.getAdUnitPath()}`);\r\n           */\r\n        }\r\n      });\r\n    }\r\n    else {\r\n      throw new Error('googletag api was not ready when \\'initSlotRenderedCallback\\' was called!');\r\n    }\r\n  }\r\n\r\n  releaseSlotDependencies(adSlot) {\r\n    try {\r\n      const id = adSlot.id;\r\n      this.conflictResolver.updateResolvedSlot(id, adSlot.lastResolvedSize);\r\n      if (this.conflictResolver.isBlocking(id)) {\r\n        // Hide all blocked adSlots\r\n        for (const blockedSlot of this.conflictResolver.getBlockedSlotsIds(id)) {\r\n          if (this.conflictResolver.isBlocked(blockedSlot)) {\r\n            if (this.adSlots.has(blockedSlot)) {\r\n              this.adSlots.get(blockedSlot).hide();\r\n            }\r\n          }\r\n        }\r\n        // Show the non blocked\r\n        for (const deferredSlotKey of this.conflictResolver.deferredSlots.keys()) {\r\n          const deferredAdSlot = this.adSlots.get(deferredSlotKey);\r\n          if (deferredAdSlot && this.shouldSendRequestToDfp(deferredAdSlot)) {\r\n            this.conflictResolver.deferredSlots.delete(deferredSlotKey);\r\n            if (deferredAdSlot.deferredSlot) {\r\n              deferredAdSlot.defineSlot();\r\n              deferredAdSlot.deferredSlot = false;\r\n            }\r\n            deferredAdSlot.show();\r\n          }\r\n        }\r\n      }\r\n    }\r\n    catch (err) {\r\n      /* eslint-disable no-console*/\r\n      console.error(`Cannot updateSlotDependencies for adSlot: ${adSlot.id}`);\r\n      /* eslint-enable no-console*/\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes page-level targeting params.\r\n   */\r\n  initGoogleTargetingParams() {\r\n    if (window.googletag && window.googletag.apiReady) {\r\n      // Returns a reference to the pubads service.\r\n      const pubads = googletag.pubads();\r\n      // Environment targeting (dev, test, prod)\r\n      if (this.config.environment) {\r\n        pubads.setTargeting('stg', [this.config.environment]);\r\n      }\r\n\r\n      // User targeting\r\n      if (this.user.type) {\r\n        pubads.setTargeting('UserType', [this.user.type]);\r\n      }\r\n      if (this.user.age) {\r\n        pubads.setTargeting('age', [this.user.age]);\r\n      }\r\n      if (this.user.gender) {\r\n        pubads.setTargeting('urgdr', [this.user.gender]);\r\n      }\r\n\r\n      // Context targeting\r\n      if (this.config.articleId) {\r\n        pubads.setTargeting('articleId', [this.config.articleId]);\r\n      }\r\n      if (this.config.gStatCampaignNumber && this.config.gStatCampaignNumber !== -1) {\r\n        pubads.setTargeting('gstat_campaign_id', [this.config.gStatCampaignNumber]);\r\n      }\r\n      if (this.config.isWriterAlerts) {\r\n        pubads.setTargeting('WriterAlerts', ['true']);\r\n      }\r\n      // UTM targeting\r\n      /* eslint-disable no-underscore-dangle */\r\n      if (this.config.utm_.content) {\r\n        pubads.setTargeting('utm_content', [this.config.utm_.content]);\r\n      }\r\n      if (this.config.utm_.source) {\r\n        pubads.setTargeting('utm_source', [this.config.utm_.source]);\r\n      }\r\n      if (this.config.utm_.medium) {\r\n        pubads.setTargeting('utm_medium', [this.config.utm_.medium]);\r\n      }\r\n      if (this.config.utm_.campaign) {\r\n        pubads.setTargeting('utm_campaign', [this.config.utm_.campaign]);\r\n      }\r\n      /* eslint-enable no-underscore-dangle */\r\n      // AdBlock removal\r\n      if (this.config.adBlockRemoved) {\r\n        pubads.setTargeting('adblock_removed', [this.config.adBlockRemoved]);\r\n      }\r\n      // University targeting - triggered via cookie\r\n      if (this.config.wifiLocation) {\r\n        pubads.setTargeting('wifi', [this.config.wifiLocation]);\r\n      }\r\n\r\n      // Ads Centering\r\n      pubads.setCentering(true);\r\n    }\r\n    else {\r\n      throw new Error('googletag api was not ready when \\'initGoogleTargetingParams\\' was called!');\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Initializes googletag services.\r\n   */\r\n  initGoogleGlobalSettings() {\r\n    if (window.googletag && window.googletag.apiReady) {\r\n      const googleGlobalSettings = this.config.googleGlobalSettings;\r\n      // Enable GET parameter overrides\r\n      if (window.location.search) {\r\n        const search = window.location.search;\r\n        if (search.indexOf('sraon') > 0) {\r\n          console.log('Single Request Mode: active'); // eslint-disable-line no-console\r\n          googleGlobalSettings.enableSingleRequest = true;\r\n        }\r\n        else if (search.indexOf('sraoff') > 0) {\r\n          console.log('Single Request Mode: disabled');// eslint-disable-line no-console\r\n          googleGlobalSettings.enableSingleRequest = false;\r\n        }\r\n        if (search.indexOf('asyncrenderingon') > 0) {\r\n          console.log('Async rendering mode: active'); // eslint-disable-line no-console\r\n          googleGlobalSettings.enableAsyncRendering = true;\r\n        }\r\n        else if (search.indexOf('asyncrenderingonoff') > 0) {\r\n          console.log('Sync rendering mode: active');// eslint-disable-line no-console\r\n          googleGlobalSettings.enableAsyncRendering = false;\r\n        }\r\n      }\r\n      // Google services activation\r\n      if (googleGlobalSettings.enableSingleRequest === true) {\r\n        googletag.pubads().enableSingleRequest();\r\n      }\r\n      if (googleGlobalSettings.enableAsyncRendering === true) {\r\n        googletag.pubads().enableAsyncRendering();\r\n      }\r\n      else {\r\n        googletag.pubads().enableSyncRendering();\r\n      }\r\n      // Enables all GPT services that have been defined for ad slots on the page.\r\n      googletag.enableServices();\r\n    }\r\n    else {\r\n      throw new Error('googletag api wasn\\'t ready when \\'initGoogleGlobalSettings\\' was called!');\r\n    }\r\n  }\r\n}\r\n","/* globals googletag */\r\nimport AdManager from '../src/objects/adManager';\r\nimport globalConfig from './globalConfig';\r\nimport { getBreakpoint, debounce } from '../src/utils/breakpoints';\r\n\r\nconst defaultConfig = globalConfig || {};\r\nconst resizeTimeout = 250;\r\n\r\nexport default class DFP {\r\n\r\n  constructor(config) {\r\n    this.config = Object.assign({}, defaultConfig, config);\r\n    this.wasInitialized = false;\r\n    this.initStarted = false;\r\n    this.breakpoint = getBreakpoint();\r\n    this.initWindowResizeListener();\r\n  }\r\n\r\n  /**\r\n   * This part of the object's construction is dependent on the call to 'init'\r\n   */\r\n  resumeInit() {\r\n    try {\r\n      this.adManager = this.adManager || new AdManager(this.config);\r\n    }\r\n    catch (err) {\r\n      console.error(err); // eslint-disable-line no-console\r\n    }\r\n  }\r\n\r\n  /**\r\n   * initializes the 'googletag' global namespace and add the\r\n   * google publish tags library to the page\r\n   * @returns {Promise} that resolves to true once the googletag api is ready to use\r\n   * (googletag.apiReady = true)\r\n   */\r\n  initGoogleTag() {\r\n    const dfpThis = this;\r\n    return new Promise((resolve, reject) => {\r\n      if (dfpThis.initStarted === true) {\r\n        googletag.cmd.push(() => {\r\n          dfpThis.wasInitialized = true;\r\n          resolve(dfpThis);\r\n        });\r\n      }\r\n      else {\r\n        dfpThis.initStarted = true;\r\n        // set up a place holder for the gpt code downloaded from google\r\n        window.googletag = window.googletag || {};\r\n\r\n        // this is a command queue used by GPT any methods added to it will be\r\n        // executed when GPT code is available, if GPT is already available they\r\n        // will be executed immediately\r\n        window.googletag.cmd = window.googletag.cmd || [];\r\n        // load google tag services JavaScript\r\n        (() => {\r\n          const tag = window.document.createElement('script');\r\n          tag.async = true;\r\n          tag.type = 'text/javascript';\r\n          // Supports both https and http\r\n          tag.setAttribute('src', '//www.googletagservices.com/tag/js/gpt.js');\r\n          const node = window.document.getElementsByTagName('script')[0];\r\n          tag.addEventListener('load', () => {\r\n            dfpThis.resumeInit();\r\n            googletag.cmd.push(() => {\r\n              dfpThis.wasInitialized = true;\r\n              resolve(this);\r\n            });\r\n          });\r\n          tag.addEventListener('error', (error) => {\r\n            dfpThis.wasInitialized = false;\r\n            reject(error);\r\n          });\r\n          node.parentNode.insertBefore(tag, node);\r\n        })();\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   *  Returns true iff googletag was properly initialized on the page\r\n   * @returns {boolean}\r\n   */\r\n  isGoogleTagReady() {\r\n    if (this.wasInitialized === true || (window.googletag && window.googletag.apiReady)) {\r\n      this.wasInitialized = true;\r\n    }\r\n    return this.wasInitialized;\r\n  }\r\n\r\n  /**\r\n   * Initializes the window resize listener to support responsive ad refreshes\r\n   */\r\n  initWindowResizeListener() {\r\n    const dfpThis = this;\r\n    function onResize() {\r\n      const currentBreakpoint = getBreakpoint();\r\n      if (dfpThis.breakpoint !== currentBreakpoint) {\r\n        dfpThis.breakpoint = currentBreakpoint;\r\n        if (dfpThis.adManager) {\r\n          dfpThis.adManager.refreshAllSlots();\r\n        }\r\n        else {\r\n          throw new Error('initWindowResizeListener error - adManager instance is not available');\r\n        }\r\n      }\r\n    }\r\n    const debouncedFunction = debounce(onResize, resizeTimeout);\r\n    window.onresize = debouncedFunction;\r\n  }\r\n}\r\n","import DFP from './dfp';\r\nimport globalConfig from './globalConfig';\r\nimport { version as v } from './../package.json';\r\n// const pkg = require('./../package.json');\r\n\r\n// DFP version is based on the package.json\r\nDFP.version = v || 'VERSION';\r\n\r\n/*\r\n // Only for development mode\r\n if ( process.env.NODE_ENV !== 'production' ) {\r\n DFP.dev = '123';\r\n }\r\n */\r\n\r\nexport const config = globalConfig;\r\nexport const version = DFP.version;\r\nexport default DFP;\r\n"]}