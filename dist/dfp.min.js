!function(a){function b(a,b,e){return 4===arguments.length?c.apply(this,arguments):void d(a,{declarative:!0,deps:b,declare:e})}function c(a,b,c,e){d(a,{declarative:!1,deps:b,executingRequire:c,execute:e})}function d(a,b){b.name=a,a in o||(o[a]=b),b.normalizedDeps=b.deps}function e(a,b){if(b[a.groupIndex]=b[a.groupIndex]||[],-1==p.call(b[a.groupIndex],a)){b[a.groupIndex].push(a);for(var c=0,d=a.normalizedDeps.length;d>c;c++){var f=a.normalizedDeps[c],g=o[f];if(g&&!g.evaluated){var h=a.groupIndex+(g.declarative!=a.declarative);if(void 0===g.groupIndex||g.groupIndex<h){if(void 0!==g.groupIndex&&(b[g.groupIndex].splice(p.call(b[g.groupIndex],g),1),0==b[g.groupIndex].length))throw new TypeError("Mixed dependency cycle detected");g.groupIndex=h}e(g,b)}}}}function f(a){var b=o[a];b.groupIndex=0;var c=[];e(b,c);for(var d=!!b.declarative==c.length%2,f=c.length-1;f>=0;f--){for(var g=c[f],i=0;i<g.length;i++){var k=g[i];d?h(k):j(k)}d=!d}}function g(a){return s[a]||(s[a]={name:a,dependencies:[],exports:{},importers:[]})}function h(b){if(!b.module){var c=b.module=g(b.name),d=b.module.exports,e=b.declare.call(a,function(a,b){if(c.locked=!0,"object"==typeof a)for(var e in a)d[e]=a[e];else d[a]=b;for(var f=0,g=c.importers.length;g>f;f++){var h=c.importers[f];if(!h.locked)for(var i=0;i<h.dependencies.length;++i)h.dependencies[i]===c&&h.setters[i](d)}return c.locked=!1,b},{id:b.name});c.setters=e.setters,c.execute=e.execute;for(var f=0,i=b.normalizedDeps.length;i>f;f++){var j,k=b.normalizedDeps[f],l=o[k],m=s[k];m?j=m.exports:l&&!l.declarative?j=l.esModule:l?(h(l),m=l.module,j=m.exports):j=n(k),m&&m.importers?(m.importers.push(c),c.dependencies.push(m)):c.dependencies.push(null),c.setters[f]&&c.setters[f](j)}}}function i(a){var b,c=o[a];if(c)c.declarative?m(a,[]):c.evaluated||j(c),b=c.module.exports;else if(b=n(a),!b)throw new Error("Unable to load dependency "+a+".");return(!c||c.declarative)&&b&&b.__useDefault?b.default:b}function j(b){if(!b.module){var c={},d=b.module={exports:c,id:b.name};if(!b.executingRequire)for(var e=0,f=b.normalizedDeps.length;f>e;e++){var g=b.normalizedDeps[e],h=o[g];h&&j(h)}b.evaluated=!0;var l=b.execute.call(a,function(a){for(var c=0,d=b.deps.length;d>c;c++)if(b.deps[c]==a)return i(b.normalizedDeps[c]);throw new TypeError("Module "+a+" not declared as a dependency.")},c,d);l&&(d.exports=l),c=d.exports,c&&c.__esModule?b.esModule=c:b.esModule=k(c)}}function k(b){var c={};if(("object"==typeof b||"function"==typeof b)&&b!==a)if(q)for(var d in b)"default"!==d&&l(c,b,d);else{var e=b&&b.hasOwnProperty;for(var d in b)"default"===d||e&&!b.hasOwnProperty(d)||(c[d]=b[d])}return c.default=b,r(c,"__useDefault",{value:!0}),c}function l(a,b,c){try{var d;(d=Object.getOwnPropertyDescriptor(b,c))&&r(a,c,d)}catch(d){return a[c]=b[c],!1}}function m(b,c){var d=o[b];if(d&&!d.evaluated&&d.declarative){c.push(b);for(var e=0,f=d.normalizedDeps.length;f>e;e++){var g=d.normalizedDeps[e];-1==p.call(c,g)&&(o[g]?m(g,c):n(g))}d.evaluated||(d.evaluated=!0,d.module.execute.call(a))}}function n(a){if(u[a])return u[a];if("@node/"==a.substr(0,6))return u[a]=k(t(a.substr(6)));var b=o[a];if(!b)throw"Module "+a+" not present.";return f(a),m(a,[]),o[a]=void 0,b.declarative&&r(b.module.exports,"__esModule",{value:!0}),u[a]=b.declarative?b.module.exports:b.esModule}var o={},p=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(this[b]===a)return b;return-1},q=!0;try{Object.getOwnPropertyDescriptor({a:0},"a")}catch(a){q=!1}var r;!function(){try{Object.defineProperty({},"a",{})&&(r=Object.defineProperty)}catch(a){r=function(a,b,c){try{a[b]=c.value||c.get.call(a)}catch(a){}}}}();var s={},t="undefined"!=typeof System&&System._nodeRequire||"undefined"!=typeof require&&require.resolve&&"undefined"!=typeof process&&require,u={"@empty":{}};return function(a,d,e,f){return function(g){g(function(g){for(var h={_nodeRequire:t,register:b,registerDynamic:c,get:n,set:function(a,b){u[a]=b},newModule:function(a){return a}},i=0;i<d.length;i++)(function(a,b){b&&b.__esModule?u[a]=b:u[a]=k(b)})(d[i],arguments[i]);f(h);var j=n(a[0]);if(a.length>1)for(var i=1;i<a.length;i++)n(a[i]);return e?j.default:j})}}}("undefined"!=typeof self?self:global)(["1"],[],!1,function(a){this.require,this.exports,this.module;a.registerDynamic("2",[],!1,function(){return{name:"DFP",description:"A DoubleClick for Publishers Implementation",version:"1.12.3",license:"MIT",author:{name:"Elia Grady",email:"admin@eliagrady.com"},bugs:{url:"https://github.com/haaretz/dfp/issues"},devDependencies:{"babel-cli":"^6.6.0","babel-core":"^6.6.0","babel-eslint":"^6.1.2","babel-loader":"^6.2.4","babel-plugin-external-helpers":"^6.8.0","babel-plugin-external-helpers-2":"^6.3.13","babel-plugin-syntax-jsx":"^6.5.0-1","babel-plugin-syntax-object-rest-spread":"^6.5.0-1","babel-plugin-transform-es2015-modules-commonjs":"^6.14.0","babel-plugin-transform-object-rest-spread":"^6.5.0-1","babel-plugin-transform-runtime":"^6.15.0","babel-polyfill":"^6.13.0","babel-preset-es2015":"^6.14.0","babel-preset-es2015-rollup":"^1.2.0","babel-preset-stage-0":"^6.5.0-1","babel-register":"^6.6.0","babelrc-rollup":"^3.0.0",chai:"^3.5.0","dirty-chai":"^1.2.2",eslint:"^3.2.0","eslint-config-airbnb":"^10.0.1","eslint-plugin-import":"^1.8.1",glob:"^7.0.0",isparta:"^4.0.0","isparta-instrumenter-loader":"^1.0.0","isparta-loader":"^2.0.0","json-loader":"^0.5.4",jspm:"^0.17.0-beta.28",karma:"1.2.0","karma-browserstack-launcher":"^1.0.1","karma-chrome-launcher":"^2.0.0","karma-coverage":"douglasduteil/karma-coverage#next","karma-coveralls":"^1.1.2","karma-dirty-chai":"^1.0.2","karma-firefox-launcher":"^1.0.0","karma-ie-launcher":"^1.0.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.0.0","karma-phantomjs-launcher":"^1.0.0","karma-sauce-launcher":"^1.0.0","karma-sinon-chai":"^1.2.0","karma-sourcemap-loader":"^0.3.7","karma-webpack":"^1.7.0",mkdirp:"^0.5.1",mocha:"^3.0.0","mocha-jsdom":"^1.1.0","mocha-lcov-reporter":"^1.2.0","mock-browser":"^0.92.10","npm-check-updates":"^2.5.8",phantomjs:"^2.1.3","phantomjs-prebuilt":"^2.1.4","pre-commit":"^1.1.2",rimraf:"^2.5.2",rollup:"^0.34.1","rollup-plugin-babel":"^2.6.1","rollup-plugin-commonjs":"^4.0.1","rollup-plugin-eslint":"^2.0.0","rollup-plugin-filesize":"^0.5.5","rollup-plugin-json":"^2.0.2","rollup-plugin-node-resolve":"^2.0.0","rollup-plugin-replace":"^1.1.0","rollup-plugin-sourcemaps":"^0.3.7","rollup-plugin-uglify":"^1.0.1",sinon:"^1.17.3","sinon-chai":"^2.8.0","uglify-js":"latest",webpack:"^2.1.0-beta.4","webpack-dev-server":"^1.14.1"},peerDependencies:{lolex:"^1.4.0"},homepage:"https://github.com/haaretz/dfp#readme","jsnext:main":"src/index.js",keywords:["boilerplate","es2015","rollup","karma","mocha","workflow","babel","es","isparta","rimraf","chai","sinon","webpack","eslint","bundle","DFP"],main:"dist/dfp.min.js",jspm:{name:"DFP",main:"DFP.js",dependencies:{json:"github:systemjs/plugin-json@^0.1.2"},devDependencies:{"plugin-babel":"npm:systemjs-plugin-babel@^0.0.14"},peerDependencies:{}},repository:{type:"git",url:"git@github.com:haaretz/dfp"},scripts:{clean:"rimraf coverage/ dist/","build:dev":"babel-node config/rollup.config.js dev","build:prod":"babel-node config/rollup.config.js prod","build:es6":"babel-node config/rollup.config.js dev es6","jspmbuild:dev":"jspm build src/index.js dist/dfp.js --format global --global-name DFP","jspmbuild:prod":"jspm build src/index.js dist/dfp.min.js --minify","jspmbuild:es6":"jspm build src/index.js dist/dfp.es6.js --format esm",build:"npm run clean && mkdirp dist && npm run build:dev && npm run build:prod && npm run build:es6","build:jspm":"npm run clean && mkdirp dist && npm run jspmbuild:dev && npm run jspmbuild:prod && npm run jspmbuild:es6",browser:"webpack-dev-server --quiet --config config/webpack.dev.conf.js --host 0.0.0.0","test:server":"mocha --opts config/mocha.opts","test:browser":"karma start config/karma.conf.js --no-auto-watch","karma:phantom":"karma start config/karma.conf.js --single-run --no-auto-watch --browsers=PhantomJS","karma:chrome":"karma start config/karma.conf.js --single-run --no-auto-watch --browsers=Chrome","karma:firefox":"karma start config/karma.conf.js --single-run --no-auto-watch --browsers=Firefox","karma:ie":"karma start config/karma.conf.js --single-run --no-auto-watch --browsers=IE",test:"npm run test:browser",lint:"eslint ./src/**/*.js","lint:tests":"eslint ./src/**/*__tests__*/**/*.js","lint:source":"eslint src/","watch:server":"npm run test:server -- --watch","watch:browser":"./node_modules/.bin/karma start config/karma.conf.js --auto-watch --no-single-run",packages:"npm list --depth=0","package:purge":"rm -rf node_modules","package:reinstall":"npm run package:purge && npm install","package:check":"./node_modules/.bin/ncu","package:upgrade":"./node_modules/.bin/ncu -u","package:prod":"./node_modules/.bin/ncu -u","package:dev":"./node_modules/.bin/ncu -p -u",preversion:"[[ -z $(git status --porcelain) ]] && npm run build:jspm && git add -A dist && git commit -m 'Build lib'",postpublish:"git push origin master --follow-tags",commit:"git-cz"},"pre-commit":["test","lint:source"],engines:{node:"<6",npm:"~2.5"},dependencies:{"babel-runtime":"^6.11.6"}}}),a.register("1",["2"],function(a,b){"use strict";function c(a){var b=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],c=b.separator,d=void 0===c?";":c,e=b.operator,f=void 0===e?"=":e,g={},h=a.split(d);return h.forEach(function(a){if("string"==typeof a){var b=a.split(f);2===b.length&&(g[b[0]]=decodeURIComponent(b[1]))}}),g}function d(){var a=c(document.cookie,{separator:/;\s?/});return"string"==typeof a.tmsso&&(a.tmsso=c(a.tmsso,{separator:":"})),"string"==typeof a.engsso&&(a.engsso=c(a.engsso,{separator:":"})),a}function e(a,b){if(!a)throw new SyntaxError("addHours called without a required 'date' parameter!");if(!b)throw new SyntaxError("addHours called without a required 'hours' parameter!");if(isNaN(parseInt(b,10)))throw new TypeError("addHours called with an invalid integer 'hours' parameter!");var c=new Date(a);return c.setHours(c.getHours()+parseInt(b,10)),c}function f(a,b){if(!a)throw new SyntaxError("addDays called without a required 'date' parameter!");if(!b)throw new SyntaxError("addDays called without a required 'days' parameter!");if(isNaN(parseInt(b,10)))throw new TypeError("addDays called with an invalid integer 'days' parameter!");var c=new Date(a);return c.setDate(c.getDate()+parseInt(b,10)),c}function g(a){var b=arguments.length<=1||void 0===arguments[1]?100:arguments[1],c=arguments[2],d=void 0;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function h(){var a=void 0,b=window.innerWidth;switch(b){case b<p.xs:a=p.xxs;break;case b<p.s:a=p.xs;break;case b<p.m:a=p.s;break;case b<p.l:a=p.m;break;case b<p.xl:a=p.l;break;case b<p.xxl:a=p.xl;break;default:a=p.xxl}return a}function i(a){var b=void 0,c=a||window.innerWidth;switch(c){case c<p.xs:b="xxs";break;case c<p.s:b="xs";break;case c<p.m:b="s";break;case c<p.l:b="m";break;case c<p.xl:b="l";break;case c<p.xxl:b="xl";break;default:b="xxl"}return b}function j(a,b){if(!a||!b)return!1;if(!Array.isArray(a)||!Array.isArray(b))return!1;if(a===b)return!0;if(a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return{setters:[function(a){k=a.version}],execute:function(){l=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},m=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),n=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",o=Object.assign({get referrer(){return document.referrer?document.referrer:""},get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname||3===this.environment},get department(){return this.isHomepage?"_homepage":"_section"},get domain(){var a=/([\d|\w]+)(\.co\.il|\.com)(.*)?/.exec(window.location.hostname),b=a?a[0]:window.location.hostname;return b},get path(){var a=this.articleId&&"0"!==this.articleId?window.location.pathname.split("/").slice(1,-1):window.location.pathname.split("/").slice(1);return a=a.filter(function(a){return"wwwMobileSite"!==a&&"whtzMobileSite"!==a}),a.map(function(a){return"."+a}).map(function(a,b,c){return c.slice(0,b+1).reduce(function(a,b){return a.concat(b)})})},get environment(){var a={dev:1,test:2,prod:3};return"8080"===window.location.port?a.dev:window.location.hostname.indexOf("pre.haaretz.co.il")>-1||window.location.hostname.indexOf("tmtest.themarker.com")>-1?a.test:window.location.pathname.indexOf("/cmlink/Haaretz.HomePage")>-1||window.location.pathname.indexOf("/cmlink/TheMarker.HomePage")>-1?a.prod:void 0},get articleId(){var a=/\d\.\d+/g.exec(window.location.pathname),b="0";return a&&(b=a.pop()),b},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(a){var b=RegExp("("+a+')(=)([^&"]+)').exec(window.location.search);return b&&b[3]?b[3]:void 0}},get adBlockRemoved(){var a=!1;try{localStorage.getItem("adblock_removed")&&(a=!0)}catch(a){}return a},get wifiLocation(){var a="",b=d();try{b&&b._htzwif&&(a="arcaffe"===b._htzwif?"ArCafe":"university")}catch(a){}return a},get gStatCampaignNumber(){var a=void 0;try{a=localStorage.getItem("GstatCampaign")?JSON.parse(localStorage.getItem("GstatCampaign")):void 0}catch(b){a=void 0}return a?a.CampaignNumber:void 0},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",responsive:!0,adSizeMapping:[["width1","height1"]].concat(["widthN","heightN"]),priority:"normal",fluid:!1,responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[["width1","height1"]].concat(["widthN","heightN"]),s:[["width1","height1"]].concat(["widthN","heightN"]),m:[["width1","height1"]].concat(["widthN","heightN"]),l:[["width1","height1"]].concat(["widthN","heightN"]),xl:[["width1","height1"]].concat(["widthN","heightN"]),xxl:[["width1","height1"]].concat(["widthN","heightN"])},blacklistReferrers:"comma, delimited, blacklisted, referrer, list",whitelistReferrers:"comma, delimited, referrer, list"}},adManagerConfig:{network:"9401",adUnitBase:"haaretz.co.il_Web"},breakpointsConfig:{get breakpoints(){var a=!0;return a?this.breakpoints1:this.breakpoints2},breakpoints1:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},breakpoints2:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920}},userConfig:{type:void 0,age:void 0,gender:void 0},conflictManagementConfig:{"blocking.ad.unit.name":[{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"},{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"}]},impressionManagerConfig:{"ad.unit.name":{target:"all|section|homepage",frequency:"$1/$2(day|hour)",exposed:0,expires:(new Date).getTime()}},sso:n},window.dfpConfig),p=o.breakpointsConfig.breakpoints,q={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",target:"target",maxImpressions:"maxImpressions",hours:"hour",days:"day",adSlotId:"id"},r=function(){function a(b){l(this,a),this.now=(new Date).getTime(),this.config=Object.assign({},b),this.impressions=this.retrieveImpressionsData(),this.initImpressionMap()}return m(a,[{key:"retrieveImpressionsData",value:function(){var a=this,b=this.migrateImpressionsData();Object.keys(b).map(function(c,d){return b[c]=Object.assign({},b[c],a.config[c]),a});for(var c in b)({}).hasOwnProperty.call(b,c)&&(b[c][q.frequency]||delete b[c]);return b}},{key:"migrateImpressionsData",value:function(){var a=this,b=void 0,c=void 0;try{c=window.localStorage.getItem(q.impressions)}catch(a){c=void 0}try{b=JSON.parse(c)}catch(e){b={};var d=c.split(";").filter(function(a){return a});d.forEach(function(c){try{var d=c.split(" = "),e=d[0],f=d[1],g=e.split("."),h=g.pop();h&&"hp"===h&&(h="homepage");var i=g.join("."),j=i+"_"+h,k=parseInt(f.split("/")[0],10)||0,l=parseInt(f.split("/")[1],10)||a.now;b[j]={},b[j][q.adSlotId]=i,b[j][q.target]=h,b[j][q.exposed]=k,b[j][q.expires]=l}catch(a){}})}return b||{}}},{key:"saveImpressionsToLocalStorage",value:function(){this.debouncedSave&&"function"==typeof this.debouncedSave?this.debouncedSave():(this.debouncedSave=g(this.saveImpressionsToLocalStorageImpl,250,!1),this.debouncedSave())}},{key:"saveImpressionsToLocalStorageImpl",value:function(){try{localStorage.setItem(q.impressions,JSON.stringify(this.impressions))}catch(a){console.error("localStorage isn't available:",a)}}},{key:"initImpressionMap",value:function(){var a=this;Object.keys(this.config).map(function(b,c){var d=b,e=a.impressions[d],f=!1;return e?a.config[d][q.frequency]!==e[q.frequency]?(f=!0,a.impressions[d][q.frequency]=a.config[d][q.frequency]):a.now>e[q.expires]&&(f=!0):a.initSlotFromConfig(d),f&&a.updateExpiryDate(d),a})}},{key:"updateExpiryDate",value:function(a){var b=new Date;if(!this.impressions[a]||!this.impressions[a][q.frequency])throw new Error("Unable to update expiry date for slot: "+a+"\n      - this.impressions[slotName]:",this.impressions[a]);var c=this.impressions[a][q.frequency].match(q.frequencyRegex);b.setMilliseconds(0),b.setSeconds(0),b.setMinutes(0),c.indexOf(q.days)>-1&&b.setHours(0),this.impressions[a][q.expires]=(c.indexOf(q.days)>-1?f(b,c[2]):e(b,c[2])).getTime(),this.impressions[a][q.maxImpressions]=parseInt(c[1],10),this.impressions[a][q.exposed]=0}},{key:"initSlotFromConfig",value:function(a){var b=this.impressions[a]||{};b[q.frequency]=this.config[a][q.frequency],b[q.target]=this.config[a][q.target],b[q.exposed]=0,this.impressions[a]=b,this.updateExpiryDate(a)}},{key:"registerImpression",value:function(a){if(a){var b=this.impressions[a];if(b){var c=b[q.exposed];if(isNaN(parseInt(c,10))===!1){this.impressions[a][q.exposed]+=1;try{this.saveImpressionsToLocalStorage()}catch(a){}return!0}}}return!1}},{key:"reachedQuota",value:function(a){var b=this.impressions[""+a+o.department]?""+a+o.department:a+"_all",c=this.impressions[b],d=!1;if(c){var e=(new Date).getTime(),f=this.impressions[b][q.expires];if(f<e)this.updateExpiryDate(b);else{var g=this.impressions[b][q.maxImpressions];g&&(d=this.impressions[b][q.exposed]>=g)}}return d}},{key:"resetImpressions",value:function(){var a=this.impressions;for(var b in a)({}).hasOwnProperty.call(a,b)&&a[b][q.exposed]&&(a[b][q.exposed]=0);this.saveImpressionsToLocalStorage()}}]),a}(),s={payer:"payer",registered:"registered",anonymous:"anonymous"},t=function(){function a(b){l(this,a),this.config=Object.assign({},b.userConfig);var c=d();this.ssoKey=o.sso,c[this.ssoKey]||(this.ssoKey="tmsso"===this.ssoKey?"engsso":"tmsso"),this.type=this.getUserType(c),this.impressionManager=new r(b.impressionManagerConfig),this.age=this.getUserAge(c),this.gender=this.getUserGender(c)}return m(a,[{key:"getUserType",value:function(a){var b=void 0;if(a&&a[this.ssoKey]){var c=window.location.hostname.indexOf("haaretz.com")>-1?"HdcPusr":"HtzPusr";b=a[c]?s.payer:s.registered}else b=s.anonymous;return b}},{key:"getUserAge",value:function(a){var b=void 0,c=a[this.ssoKey]&&a[this.ssoKey].usrae;return c&&(b=parseInt(a[this.ssoKey].usrae,10),b=b>0?b:void 0),b}},{key:"getUserGender",value:function(a){var b=void 0,c=a[this.ssoKey]&&a[this.ssoKey].urgdr;return c&&(b=parseInt(a[this.ssoKey].urgdr,10),b=2===b||1===b?b:void 0),b}}]),a}(),u=function(){function a(b){l(this,a),this.dependencyMap=this.initializeDependencyMap(b),this.deferredSlots=new Set}return m(a,[{key:"initializeDependencyMap",value:function(a){var b=this,c=new Map;return Object.keys(a).map(function(d,e){var f=a[d];return f&&(f=f.filter(function(a){return a.onsize&&a.avoid})),c.set(d,{id:d,rules:f,resolvedWith:null}),b}),c}},{key:"updateResolvedSlot",value:function(a,b){if(!a)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!b)throw new Error("updateResolvedSlot must be called with a resolved size!");this.dependencyMap.has(a)&&(this.dependencyMap.get(a).resolvedWith=b)}},{key:"isBlocked",value:function a(b){var c=this;if(!b)throw new Error("isBlocked must be called with an adSlotId!");var a=!1,d=!0,e=!1,f=void 0;try{for(var g,h=this.dependencyMap.keys()[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=this.dependencyMap.get(i),k=!0,l=!1,m=void 0;try{for(var n,o=j.rules[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value;p.avoid===b&&!function(){var d=j.resolvedWith;d||(a=!0,c.deferredSlots.add(b)),p.onsize.split(",").find(function(a){var b=a.split("x").map(function(a){return parseInt(a,10)});return c.arraysEqual(b,d)})&&(c.deferredSlots.add(b),a=!0)}()}}catch(a){l=!0,m=a}finally{try{!k&&o.return&&o.return()}finally{if(l)throw m}}}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return a}},{key:"isBlocking",value:function a(b){if(!b)throw new Error("isBlocking must be called with an adSlotId!");var a=!1,c=!0,d=!1,e=void 0;try{for(var f,g=this.dependencyMap.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;h===b&&(a=!0)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return a}},{key:"getBlockedSlotsIds",value:function(a){var b=void 0;return this.dependencyMap.has(a)&&(b=Array.from(this.dependencyMap.get(a).rules.map(function(a){return a.avoid}))),b||[]}},{key:"arraysEqual",value:function(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}}]),a}(),u.EMPTY_SIZE=[],v=function(){function a(b){if(l(this,a),this.config=Object.assign({},b),this.id=this.config.id,!this.config.id)throw new Error("an adSlot requires an id!");this.target=this.config.target,this.type=this.config.type,this.responsive=this.config.responsive,this.fluid=this.config.fluid,this.user=this.config.user,this.adManager=this.config.adManager,this.htmlElement=this.config.htmlElement,this.priority=this.config.priority,this.deferredSlot=this.config.deferredSlot,this.department=this.config.department,this.network=this.config.network,this.adUnitBase=this.config.adUnitBase,this.adSizeMapping=this.config.adSizeMapping,this.responsiveAdSizeMapping=this.config.responsiveAdSizeMapping,this.blacklistReferrers=this.config.blacklistReferrers?this.config.blacklistReferrers.split(","):[],this.whitelistReferrers=this.config.whitelistReferrers?this.config.whitelistReferrers.split(","):[],this.lastResolvedSize=void 0,this.lastResolvedWithBreakpoint=void 0,this.slot=void 0;try{this.deferredSlot||(this.slot=this.defineSlot())}catch(a){console.error(a)}}return m(a,[{key:"isOutOfPage",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case z.maavaron:return!0;case z.popunder:return!0;case z.talkback:return!1;case z.regular:return!1;default:return!1}}},{key:"isMaavaron",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case z.maavaron:return!0;default:return!1}}},{key:"isMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")}},{key:"isWhitelisted",value:function(){var a=!1;if(0!==this.whitelistReferrers.length){var b=!0,c=!1,d=void 0;try{for(var e,f=this.whitelistReferrers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(o.referrer.indexOf(g)>-1){a=!0;break}}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}else a=!0;return a}},{key:"isBlacklisted",value:function(){var a=!1;if(0!==this.blacklistReferrers.length){var b=!0,c=!1,d=void 0;try{for(var e,f=this.blacklistReferrers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(o.referrer.indexOf(g)>-1){a=!0;break}}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}return a}},{key:"show",value:function(){var a=this;!this.shown==!0&&(this.shown=!0,googletag.cmd.push(function(){a.deferredSlot&&(a.slot=a.defineSlot()),document.getElementById(a.id).classList.remove("h-hidden"),googletag.display(a.id)}))}},{key:"hide",value:function(){var a=this;googletag.cmd.push(function(){document.getElementById(a.id).classList.add("h-hidden")})}},{key:"defineSlot",value:function(){if(this.isMaavaron()){var a=this.defineMaavaron();return this.adManager.shouldSendRequestToDfp(this)&&(this.shown||(this.shown=!0,a.display())),a}var b=window.googletag,c=b.pubads(),d=[],e=this.isOutOfPage()?b.defineOutOfPageSlot:b.defineSlot;d.push(this.getPath()),this.isOutOfPage()===!1&&(this.fluid?d.push("fluid"):d.push(this.adSizeMapping)),d.push(this.id);var f=e.apply(e,d);if(f){if(this.responsive){var g=b.sizeMapping(),h=o.breakpointsConfig.breakpoints,i=Object.keys(this.responsiveAdSizeMapping),j=!0,k=!1,l=void 0;try{for(var m,n=i[Symbol.iterator]();!(j=(m=n.next()).done);j=!0){var p=m.value;g.addSize([h[p],100],this.responsiveAdSizeMapping[p])}}catch(a){k=!0,l=a}finally{try{!j&&n.return&&n.return()}finally{if(k)throw l}}g=g.build(),f=f.defineSizeMapping(g)}f=f.addService(c),this.isOutOfPage()===!1&&f.setCollapseEmptyDiv(!0)}return f}},{key:"getPath",value:function(){var a=this,b=o.path||[];b=b.filter(function(a){return"."!==a}),b=b.map(function(b){return""+a.id+a.department+b}).join("/"),b=b&&"_homepage"!==this.config.department?"/"+b:"";var c="/"+this.config.network+"/"+this.config.adUnitBase+"/"+this.id+"/"+this.id+this.department+b;return c.toLowerCase()}},{key:"slotRendered",value:function(a){a.slot.getAdUnitPath().split("/")[3],a.isEmpty,a.size}},{key:"refresh",value:function(){var a=this;googletag.cmd.push(function(){googletag.pubads().refresh([a.slot])})}},{key:"defineMaavaron",value:function(){if(!document.referrer.match("loc.haaretz")){var a=this.getPath(),b=[[2,1]],c=googletag.pubads().definePassback(a,b).setTargeting("UserType",[this.user.type]).setTargeting("age",[this.user.age]).setTargeting("urgdr",[this.user.gender]).setTargeting("articleId",[o.articleId]).setTargeting("stg",[o.environment]);return c}return null}}]),a}(),w={high:"high",normal:"normal",low:"low"},x={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},y={anonymous:"anonymous",registered:"registered",payer:"payer"},z={maavaron:".maavaron",popunder:".popunder",talkback:".talkback",regular:""},A=function(){function a(b){var c=this;l(this,a),this.config=Object.assign({},b),this.user=new t(b),this.conflictResolver=new u(b.conflictManagementConfig);try{googletag.cmd.push(function(){c.initGoogleTargetingParams(),c.initGoogleGlobalSettings(),c.initSlotRenderedCallback()}),googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,w.high)}),document.addEventListener("DOMContentLoaded",function(){googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,w.high),googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,w.normal)})})}),window.addEventListener("load",function(){googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,w.low)})})}catch(a){console.error(a)}}return m(a,[{key:"showAllSlots",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.adSlots.keys()[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=this.adSlots.get(f);g.type!==z.talkback&&this.shouldSendRequestToDfp(g)&&g.show()}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}},{key:"getAdSlotsByPriority",value:function(a){function b(b){return b.priority===a}return Array.from(this.adSlots.values()).filter(b)}},{key:"showAllDeferredSlots",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.conflictResolver.deferredSlots[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;if(this.adSlots.has(f)&&!this.conflictResolver.isBlocked(f)){var g=this.adSlots.get(f);this.shouldSendRequestToDfp(g)&&g.show()}}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}},{key:"refreshAllSlots",value:function(){var a=h(),b=!0,c=!1,d=void 0;try{for(var e,f=this.adSlots.keys()[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value,i=this.adSlots.get(g);i.responsive&&(i.lastResolvedWithBreakpoint!==a&&this.shouldSendRequestToDfp(i)?i.refresh():i.hide())}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}},{key:"initAdSlots",value:function(a,b){var c=this,d=new Map(this.adSlots),e=Array.from(document.getElementsByClassName("js-dfp-ad"));e=e.filter(function(a){return a.id});var f=new Set;return e=Array.prototype.filter.call(e,function(a){return f.has(a.id)===!1&&(f.add(a.id),!0)}),e.forEach(function(e){var f=a[e.id]?a[e.id].priority||w.normal:void 0;if(a[e.id]&&d.has(e.id)===!1&&f===b)try{var g=Object.assign({},a[e.id],{id:e.id,target:e.attributes["data-audtarget"]?e.attributes["data-audtarget"].value:x.all,type:c.getAdType(e.id),responsive:a[e.id].responsive,fluid:a[e.id].fluid||!1,user:c.user,adManager:c,htmlElement:e,department:c.config.department,network:c.config.adManagerConfig.network,adUnitBase:c.config.adManagerConfig.adUnitBase,deferredSlot:c.conflictResolver.isBlocked(e.id),priority:f}),h=new v(g);d.set(e.id,h),h.type!==z.talkback&&h.priority===w.high&&c.shouldSendRequestToDfp(h)&&h.show()}catch(a){console.error(a)}}),d}},{key:"isPriority",value:function(a){return"string"==typeof a&&(a.indexOf("plazma")>0||a.indexOf("maavaron")>0||a.indexOf("popunder")>0)}},{key:"getAdType",value:function(a){if(!a)throw new Error("Missing argument: a call to getAdType must have an adSlotId");return a.indexOf(z.maavaron)>-1?z.maavaron:a.indexOf(z.popunder)>-1?z.popunder:a.indexOf(z.talkback)>-1?z.talkback:z.regular}},{key:"shouldSendRequestToDfp",value:function(a){return this.conflictResolver.isBlocked(a.id)===!1&&a.isWhitelisted()&&a.isBlacklisted()===!1&&this.shouldDisplayAdAfterAdBlockRemoval(a)&&this.doesBreakpointContainAd(a)&&this.doesUserTypeMatchBannerTargeting(a)&&this.user.impressionManager.reachedQuota(a.id)===!1}},{key:"shouldDisplayAdAfterAdBlockRemoval",value:function(a){return!(this.config.adBlockRemoved===!0&&(a.type===z.maavaron||a.type===z.popunder))}},{key:"doesUserTypeMatchBannerTargeting",value:function(a){var b=this.user.type,c="string"==typeof a?a:a.target;switch(c){case x.all:return!0;case x.nonPaying:return b===y.anonymous||b===y.registered;case x.anonymous:return b===y.anonymous;case x.registered:return b===y.registered;case x.paying:return b===y.payer;case x.digitalOnly:return b===y.payer;case x.digitalAndPrint:return b===y.payer;default:return!1}}},{key:"switchedToBreakpoint",value:function(a){if(!a)throw new Error("Missing argument: a call to switchedToBreakpoint must have an breakpoint");var b=0,c=!0,d=!1,e=void 0;try{for(var f,g=this.adSlots.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=this.adSlots.get(h);i.responsive===!0&&i.lastResolvedWithBreakpoint&&i.lastResolvedWithBreakpoint!==a&&(i.refresh(),b++)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return b}},{key:"doesBreakpointContainAd",value:function(a){var b=arguments.length<=1||void 0===arguments[1]?h():arguments[1];if(!a)throw new Error("Missing argument: a call to doesBreakpointContainAd must have an adSlot");var c=!0;if(a.responsive===!0){var d=a.responsiveAdSizeMapping[i(b)];if(Array.isArray(d)===!1)throw new Error("Invalid argument: breakpoint:"+b+" doesn't exist!",this);c=d.length>0&&!j(d,[0,0])}return c}},{key:"initSlotRenderedCallback",value:function(){var a=this;if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initSlotRenderedCallback' was called!");
var b=window.googletag.pubads();b.addEventListener("slotRenderEnded",function(b){var c=b.slot.getAdUnitPath().split("/")[3],d=b.isEmpty,e=b.size;if(a.adSlots.has(c)){var f=a.adSlots.get(c);f.lastResolvedSize=e,f.lastResolvedWithBreakpoint=h(),d?(f.lastResolvedSize=u.EMPTY_SIZE,f.hide(),a.releaseSlotDependencies(f)):(a.user.impressionManager.registerImpression(""+f.id+a.config.department),a.user.impressionManager.registerImpression(f.id+"_all"),a.releaseSlotDependencies(f,f.lastResolvedSize))}})}},{key:"releaseSlotDependencies",value:function(a){try{var b=a.id;if(this.conflictResolver.updateResolvedSlot(b,a.lastResolvedSize),this.conflictResolver.isBlocking(b)){var c=!0,d=!1,e=void 0;try{for(var f,g=this.conflictResolver.getBlockedSlotsIds(b)[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;this.conflictResolver.isBlocked(h)&&this.adSlots.has(h)&&this.adSlots.get(h).hide()}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}var i=!0,j=!1,k=void 0;try{for(var l,m=this.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=this.adSlots.get(n);o&&this.shouldSendRequestToDfp(o)&&(this.conflictResolver.deferredSlots.delete(n),o.deferredSlot&&(o.defineSlot(),o.deferredSlot=!1),o.show())}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}}catch(b){console.error("Cannot updateSlotDependencies for adSlot: "+a.id)}}},{key:"initGoogleTargetingParams",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleTargetingParams' was called!");var a=googletag.pubads();this.config.environment&&a.setTargeting("stg",[this.config.environment]),this.user.type&&a.setTargeting("UserType",[this.user.type]),this.user.age&&a.setTargeting("age",[this.user.age]),this.user.gender&&a.setTargeting("urgdr",[this.user.gender]),this.config.articleId&&a.setTargeting("articleId",[this.config.articleId]),this.config.gStatCampaignNumber&&this.config.gStatCampaignNumber!==-1&&a.setTargeting("gstat_campaign_id",[this.config.gStatCampaignNumber]),this.config.utm_.content&&a.setTargeting("utm_content",[this.config.utm_.content]),this.config.utm_.source&&a.setTargeting("utm_source",[this.config.utm_.source]),this.config.utm_.medium&&a.setTargeting("utm_medium",[this.config.utm_.medium]),this.config.utm_.campaign&&a.setTargeting("utm_campaign",[this.config.utm_.campaign]),this.config.adBlockRemoved&&a.setTargeting("adblock_removed",[this.config.adBlockRemoved]),this.config.wifiLocation&&a.setTargeting("wifi",[this.config.wifiLocation]),a.setCentering(!0)}},{key:"initGoogleGlobalSettings",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api wasn't ready when 'initGoogleGlobalSettings' was called!");window.location.search&&window.location.search.indexOf("sraon")>0&&(console.log("enableSingleRequest mode: active"),googletag.pubads().enableSingleRequest()),this.config.isMobile?googletag.pubads().enableAsyncRendering():googletag.pubads().enableAsyncRendering(),googletag.enableServices()}}]),a}(),B=o||{},C=1e4,D=250,E=function(){function a(b){l(this,a),this.config=Object.assign({},B,b),this.wasInitialized=!1,this.breakpoint=h(),this.initWindowResizeListener()}return m(a,[{key:"resumeInit",value:function(){try{this.adManager=new A(this.config)}catch(a){console.error(a)}}},{key:"initGoogleTag",value:function(){var a=this,b=this;return new Promise(function(c,d){b.wasInitialized===!0||window.googletag&&window.googletag.apiReady?(a.adManager=a.adManager||new A(a.config),b.wasInitialized=!0,c(a.isGoogleTagReady)):(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var e=window.document.createElement("script");e.async=!1,e.type="text/javascript",e.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var f=window.document.getElementsByTagName("script")[0];e.onload=function(){b.wasInitialized=!0,b.resumeInit(),c(a.isGoogleTagReady)},e.onerror=function(a){b.wasInitialized=!1,d(a)},f.parentNode.insertBefore(e,f)}())})}},{key:"isGoogleTagReady",value:function(){var a=this,b=new Promise(function(b,c){googletag.cmd.push(function(){b(a)}),setTimeout(function(){googletag&&googletag.apiReady===!0||c(new Error("googletag failed to initialize on the page!"))},C)});return b}},{key:"initWindowResizeListener",value:function(){function a(){var a=h();if(b.breakpoint!==a){if(b.breakpoint=a,!b.adManager)throw new Error("initWindowResizeListener error - adManager instance is not available");b.adManager.refreshAllSlots()}}var b=this,c=g(a,D);window.onresize=c}}]),a}(),E.version=k||"VERSION",a("config",F=o),a("version",G=E.version),a("config",F),a("version",G),a("default",E)}}})})(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof module&&module.exports&&"function"==typeof require?module.exports=a():a()});
//# sourceMappingURL=dfp.min.js.map