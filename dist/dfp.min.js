!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.DFP=e.DFP||{})}(this,function(e){"use strict";function t(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.separator,n=void 0===i?";":i,r=t.operator,o=void 0===r?"=":r,a={},s=e.split(n);for(var l in s)if(s.hasOwnProperty(l)){var d=s[l].split(o);2==d.length&&(a[d[0]]=decodeURIComponent(d[1]))}return a}function i(){var e=t(document.cookie,{separator:/;\s?/});return"string"==typeof e.tmsso&&(e.tmsso=t(e.tmsso,{separator:":"})),"string"==typeof e.engsso&&(e.engsso=t(e.engsso,{separator:":"})),e}function n(e,t){if(!e)throw new SyntaxError("addHours called without a required 'date' parameter!");if(!t)throw new SyntaxError("addHours called without a required 'hours' parameter!");if(isNaN(parseInt(t)))throw new TypeError("addHours called with an invalid integer 'hours' parameter!");var i=new Date(e);return i.setHours(i.getHours()+parseInt(t)),i}function r(e,t){if(!e)throw new SyntaxError("addDays called without a required 'date' parameter!");if(!t)throw new SyntaxError("addDays called without a required 'hours' parameter!");if(isNaN(parseInt(t)))throw new TypeError("addDays called with an invalid integer 'hours' parameter!");var i=new Date(e);return i.setDate(i.getDate()+parseInt(t)),i}function o(e){var t=arguments.length<=1||void 0===arguments[1]?100:arguments[1],i=arguments[2],n=void 0;return function(){var r=this,o=arguments,a=function(){n=null,i||e.apply(r,o)},s=i&&!n;clearTimeout(n),n=setTimeout(a,t),s&&e.apply(r,o)}}function a(){var e=g.xxl,t=window.innerWidth;return t<g.xxl?(e=g.xl,t<g.xl?(e=g.l,t<g.l?(e=g.m,t<g.m?(e=g.s,t<g.s?(e=g.xs,t<g.xs?e=g.xxs:e):e):e):e):e):e}function s(e){var t="xxl",i=e||window.innerWidth;return i<g.xxl?(t="xl",i<g.xl?(t="l",i<g.l?(t="m",i<g.m?(t="s",i<g.s?(t="xs",i<g.xs?t="xxs":t):t):t):t):t):t}function l(e,t){if(!e||!t)return!1;if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!=t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}var d={};d.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},d.createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();var c=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",u=Object.assign({get referrer(){return document.referrer?document.referrer:""},get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname||3===this.environment},get department(){return this.isHomepage?"_homepage":"_section"},get domain(){var e=/([\d|\w]+)(\.co\.il|\.com)(.*)?/.exec(window.location.hostname),t=e?e[0]:window.location.hostname;return t},get path(){var e=this.articleId?window.location.pathname.split("/").slice(1,-1):window.location.pathname.split("/").slice(1);return e=e.filter(function(e){return"wwwMobileSite"!=e&&"whtzMobileSite"!=e}),e.map(function(e){return"."+e}).map(function(e,t,i){return i.slice(0,t+1).reduce(function(e,t){return e.concat(t)})})},get environment(){var e={dev:1,test:2,prod:3};return"8080"===window.location.port?e.dev:window.location.hostname.indexOf("pre.haaretz.co.il")>-1||window.location.hostname.indexOf("tmtest.themarker.com")>-1?e.test:window.location.pathname.indexOf("/cmlink/Haaretz.HomePage")>-1||window.location.pathname.indexOf("/cmlink/TheMarker.HomePage")>-1?e.prod:void 0},get articleId(){var e=/\d\.\d+/g.exec(window.location.pathname),t=void 0;return e&&(t=e.pop()),t},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(e){var t=RegExp("("+e+')(=)([^&"]+)').exec(window.location.search);return t&&t[3]?t[3]:void 0}},get adBlockRemoved(){var e=void 0;try{e=!!localStorage.getItem("adblock_removed")}catch(t){e=!1}return e},get gStatCampaignNumber(){var e=void 0;try{e=localStorage.getItem("GstatCampaign")?JSON.parse(localStorage.getItem("GstatCampaign")):void 0}catch(t){e=void 0}return e?e.CampaignNumber:void 0},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",responsive:!0,adSizeMapping:[["width1","height1"]].concat(["widthN","heightN"]),responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[["width1","height1"]].concat(["widthN","heightN"]),s:[["width1","height1"]].concat(["widthN","heightN"]),m:[["width1","height1"]].concat(["widthN","heightN"]),l:[["width1","height1"]].concat(["widthN","heightN"]),xl:[["width1","height1"]].concat(["widthN","heightN"]),xxl:[["width1","height1"]].concat(["widthN","heightN"])},blacklistReferrers:"comma, delimited, blacklisted, referrer, list",whitelistReferrers:"comma, delimited, referrer, list"}},adManagerConfig:{network:"9401",adUnitBase:"haaretz.co.il_Web"},breakpointsConfig:{get breakpoints(){var e=!0;return e?this.breakpoints1:this.breakpoints2},breakpoints1:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},breakpoints2:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920}},userConfig:{type:void 0,age:void 0,gender:void 0},conflictManagementConfig:{"blocking.ad.unit.name":[{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"},{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"}]},impressionManagerConfig:{"ad.unit.name":{target:"all|section|homepage",frequency:"$1/$2(day|hour)",exposed:0,expires:(new Date).getTime()}},sso:c},window.dfpConfig),g=u.breakpointsConfig.breakpoints,h={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",target:"target",maxImpressions:"maxImpressions",hours:"hour",days:"day",adSlotId:"id"},f=function(){function e(t){d.classCallCheck(this,e),this.now=(new Date).getTime(),this.config=Object.assign({},t),this.impressions=this.retrieveImpressionsData(),this.initImpressionMap()}return d.createClass(e,[{key:"retrieveImpressionsData",value:function(){var e=this,t=this.migrateImpressionsData();Object.keys(t).map(function(i,n){t[i]=Object.assign({},t[i],e.config[i])});for(var i in t)t.hasOwnProperty(i)&&(t[i][h.frequency]||delete t[i]);return t}},{key:"migrateImpressionsData",value:function(){var e=this,t=void 0,i=void 0;try{i=window.localStorage.getItem(h.impressions)}catch(e){i=void 0}try{t=JSON.parse(i)}catch(r){t={};var n=i.split(";").filter(function(e){return e});n.forEach(function(i){try{var n=i.split(" = "),r=n[0],o=n[1],a=r.split("."),s=a.pop();s&&"hp"==s&&(s="homepage");var l=a.join("."),d=l+"_"+s,c=parseInt(o.split("/")[0])||0,u=parseInt(o.split("/")[1])||e.now;t[d]={},t[d][h.adSlotId]=l,t[d][h.target]=s,t[d][h.exposed]=c,t[d][h.expires]=u}catch(e){console.log("Failed converting impression: "+i,e)}})}return t||{}}},{key:"saveImpressionsToLocalStorage",value:function(){this.debouncedSave&&"function"==typeof this.debouncedSave?this.debouncedSave():(this.debouncedSave=o(this.saveImpressionsToLocalStorageImpl,250,!1),this.debouncedSave())}},{key:"saveImpressionsToLocalStorageImpl",value:function(){try{localStorage.setItem(h.impressions,JSON.stringify(this.impressions))}catch(e){console.log("localStorage isn't available:",e)}}},{key:"initImpressionMap",value:function(){var e=this;Object.keys(this.config).map(function(t,i){var n=t,r=void 0,o=!1;(r=e.impressions[n])?(e.config[n][h.frequency]=!r[h.frequency])?(o=!0,e.impressions[n][h.frequency]=e.config[n][h.frequency]):e.now>r[h.expires]&&(o=!0):e.initSlotFromConfig(n),o&&e.updateExpiryDate(n)})}},{key:"updateExpiryDate",value:function(e){var t=new Date;if(!this.impressions[e]||!this.impressions[e][h.frequency])throw new Error("Unable to update expiry date for slot: "+e+"\n      - this.impressions[slotName]:",this.impressions[e]);var i=this.impressions[e][h.frequency].match(h.frequencyRegex);t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),i.indexOf(h.days)>-1&&t.setHours(0),this.impressions[e][h.expires]=(i.indexOf(h.days)>-1?r(t,i[2]):n(t,i[2])).getTime(),this.impressions[e][h.maxImpressions]=parseInt(i[1]),this.impressions[e][h.exposed]=0}},{key:"initSlotFromConfig",value:function(e){var t=this.impressions[e]||{};t[h.frequency]=this.config[e][h.frequency],t[h.target]=this.config[e][h.target],t[h.exposed]=0,this.impressions[e]=t,this.updateExpiryDate(e)}},{key:"registerImpression",value:function(e){if(e){var t=this.impressions[e];if(t){var i=t[h.exposed];if(isNaN(parseInt(i))===!1){this.impressions[e][h.exposed]+=1;try{this.saveImpressionsToLocalStorage()}catch(e){console.log("Error saving ad impressions to localStorage!",e)}return!0}}}return!1}},{key:"reachedQuota",value:function(e){e=this.impressions[""+e+u.department]?""+e+u.department:e+"_all";var t=this.impressions[e],i=!1;if(t){var n=(new Date).getTime(),r=this.impressions[e][h.expires];if(n>r)this.updateExpiryDate(e);else{var o=this.impressions[e][h.maxImpressions];o&&(i=this.impressions[e][h.exposed]>=o)}}return i}},{key:"resetImpressions",value:function(){var e=this.impressions;for(var t in e)e.hasOwnProperty(t)&&e[t][h.exposed]&&(e[t][h.exposed]=0);this.saveImpressionsToLocalStorage()}}]),e}(),p={payer:"payer",registered:"registered",anonymous:"anonymous"},v=function(){function e(t){d.classCallCheck(this,e),this.config=Object.assign({},t.userConfig);var n=i();this.ssoKey=u.sso,n[this.ssoKey]||(this.ssoKey="tmsso"===this.ssoKey?"engsso":"tmsso"),this.type=this.getUserType(n),this.impressionManager=new f(t.impressionManagerConfig),this.age=this.getUserAge(n),this.gender=this.getUserGender(n)}return d.createClass(e,[{key:"getUserType",value:function(e){if(e&&e[this.ssoKey]){var t=window.location.hostname.indexOf("haaretz.com")>-1?"HdcPusr":"HtzPusr";return e[t]?p.payer:p.registered}return p.anonymous}},{key:"getUserAge",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].usrae;return i&&(t=parseInt(e[this.ssoKey].usrae),t=t>0?t:void 0),t}},{key:"getUserGender",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].urgdr;return i&&(t=parseInt(e[this.ssoKey].urgdr),t=2===t||1===t?t:void 0),t}}]),e}(),y=function(){function e(t){d.classCallCheck(this,e),this.dependencyMap=this.initializeDependencyMap(t),this.deferredSlots=new Set}return d.createClass(e,[{key:"initializeDependencyMap",value:function(e){var t=new Map;return Object.keys(e).map(function(i,n){var r=e[i];r&&(r=r.filter(function(e){return e.onsize&&e.avoid})),t.set(i,{id:i,rules:r,resolvedWith:null})}),t}},{key:"updateResolvedSlot",value:function(e,t){if(!e)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!t)throw new Error("updateResolvedSlot must be called with a resolved size!");this.dependencyMap.has(e)&&(this.dependencyMap.get(e).resolvedWith=t)}},{key:"isBlocked",value:function e(t){var i=this;if(!t)throw new Error("isBlocked must be called with an adSlotId!");var e=!1,n=!0,r=!1,o=void 0;try{for(var a,s=this.dependencyMap.keys()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,d=this.dependencyMap.get(l),c=!0,u=!1,g=void 0;try{for(var h,f=d.rules[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;p.avoid===t&&!function(){var n=d.resolvedWith;n||(e=!0,i.deferredSlots.add(t)),p.onsize.split(",").find(function(e){return e=e.split("x").map(function(e){return parseInt(e)}),i.arraysEqual(e,n)})&&(i.deferredSlots.add(t),e=!0)}()}}catch(e){u=!0,g=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw g}}}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return e}},{key:"isBlocking",value:function e(t){if(!t)throw new Error("isBlocking must be called with an adSlotId!");var e=!1,i=!0,n=!1,r=void 0;try{for(var o,a=this.dependencyMap.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;s===t&&(e=!0)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e}},{key:"getBlockedSlotsIds",value:function(e){return this.dependencyMap.has(e)?Array.from(this.dependencyMap.get(e).rules.map(function(e){return e.avoid})):void 0}},{key:"arraysEqual",value:function(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!=t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}}]),e}();y.EMPTY_SIZE=[];var m=function(){function e(t){if(d.classCallCheck(this,e),this.config=Object.assign({},t),this.id=this.config.id,!this.config.id)throw new Error("an adSlot requires an id!");this.target=this.config.target,this.type=this.config.type,this.responsive=this.config.responsive,this.user=this.config.user,this.adManager=this.config.adManager,this.department=this.config.department,this.network=this.config.network,this.adUnitBase=this.config.adUnitBase,this.adSizeMapping=this.config.adSizeMapping,this.responsiveAdSizeMapping=this.config.responsiveAdSizeMapping,this.blacklistReferrers=this.config.blacklistReferrers?this.config.blacklistReferrers.split(","):[],this.whitelistReferrers=this.config.whitelistReferrers?this.config.whitelistReferrers.split(","):[],this.lastResolvedSize=void 0,this.lastResolvedWithBreakpoint=void 0,this.slot=void 0;try{this.slot=this.defineSlot()}catch(e){console.log(e)}}return d.createClass(e,[{key:"isOutOfPage",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(1==this.isMobile())return!1;switch(this.type){case b.maavaron:return!0;case b.popunder:return!0;case b.talkback:return!1;case b.regular:return!1;default:return!1}}},{key:"isMaavaron",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(1==this.isMobile())return!1;switch(this.type){case b.maavaron:return!0;default:return!1}}},{key:"isMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")}},{key:"isWhitelisted",value:function(){var e=!1;if(0!==this.whitelistReferrers.length){var t=!0,i=!1,n=void 0;try{for(var r,o=this.whitelistReferrers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(u.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}else e=!0;return e}},{key:"isBlacklisted",value:function(){var e=!1;if(0!==this.blacklistReferrers.length){var t=!0,i=!1,n=void 0;try{for(var r,o=this.blacklistReferrers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(u.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}return e}},{key:"show",value:function(){var e=this;googletag.cmd.push(function(){document.getElementById(e.id).classList.remove("h-hidden"),googletag.display(e.id)})}},{key:"hide",value:function(){var e=this;googletag.cmd.push(function(){document.getElementById(e.id).classList.add("h-hidden")})}},{key:"defineSlot",value:function(){if(this.isMaavaron()){var e=this.defineMaavaron();return this.adManager.shouldSendRequestToDfp(this)&&e.display(),e}var t=window.googletag,i=t.pubads(),n=[],r=this.isOutOfPage()?t.defineOutOfPageSlot:t.defineSlot;n.push(this.getPath()),this.isOutOfPage()===!1&&n.push(this.adSizeMapping),n.push(this.id);var o=r.apply(r,n);if(o){if(this.responsive){var a=t.sizeMapping(),s=u.breakpointsConfig.breakpoints,l=Object.keys(this.responsiveAdSizeMapping),d=!0,c=!1,g=void 0;try{for(var h,f=l[Symbol.iterator]();!(d=(h=f.next()).done);d=!0){var p=h.value;a.addSize([s[p],100],this.responsiveAdSizeMapping[p])}}catch(e){c=!0,g=e}finally{try{!d&&f.return&&f.return()}finally{if(c)throw g}}a=a.build(),o=o.defineSizeMapping(a)}o=o.addService(i),this.isOutOfPage()===!1&&o.setCollapseEmptyDiv(!0)}return o}},{key:"getPath",value:function(){var e=this,t=u.path||[];t=t.filter(function(e){return"."!=e}),t=t.map(function(t){return""+e.id+e.department+t}).join("/"),t=t&&"_homepage"!==this.config.department?"/"+t:"";var i="/"+this.config.network+"/"+this.config.adUnitBase+"/"+this.id+"/"+this.id+this.department+t;return i.toLowerCase()}},{key:"slotRendered",value:function(e){e.slot.getAdUnitPath().split("/")[3],e.isEmpty,e.size}},{key:"refresh",value:function(){var e=this;googletag.cmd.push(function(){googletag.pubads().refresh([e.slot])})}},{key:"defineMaavaron",value:function(){if(!document.referrer.match("loc.haaretz")){var e=this.getPath(),t=[[2,1]],i=googletag.pubads().definePassback(e,t).setTargeting("UserType",[this.user.type]).setTargeting("age",[this.user.age]).setTargeting("urgdr",[this.user.gender]).setTargeting("articleId",[u.articleId]).setTargeting("stg",[u.environment]);return i}}}]),e}(),w={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},k={anonymous:"anonymous",registered:"registered",payer:"payer"},b={maavaron:".maavaron",popunder:".popunder",talkback:".talkback",regular:""},S=function(){function e(t){var i=this;d.classCallCheck(this,e),this.config=Object.assign({},t),this.user=new v(t),this.conflictResolver=new y(t.conflictManagementConfig);try{googletag.cmd.push(function(){i.initGoogleTargetingParams(),i.initSlotRenderedCallback()}),googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig)}),document.addEventListener("DOMContentLoaded",function(){googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig),i.initGoogleGlobalSettings()})})}catch(e){console.log(e)}}return d.createClass(e,[{key:"showAllSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.adSlots.keys()[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value,a=this.adSlots.get(o);a.type!==b.talkback&&this.shouldSendRequestToDfp(a)&&a.show()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"showAllDeferredSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.conflictResolver.deferredSlots[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;if(this.adSlots.has(o)&&!this.conflictResolver.isBlocked(o)){var a=this.adSlots.get(o);this.shouldSendRequestToDfp(a)&&a.show()}}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"refreshAllSlots",value:function(){var e=a(),t=!0,i=!1,n=void 0;try{for(var r,o=this.adSlots.keys()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,l=this.adSlots.get(s);l.responsive&&(l.lastResolvedWithBreakpoint!=e&&this.shouldSendRequestToDfp(l)?(console.log("calling refresh for adSlot: "+l.id),l.refresh()):l.hide())}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"initAdSlots",value:function(e){var t=this,i=new Map(this.adSlots),n=Array.from(document.getElementsByClassName("js-dfp-ad"));n=n.filter(function(e){return e.id});var r=new Set;return n=Array.prototype.filter.call(n,function(e){return r.has(e.id)===!1?(r.add(e.id),!0):!1}),n=n.sort(function(e,t){return e.offsetTop-t.offsetTop}),n.forEach(function(n){if(e[n.id]&&i.has(n.id)===!1)try{var r=Object.assign({},e[n.id],{id:n.id,target:n.attributes["data-audtarget"]?n.attributes["data-audtarget"].value:w.all,type:t.getAdType(n.id),responsive:e[n.id].responsive&&n.classList.contains("js-dfp-resp-refresh"),user:t.user,adManager:t,department:t.config.department,network:t.config.adManagerConfig.network,adUnitBase:t.config.adManagerConfig.adUnitBase});i.set(n.id,new m(r))}catch(e){console.log(e)}}),i}},{key:"getAdType",value:function(e){if(!e)throw new Error("Missing argument: a call to getAdType must have an adSlotId",this);return e.indexOf(b.maavaron)>-1?b.maavaron:e.indexOf(b.popunder)>-1?b.popunder:e.indexOf(b.talkback)>-1?b.talkback:b.regular}},{key:"shouldSendRequestToDfp",value:function(e){return this.conflictResolver.isBlocked(e.id)===!1&&e.isWhitelisted()&&e.isBlacklisted()===!1&&this.shouldDisplayAdAfterAdBlockRemoval(e)&&this.doesBreakpointContainAd(e)&&this.doesUserTypeMatchBannerTargeting(e)&&this.user.impressionManager.reachedQuota(e.id)===!1}},{key:"shouldDisplayAdAfterAdBlockRemoval",value:function(e){return!(this.config.adBlockRemoved&&(e.type===b.maavaron||e.type===b.popunder))}},{key:"doesUserTypeMatchBannerTargeting",value:function(e){var t=this.user.type,i="string"==typeof e?e:e.target;switch(i){case w.all:return!0;case w.nonPaying:return t===k.anonymous||t===k.registered;case w.anonymous:return t===k.anonymous;case w.registered:return t===k.registered;case w.paying:return t===k.payer;case w.digitalOnly:return t===k.payer;case w.digitalAndPrint:return t===k.payer;default:return!1}}},{key:"switchedToBreakpoint",value:function(e){if(!e)throw new Error("Missing argument: a call to switchedToBreakpoint must have an breakpoint",this);var t=0,i=!0,n=!1,r=void 0;try{for(var o,a=this.adSlots.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value,l=this.adSlots.get(s);l.responsive===!0&&l.lastResolvedWithBreakpoint&&l.lastResolvedWithBreakpoint!=e&&(l.refresh(),t++)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return t}},{key:"doesBreakpointContainAd",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?a():arguments[1];if(!e)throw new Error("Missing argument: a call to doesBreakpointContainAd must have an adSlot",this);t=t||a();var i=!0;if(e.responsive===!0){var n=e.responsiveAdSizeMapping[s(t)];if(Array.isArray(n)===!1)throw new Error("Invalid argument: breakpoint:"+t+" doesn't exist!",this);i=n.length>0&&!l(n,[0,0])}return i}},{key:"initSlotRenderedCallback",value:function(){var e=this;if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initSlotRenderedCallback' was called!");var t=window.googletag.pubads();t.addEventListener("slotRenderEnded",function(t){var i=t.slot.getAdUnitPath().split("/")[3],n=t.isEmpty,r=t.size;if(e.adSlots.has(i)){var o=e.adSlots.get(i);if(o.lastResolvedSize=r,o.lastResolvedWithBreakpoint=a(),n){if(o.hide(),e.conflictResolver.updateResolvedSlot(i,y.EMPTY_SIZE),e.conflictResolver.isBlocking(i)){var s=!0,l=!1,d=void 0;try{for(var c,u=e.conflictResolver.getBlockedSlotsIds(i)[Symbol.iterator]();!(s=(c=u.next()).done);s=!0){var g=c.value;e.conflictResolver.isBlocked(g)&&e.adSlots.has(g)&&e.adSlots.get(g).hide()}}catch(e){l=!0,d=e}finally{try{!s&&u.return&&u.return()}finally{if(l)throw d}}var h=!0,f=!1,p=void 0;try{for(var v,m=e.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(h=(v=m.next()).done);h=!0){var w=v.value,k=e.adSlots.get(w);k&&e.shouldSendRequestToDfp(k)&&(e.conflictResolver.deferredSlots.delete(w),k.show())}}catch(e){f=!0,p=e}finally{try{!h&&m.return&&m.return()}finally{if(f)throw p}}}}else{e.user.impressionManager.registerImpression(""+o.id+e.config.department),e.user.impressionManager.registerImpression(o.id+"_all");try{if(e.conflictResolver.updateResolvedSlot(i,r),e.conflictResolver.isBlocking(i)){var b=!0,S=!1,x=void 0;try{for(var R,M=e.conflictResolver.getBlockedSlotsIds(i)[Symbol.iterator]();!(b=(R=M.next()).done);b=!0){var g=R.value;e.conflictResolver.isBlocked(g)&&e.adSlots.has(g)&&e.adSlots.get(g).hide()}}catch(e){S=!0,x=e}finally{try{!b&&M.return&&M.return()}finally{if(S)throw x}}var I=!0,O=!1,T=void 0;try{for(var C,A=e.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(I=(C=A.next()).done);I=!0){var w=C.value,j=e.adSlots.get(w);j&&e.shouldSendRequestToDfp(j)&&(e.conflictResolver.deferredSlots.delete(w),j.show())}}catch(e){O=!0,T=e}finally{try{!I&&A.return&&A.return()}finally{if(O)throw T}}}}catch(e){console.log("Cannot update resolved adSlot: "+i+" - Ad Unit path is "+t.slot.getAdUnitPath())}}}else console.log("Cannot find an ad with id: "+i+" - Ad Unit path is "+t.slot.getAdUnitPath())})}},{key:"initGoogleTargetingParams",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleTargetingParams' was called!");var e=googletag.pubads();this.config.environment&&e.setTargeting("stg",[this.config.environment]),this.user.type&&e.setTargeting("UserType",[this.user.type]),this.user.age&&e.setTargeting("age",[this.user.age]),this.user.gender&&e.setTargeting("urgdr",[this.user.gender]),this.config.articleId&&e.setTargeting("articleId",[this.config.articleId]),this.config.gStatCampaignNumber&&-1!=this.config.gStatCampaignNumber&&e.setTargeting("gstat_campaign_id",[this.config.gStatCampaignNumber]),this.config.utm_.content&&e.setTargeting("utm_content",[this.config.utm_.content]),this.config.utm_.source&&e.setTargeting("utm_source",[this.config.utm_.source]),this.config.utm_.medium&&e.setTargeting("utm_medium",[this.config.utm_.medium]),this.config.utm_.campaign&&e.setTargeting("utm_campaign",[this.config.utm_.campaign]),this.config.adBlockRemoved&&e.setTargeting("adblock_removed",[this.config.adBlockRemoved]),e.setCentering(!0)}},{key:"initGoogleGlobalSettings",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleGlobalSettings' was called!");window.location.search&&window.location.search.indexOf("sraon")>0&&(console.log("enableSingleRequest mode: active"),googletag.pubads().enableSingleRequest()),this.config.isMobile?googletag.pubads().enableAsyncRendering():googletag.pubads().enableAsyncRendering(),googletag.enableServices()}}]),e}(),x=u||{},R=1e4,M=250,I=function(){function e(t){d.classCallCheck(this,e),this.config=Object.assign({},x,t),this.wasInitialized=!1,this.breakpoint=a(),this.initWindowResizeListener()}return d.createClass(e,[{key:"resumeInit",value:function(){try{this.adManager=new S(this.config)}catch(e){console.log(e)}}},{key:"initGoogleTag",value:function(){var e=this,t=this;return new Promise(function(i,n){1==t.wasInitialized||window.googletag&&window.googletag.apiReady?(e.adManager=e.adManager||new S(e.config),t.wasInitialized=!0,i(e.isGoogleTagReady)):(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var r=window.document.createElement("script");r.async=!1,r.type="text/javascript",r.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var o=window.document.getElementsByTagName("script")[0];r.onload=function(){t.wasInitialized=!0,t.resumeInit(),i(e.isGoogleTagReady)},r.onerror=function(e){t.wasInitialized=!1,n(e)},o.parentNode.insertBefore(r,o)}())})}},{key:"isGoogleTagReady",value:function(){var e=this,t=new Promise(function(t,i){googletag.cmd.push(function(){t(e)}),setTimeout(function(){googletag&&googletag.apiReady===!0||i(new Error("googletag failed to initialize on the page!"))},R)});return t}},{key:"initWindowResizeListener",value:function(){function e(){var e=a();if(t.breakpoint!=e){if(t.breakpoint=e,!t.adManager)throw new Error("initWindowResizeListener error - adManager instance is not available");t.adManager.refreshAllSlots()}}var t=this,i=o(e,M);window.onresize=i}}]),e}();I.version="1.6.0";var O=u,T=I.version;e.config=O,e.version=T,e.default=I});
//# sourceMappingURL=dfp.min.js.map