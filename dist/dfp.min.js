!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.DFP=e.DFP||{})}(this,function(e){"use strict";function t(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.separator,r=void 0===i?";":i,n=t.operator,o=void 0===n?"=":n,a={},s=e.split(r);return s.forEach(function(e){if("string"==typeof e){var t=e.split(o);2===t.length&&(a[t[0]]=decodeURIComponent(t[1]))}}),a}function i(){var e=t(document.cookie,{separator:/;\s?/});return"string"==typeof e.tmsso&&(e.tmsso=t(e.tmsso,{separator:":"})),"string"==typeof e.engsso&&(e.engsso=t(e.engsso,{separator:":"})),e}function r(e,t){if(!e)throw new SyntaxError("addHours called without a required 'date' parameter!");if(!t)throw new SyntaxError("addHours called without a required 'hours' parameter!");if(isNaN(parseInt(t,10)))throw new TypeError("addHours called with an invalid integer 'hours' parameter!");var i=new Date(e);return i.setHours(i.getHours()+parseInt(t,10)),i}function n(e,t){if(!e)throw new SyntaxError("addDays called without a required 'date' parameter!");if(!t)throw new SyntaxError("addDays called without a required 'days' parameter!");if(isNaN(parseInt(t,10)))throw new TypeError("addDays called with an invalid integer 'days' parameter!");var i=new Date(e);return i.setDate(i.getDate()+parseInt(t,10)),i}function o(e){var t=arguments.length<=1||void 0===arguments[1]?100:arguments[1],i=arguments[2],r=void 0;return function(){var n=this,o=arguments,a=function(){r=null,i||e.apply(n,o)},s=i&&!r;clearTimeout(r),r=setTimeout(a,t),s&&e.apply(n,o)}}function a(){var e=void 0,t=window.innerWidth;switch(t){case t<u.xs:e=u.xxs;break;case t<u.s:e=u.xs;break;case t<u.m:e=u.s;break;case t<u.l:e=u.m;break;case t<u.xl:e=u.l;break;case t<u.xxl:e=u.xl;break;default:e=u.xxl}return e}function s(e){var t=void 0,i=e||window.innerWidth;switch(i){case i<u.xs:t="xxs";break;case i<u.s:t="xs";break;case i<u.m:t="s";break;case i<u.l:t="m";break;case i<u.xl:t="l";break;case i<u.xxl:t="xl";break;default:t="xxl"}return t}function l(e,t){if(!e||!t)return!1;if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}var d=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",c=Object.assign({get referrer(){return document.referrer?document.referrer:""},get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname||3===this.environment},get department(){return this.isHomepage?"_homepage":"_section"},get domain(){var e=/([\d|\w]+)(\.co\.il|\.com)(.*)?/.exec(window.location.hostname),t=e?e[0]:window.location.hostname;return t},get path(){var e=this.articleId?window.location.pathname.split("/").slice(1,-1):window.location.pathname.split("/").slice(1);return e=e.filter(function(e){return"wwwMobileSite"!==e&&"whtzMobileSite"!==e}),e.map(function(e){return"."+e}).map(function(e,t,i){return i.slice(0,t+1).reduce(function(e,t){return e.concat(t)})})},get environment(){var e={dev:1,test:2,prod:3};return"8080"===window.location.port?e.dev:window.location.hostname.indexOf("pre.haaretz.co.il")>-1||window.location.hostname.indexOf("tmtest.themarker.com")>-1?e.test:window.location.pathname.indexOf("/cmlink/Haaretz.HomePage")>-1||window.location.pathname.indexOf("/cmlink/TheMarker.HomePage")>-1?e.prod:void 0},get articleId(){var e=/\d\.\d+/g.exec(window.location.pathname),t=void 0;return e&&(t=e.pop()),t},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(e){var t=RegExp("("+e+')(=)([^&"]+)').exec(window.location.search);return t&&t[3]?t[3]:void 0}},get adBlockRemoved(){var e=!1;try{localStorage.getItem("adblock_removed")&&(e=!0)}catch(e){}return e},get wifiLocation(){var e="",t=i();try{t&&t._htzwif&&(e="arcaffe"===t._htzwif?"ArCafe":"university")}catch(e){}return e},get gStatCampaignNumber(){var e=void 0;try{e=localStorage.getItem("GstatCampaign")?JSON.parse(localStorage.getItem("GstatCampaign")):void 0}catch(t){e=void 0}return e?e.CampaignNumber:void 0},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",responsive:!0,adSizeMapping:[["width1","height1"]].concat(["widthN","heightN"]),priority:"normal",fluid:!1,responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[["width1","height1"]].concat(["widthN","heightN"]),s:[["width1","height1"]].concat(["widthN","heightN"]),m:[["width1","height1"]].concat(["widthN","heightN"]),l:[["width1","height1"]].concat(["widthN","heightN"]),xl:[["width1","height1"]].concat(["widthN","heightN"]),xxl:[["width1","height1"]].concat(["widthN","heightN"])},blacklistReferrers:"comma, delimited, blacklisted, referrer, list",whitelistReferrers:"comma, delimited, referrer, list"}},adManagerConfig:{network:"9401",adUnitBase:"haaretz.co.il_Web"},breakpointsConfig:{get breakpoints(){var e=!0;return e?this.breakpoints1:this.breakpoints2},breakpoints1:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},breakpoints2:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920}},userConfig:{type:void 0,age:void 0,gender:void 0},conflictManagementConfig:{"blocking.ad.unit.name":[{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"},{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"}]},impressionManagerConfig:{"ad.unit.name":{target:"all|section|homepage",frequency:"$1/$2(day|hour)",exposed:0,expires:(new Date).getTime()}},sso:d},window.dfpConfig),u=c.breakpointsConfig.breakpoints,g=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},h=function(){function e(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}}(),f={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",target:"target",maxImpressions:"maxImpressions",hours:"hour",days:"day",adSlotId:"id"},p=function(){function e(t){g(this,e),this.now=(new Date).getTime(),this.config=Object.assign({},t),this.impressions=this.retrieveImpressionsData(),this.initImpressionMap()}return h(e,[{key:"retrieveImpressionsData",value:function(){var e=this,t=this.migrateImpressionsData();Object.keys(t).map(function(i,r){return t[i]=Object.assign({},t[i],e.config[i]),e});for(var i in t)({}).hasOwnProperty.call(t,i)&&(t[i][f.frequency]||delete t[i]);return t}},{key:"migrateImpressionsData",value:function(){var e=this,t=void 0,i=void 0;try{i=window.localStorage.getItem(f.impressions)}catch(e){i=void 0}try{t=JSON.parse(i)}catch(n){t={};var r=i.split(";").filter(function(e){return e});r.forEach(function(i){try{var r=i.split(" = "),n=r[0],o=r[1],a=n.split("."),s=a.pop();s&&"hp"===s&&(s="homepage");var l=a.join("."),d=l+"_"+s,c=parseInt(o.split("/")[0],10)||0,u=parseInt(o.split("/")[1],10)||e.now;t[d]={},t[d][f.adSlotId]=l,t[d][f.target]=s,t[d][f.exposed]=c,t[d][f.expires]=u}catch(e){}})}return t||{}}},{key:"saveImpressionsToLocalStorage",value:function(){this.debouncedSave&&"function"==typeof this.debouncedSave?this.debouncedSave():(this.debouncedSave=o(this.saveImpressionsToLocalStorageImpl,250,!1),this.debouncedSave())}},{key:"saveImpressionsToLocalStorageImpl",value:function(){try{localStorage.setItem(f.impressions,JSON.stringify(this.impressions))}catch(e){console.error("localStorage isn't available:",e)}}},{key:"initImpressionMap",value:function(){var e=this;Object.keys(this.config).map(function(t,i){var r=t,n=e.impressions[r],o=!1;return n?e.config[r][f.frequency]!==n[f.frequency]?(o=!0,e.impressions[r][f.frequency]=e.config[r][f.frequency]):e.now>n[f.expires]&&(o=!0):e.initSlotFromConfig(r),o&&e.updateExpiryDate(r),e})}},{key:"updateExpiryDate",value:function(e){var t=new Date;if(!this.impressions[e]||!this.impressions[e][f.frequency])throw new Error("Unable to update expiry date for slot: "+e+"\n      - this.impressions[slotName]:",this.impressions[e]);var i=this.impressions[e][f.frequency].match(f.frequencyRegex);t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),i.indexOf(f.days)>-1&&t.setHours(0),this.impressions[e][f.expires]=(i.indexOf(f.days)>-1?n(t,i[2]):r(t,i[2])).getTime(),this.impressions[e][f.maxImpressions]=parseInt(i[1],10),this.impressions[e][f.exposed]=0}},{key:"initSlotFromConfig",value:function(e){var t=this.impressions[e]||{};t[f.frequency]=this.config[e][f.frequency],t[f.target]=this.config[e][f.target],t[f.exposed]=0,this.impressions[e]=t,this.updateExpiryDate(e)}},{key:"registerImpression",value:function(e){if(e){var t=this.impressions[e];if(t){var i=t[f.exposed];if(isNaN(parseInt(i,10))===!1){this.impressions[e][f.exposed]+=1;try{this.saveImpressionsToLocalStorage()}catch(e){}return!0}}}return!1}},{key:"reachedQuota",value:function(e){var t=this.impressions[""+e+c.department]?""+e+c.department:e+"_all",i=this.impressions[t],r=!1;if(i){var n=(new Date).getTime(),o=this.impressions[t][f.expires];if(o<n)this.updateExpiryDate(t);else{var a=this.impressions[t][f.maxImpressions];a&&(r=this.impressions[t][f.exposed]>=a)}}return r}},{key:"resetImpressions",value:function(){var e=this.impressions;for(var t in e)({}).hasOwnProperty.call(e,t)&&e[t][f.exposed]&&(e[t][f.exposed]=0);this.saveImpressionsToLocalStorage()}}]),e}(),v={payer:"payer",registered:"registered",anonymous:"anonymous"},y=function(){function e(t){g(this,e),this.config=Object.assign({},t.userConfig);var r=i();this.ssoKey=c.sso,r[this.ssoKey]||(this.ssoKey="tmsso"===this.ssoKey?"engsso":"tmsso"),this.type=this.getUserType(r),this.impressionManager=new p(t.impressionManagerConfig),this.age=this.getUserAge(r),this.gender=this.getUserGender(r)}return h(e,[{key:"getUserType",value:function(e){var t=void 0;if(e&&e[this.ssoKey]){var i=window.location.hostname.indexOf("haaretz.com")>-1?"HdcPusr":"HtzPusr";t=e[i]?v.payer:v.registered}else t=v.anonymous;return t}},{key:"getUserAge",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].usrae;return i&&(t=parseInt(e[this.ssoKey].usrae,10),t=t>0?t:void 0),t}},{key:"getUserGender",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].urgdr;return i&&(t=parseInt(e[this.ssoKey].urgdr,10),t=2===t||1===t?t:void 0),t}}]),e}(),m=function(){function e(t){g(this,e),this.dependencyMap=this.initializeDependencyMap(t),this.deferredSlots=new Set}return h(e,[{key:"initializeDependencyMap",value:function(e){var t=this,i=new Map;return Object.keys(e).map(function(r,n){var o=e[r];return o&&(o=o.filter(function(e){return e.onsize&&e.avoid})),i.set(r,{id:r,rules:o,resolvedWith:null}),t}),i}},{key:"updateResolvedSlot",value:function(e,t){if(!e)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!t)throw new Error("updateResolvedSlot must be called with a resolved size!");this.dependencyMap.has(e)&&(this.dependencyMap.get(e).resolvedWith=t)}},{key:"isBlocked",value:function e(t){var i=this;if(!t)throw new Error("isBlocked must be called with an adSlotId!");var e=!1,r=!0,n=!1,o=void 0;try{for(var a,s=this.dependencyMap.keys()[Symbol.iterator]();!(r=(a=s.next()).done);r=!0){var l=a.value,d=this.dependencyMap.get(l),c=!0,u=!1,g=void 0;try{for(var h,f=d.rules[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;p.avoid===t&&!function(){var r=d.resolvedWith;r||(e=!0,i.deferredSlots.add(t)),p.onsize.split(",").find(function(e){var t=e.split("x").map(function(e){return parseInt(e,10)});return i.arraysEqual(t,r)})&&(i.deferredSlots.add(t),e=!0)}()}}catch(e){u=!0,g=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw g}}}}catch(e){n=!0,o=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw o}}return e}},{key:"isBlocking",value:function e(t){if(!t)throw new Error("isBlocking must be called with an adSlotId!");var e=!1,i=!0,r=!1,n=void 0;try{for(var o,a=this.dependencyMap.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;s===t&&(e=!0)}}catch(e){r=!0,n=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw n}}return e}},{key:"getBlockedSlotsIds",value:function(e){var t=void 0;return this.dependencyMap.has(e)&&(t=Array.from(this.dependencyMap.get(e).rules.map(function(e){return e.avoid}))),t||[]}},{key:"arraysEqual",value:function(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}}]),e}();m.EMPTY_SIZE=[];var w=function(){function e(t){if(g(this,e),this.config=Object.assign({},t),this.id=this.config.id,!this.config.id)throw new Error("an adSlot requires an id!");this.target=this.config.target,this.type=this.config.type,this.responsive=this.config.responsive,this.fluid=this.config.fluid,this.user=this.config.user,this.adManager=this.config.adManager,this.htmlElement=this.config.htmlElement,this.priority=this.config.priority,this.deferredSlot=this.config.deferredSlot,this.department=this.config.department,this.network=this.config.network,this.adUnitBase=this.config.adUnitBase,this.adSizeMapping=this.config.adSizeMapping,this.responsiveAdSizeMapping=this.config.responsiveAdSizeMapping,this.blacklistReferrers=this.config.blacklistReferrers?this.config.blacklistReferrers.split(","):[],this.whitelistReferrers=this.config.whitelistReferrers?this.config.whitelistReferrers.split(","):[],this.lastResolvedSize=void 0,this.lastResolvedWithBreakpoint=void 0,this.slot=void 0;try{this.deferredSlot||(this.slot=this.defineSlot())}catch(e){console.error(e)}}return h(e,[{key:"isOutOfPage",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case x.maavaron:return!0;case x.popunder:return!0;case x.talkback:return!1;case x.regular:return!1;default:return!1}}},{key:"isMaavaron",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case x.maavaron:return!0;default:return!1}}},{key:"isMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")}},{key:"isWhitelisted",value:function(){var e=!1;if(0!==this.whitelistReferrers.length){var t=!0,i=!1,r=void 0;try{for(var n,o=this.whitelistReferrers[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;if(c.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}}else e=!0;return e}},{key:"isBlacklisted",value:function(){var e=!1;if(0!==this.blacklistReferrers.length){var t=!0,i=!1,r=void 0;try{for(var n,o=this.blacklistReferrers[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var a=n.value;if(c.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}}return e}},{key:"show",value:function(){var e=this;!this.shown==!0&&(this.shown=!0,googletag.cmd.push(function(){e.deferredSlot&&(e.slot=e.defineSlot()),document.getElementById(e.id).classList.remove("h-hidden"),googletag.display(e.id)}))}},{key:"hide",value:function(){var e=this;googletag.cmd.push(function(){document.getElementById(e.id).classList.add("h-hidden")})}},{key:"defineSlot",value:function(){if(this.isMaavaron()){var e=this.defineMaavaron();return this.adManager.shouldSendRequestToDfp(this)&&(this.shown||(this.shown=!0,e.display())),e}var t=window.googletag,i=t.pubads(),r=[],n=this.isOutOfPage()?t.defineOutOfPageSlot:t.defineSlot;r.push(this.getPath()),this.isOutOfPage()===!1&&(this.fluid?r.push("fluid"):r.push(this.adSizeMapping)),r.push(this.id);var o=n.apply(n,r);if(o){if(this.responsive){var a=t.sizeMapping(),s=c.breakpointsConfig.breakpoints,l=Object.keys(this.responsiveAdSizeMapping),d=!0,u=!1,g=void 0;try{for(var h,f=l[Symbol.iterator]();!(d=(h=f.next()).done);d=!0){var p=h.value;a.addSize([s[p],100],this.responsiveAdSizeMapping[p])}}catch(e){u=!0,g=e}finally{try{!d&&f.return&&f.return()}finally{if(u)throw g}}a=a.build(),o=o.defineSizeMapping(a)}o=o.addService(i),this.isOutOfPage()===!1&&o.setCollapseEmptyDiv(!0)}return o}},{key:"getPath",value:function(){var e=this,t=c.path||[];t=t.filter(function(e){return"."!==e}),t=t.map(function(t){return""+e.id+e.department+t}).join("/"),t=t&&"_homepage"!==this.config.department?"/"+t:"";var i="/"+this.config.network+"/"+this.config.adUnitBase+"/"+this.id+"/"+this.id+this.department+t;return i.toLowerCase()}},{key:"slotRendered",value:function(e){e.slot.getAdUnitPath().split("/")[3],e.isEmpty,e.size}},{key:"refresh",value:function(){var e=this;googletag.cmd.push(function(){googletag.pubads().refresh([e.slot])})}},{key:"defineMaavaron",value:function(){if(!document.referrer.match("loc.haaretz")){var e=this.getPath(),t=[[2,1]],i=googletag.pubads().definePassback(e,t).setTargeting("UserType",[this.user.type]).setTargeting("age",[this.user.age]).setTargeting("urgdr",[this.user.gender]).setTargeting("articleId",[c.articleId]).setTargeting("stg",[c.environment]);return i}return null}}]),e}(),b={high:"high",normal:"normal",low:"low"},k={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},S={anonymous:"anonymous",registered:"registered",payer:"payer"},x={maavaron:".maavaron",popunder:".popunder",talkback:".talkback",regular:""},M=function(){function e(t){var i=this;g(this,e),this.config=Object.assign({},t),this.user=new y(t),this.conflictResolver=new m(t.conflictManagementConfig);try{googletag.cmd.push(function(){i.initGoogleTargetingParams(),i.initGoogleGlobalSettings(),i.initSlotRenderedCallback()}),googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,b.high)}),document.addEventListener("DOMContentLoaded",function(){googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,b.high),googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,b.normal)})})}),window.addEventListener("load",function(){googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,b.low)})})}catch(e){console.error(e)}}return h(e,[{key:"showAllSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.adSlots.keys()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value,a=this.adSlots.get(o);a.type!==x.talkback&&this.shouldSendRequestToDfp(a)&&a.show()}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"getAdSlotsByPriority",value:function(e){function t(t){return t.priority===e}return Array.from(this.adSlots.values()).filter(t)}},{key:"showAllDeferredSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.conflictResolver.deferredSlots[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var o=r.value;if(this.adSlots.has(o)&&!this.conflictResolver.isBlocked(o)){var a=this.adSlots.get(o);this.shouldSendRequestToDfp(a)&&a.show()}}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"refreshAllSlots",value:function(){var e=a(),t=!0,i=!1,r=void 0;try{for(var n,o=this.adSlots.keys()[Symbol.iterator]();!(t=(n=o.next()).done);t=!0){var s=n.value,l=this.adSlots.get(s);l.responsive&&(l.lastResolvedWithBreakpoint!==e&&this.shouldSendRequestToDfp(l)?l.refresh():l.hide())}}catch(e){i=!0,r=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw r}}}},{key:"initAdSlots",value:function(e,t){var i=this,r=new Map(this.adSlots),n=Array.from(document.getElementsByClassName("js-dfp-ad"));n=n.filter(function(e){return e.id});var o=new Set;return n=Array.prototype.filter.call(n,function(e){return o.has(e.id)===!1&&(o.add(e.id),!0)}),n.forEach(function(n){var o=e[n.id]?e[n.id].priority||b.normal:void 0;if(e[n.id]&&r.has(n.id)===!1&&o===t)try{var a=Object.assign({},e[n.id],{id:n.id,target:n.attributes["data-audtarget"]?n.attributes["data-audtarget"].value:k.all,type:i.getAdType(n.id),responsive:e[n.id].responsive,fluid:e[n.id].fluid||!1,user:i.user,adManager:i,htmlElement:n,department:i.config.department,network:i.config.adManagerConfig.network,adUnitBase:i.config.adManagerConfig.adUnitBase,deferredSlot:i.conflictResolver.isBlocked(n.id),priority:o}),s=new w(a);r.set(n.id,s),s.type!==x.talkback&&s.priority===b.high&&i.shouldSendRequestToDfp(s)&&s.show()}catch(e){console.error(e)}}),r}},{key:"isPriority",value:function(e){return"string"==typeof e&&(e.indexOf("plazma")>0||e.indexOf("maavaron")>0||e.indexOf("popunder")>0)}},{key:"getAdType",value:function(e){if(!e)throw new Error("Missing argument: a call to getAdType must have an adSlotId");return e.indexOf(x.maavaron)>-1?x.maavaron:e.indexOf(x.popunder)>-1?x.popunder:e.indexOf(x.talkback)>-1?x.talkback:x.regular}},{key:"shouldSendRequestToDfp",value:function(e){return this.conflictResolver.isBlocked(e.id)===!1&&e.isWhitelisted()&&e.isBlacklisted()===!1&&this.shouldDisplayAdAfterAdBlockRemoval(e)&&this.doesBreakpointContainAd(e)&&this.doesUserTypeMatchBannerTargeting(e)&&this.user.impressionManager.reachedQuota(e.id)===!1}},{key:"shouldDisplayAdAfterAdBlockRemoval",value:function(e){return!(this.config.adBlockRemoved===!0&&(e.type===x.maavaron||e.type===x.popunder))}},{key:"doesUserTypeMatchBannerTargeting",value:function(e){var t=this.user.type,i="string"==typeof e?e:e.target;switch(i){case k.all:return!0;case k.nonPaying:return t===S.anonymous||t===S.registered;case k.anonymous:return t===S.anonymous;case k.registered:return t===S.registered;case k.paying:return t===S.payer;case k.digitalOnly:return t===S.payer;case k.digitalAndPrint:return t===S.payer;default:return!1}}},{key:"switchedToBreakpoint",value:function(e){if(!e)throw new Error("Missing argument: a call to switchedToBreakpoint must have an breakpoint");var t=0,i=!0,r=!1,n=void 0;try{for(var o,a=this.adSlots.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value,l=this.adSlots.get(s);l.responsive===!0&&l.lastResolvedWithBreakpoint&&l.lastResolvedWithBreakpoint!==e&&(l.refresh(),t++)}}catch(e){r=!0,n=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw n}}return t}},{key:"doesBreakpointContainAd",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?a():arguments[1];if(!e)throw new Error("Missing argument: a call to doesBreakpointContainAd must have an adSlot");var i=!0;if(e.responsive===!0){var r=e.responsiveAdSizeMapping[s(t)];if(Array.isArray(r)===!1)throw new Error("Invalid argument: breakpoint:"+t+" doesn't exist!",this);i=r.length>0&&!l(r,[0,0])}return i}},{key:"initSlotRenderedCallback",value:function(){var e=this;if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initSlotRenderedCallback' was called!");var t=window.googletag.pubads();t.addEventListener("slotRenderEnded",function(t){var i=t.slot.getAdUnitPath().split("/")[3],r=t.isEmpty,n=t.size;if(e.adSlots.has(i)){var o=e.adSlots.get(i);o.lastResolvedSize=n,o.lastResolvedWithBreakpoint=a(),r?(o.lastResolvedSize=m.EMPTY_SIZE,o.hide(),e.releaseSlotDependencies(o)):(e.user.impressionManager.registerImpression(""+o.id+e.config.department),e.user.impressionManager.registerImpression(o.id+"_all"),e.releaseSlotDependencies(o,o.lastResolvedSize))}})}},{key:"releaseSlotDependencies",value:function(e){try{var t=e.id;if(this.conflictResolver.updateResolvedSlot(t,e.lastResolvedSize),this.conflictResolver.isBlocking(t)){var i=!0,r=!1,n=void 0;try{for(var o,a=this.conflictResolver.getBlockedSlotsIds(t)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;this.conflictResolver.isBlocked(s)&&this.adSlots.has(s)&&this.adSlots.get(s).hide()}}catch(e){r=!0,n=e}finally{try{!i&&a.return&&a.return()}finally{if(r)throw n}}var l=!0,d=!1,c=void 0;try{for(var u,g=this.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(l=(u=g.next()).done);l=!0){var h=u.value,f=this.adSlots.get(h);f&&this.shouldSendRequestToDfp(f)&&(this.conflictResolver.deferredSlots.delete(h),f.deferredSlot&&(f.defineSlot(),f.deferredSlot=!1),f.show())}}catch(e){d=!0,c=e}finally{try{!l&&g.return&&g.return()}finally{if(d)throw c}}}}catch(t){console.error("Cannot updateSlotDependencies for adSlot: "+e.id)}}},{key:"initGoogleTargetingParams",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleTargetingParams' was called!");var e=googletag.pubads();this.config.environment&&e.setTargeting("stg",[this.config.environment]),this.user.type&&e.setTargeting("UserType",[this.user.type]),this.user.age&&e.setTargeting("age",[this.user.age]),this.user.gender&&e.setTargeting("urgdr",[this.user.gender]),this.config.articleId&&e.setTargeting("articleId",[this.config.articleId]),this.config.gStatCampaignNumber&&this.config.gStatCampaignNumber!==-1&&e.setTargeting("gstat_campaign_id",[this.config.gStatCampaignNumber]),this.config.utm_.content&&e.setTargeting("utm_content",[this.config.utm_.content]),this.config.utm_.source&&e.setTargeting("utm_source",[this.config.utm_.source]),this.config.utm_.medium&&e.setTargeting("utm_medium",[this.config.utm_.medium]),this.config.utm_.campaign&&e.setTargeting("utm_campaign",[this.config.utm_.campaign]),this.config.adBlockRemoved&&e.setTargeting("adblock_removed",[this.config.adBlockRemoved]),this.config.wifiLocation&&e.setTargeting("wifi",[this.config.wifiLocation]),e.setCentering(!0)}},{key:"initGoogleGlobalSettings",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api wasn't ready when 'initGoogleGlobalSettings' was called!");window.location.search&&window.location.search.indexOf("sraon")>0&&(console.log("enableSingleRequest mode: active"),googletag.pubads().enableSingleRequest()),this.config.isMobile?googletag.pubads().enableAsyncRendering():googletag.pubads().enableAsyncRendering(),googletag.enableServices()}}]),e}(),R=c||{},O=1e4,I=250,T=function(){function e(t){g(this,e),this.config=Object.assign({},R,t),this.wasInitialized=!1,this.breakpoint=a(),this.initWindowResizeListener()}return h(e,[{key:"resumeInit",value:function(){try{this.adManager=new M(this.config)}catch(e){console.error(e)}}},{key:"initGoogleTag",value:function(){var e=this,t=this;return new Promise(function(i,r){t.wasInitialized===!0||window.googletag&&window.googletag.apiReady?(e.adManager=e.adManager||new M(e.config),t.wasInitialized=!0,i(e.isGoogleTagReady)):(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var n=window.document.createElement("script");n.async=!1,n.type="text/javascript",n.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var o=window.document.getElementsByTagName("script")[0];n.onload=function(){t.wasInitialized=!0,t.resumeInit(),i(e.isGoogleTagReady)},n.onerror=function(e){t.wasInitialized=!1,r(e)},o.parentNode.insertBefore(n,o)}())})}},{key:"isGoogleTagReady",value:function(){var e=this,t=new Promise(function(t,i){googletag.cmd.push(function(){t(e)}),setTimeout(function(){googletag&&googletag.apiReady===!0||i(new Error("googletag failed to initialize on the page!"))},O)});return t}},{key:"initWindowResizeListener",value:function(){function e(){var e=a();if(t.breakpoint!==e){if(t.breakpoint=e,!t.adManager)throw new Error("initWindowResizeListener error - adManager instance is not available");t.adManager.refreshAllSlots()}}var t=this,i=o(e,I);window.onresize=i}}]),e}();T.version="1.11.0";var A=c,E=T.version;e.config=A,e.version=E,e.default=T,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=dfp.min.js.map
