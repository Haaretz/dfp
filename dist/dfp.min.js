!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t(e.DFP=e.DFP||{})}(this,function(e){"use strict";function t(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],i=t.separator,n=void 0===i?";":i,r=t.operator,o=void 0===r?"=":r,a={},s=e.split(n);return s.forEach(function(e){if("string"==typeof e){var t=e.split(o);2===t.length&&(a[t[0]]=decodeURIComponent(t[1]))}}),a}function i(){var e=t(document.cookie,{separator:/;\s?/});return"string"==typeof e.tmsso&&(e.tmsso=t(e.tmsso,{separator:":"})),"string"==typeof e.engsso&&(e.engsso=t(e.engsso,{separator:":"})),e}function n(e,t){if(!e)throw new SyntaxError("addHours called without a required 'date' parameter!");if(!t)throw new SyntaxError("addHours called without a required 'hours' parameter!");if(isNaN(parseInt(t,10)))throw new TypeError("addHours called with an invalid integer 'hours' parameter!");var i=new Date(e);return i.setHours(i.getHours()+parseInt(t,10)),i}function r(e,t){if(!e)throw new SyntaxError("addDays called without a required 'date' parameter!");if(!t)throw new SyntaxError("addDays called without a required 'days' parameter!");if(isNaN(parseInt(t,10)))throw new TypeError("addDays called with an invalid integer 'days' parameter!");var i=new Date(e);return i.setDate(i.getDate()+parseInt(t,10)),i}function o(e){var t=arguments.length<=1||void 0===arguments[1]?100:arguments[1],i=arguments[2],n=void 0;return function(){var r=this,o=arguments,a=function(){n=null,i||e.apply(r,o)},s=i&&!n;clearTimeout(n),n=setTimeout(a,t),s&&e.apply(r,o)}}function a(){var e=void 0,t=window.innerWidth;switch(t){case t<y.xs:e=y.xxs;break;case t<y.s:e=y.xs;break;case t<y.m:e=y.s;break;case t<y.l:e=y.m;break;case t<y.xl:e=y.l;break;case t<y.xxl:e=y.xl;break;default:e=y.xxl}return e}function s(e){var t=void 0,i=e||window.innerWidth;switch(i){case i<y.xs:t="xxs";break;case i<y.s:t="xs";break;case i<y.m:t="s";break;case i<y.l:t="m";break;case i<y.xl:t="l";break;case i<y.xxl:t="xl";break;default:t="xxl"}return t}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e||!t)return!1;if(!Array.isArray(e)||!Array.isArray(t))return!1;if(e===t)return!0;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var p=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",v=Object.assign({get referrer(){return document.referrer?document.referrer:""},get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname||3===this.environment},get department(){return this.isHomepage?"_homepage":"_section"},get domain(){var e=/([\d|\w]+)(\.co\.il|\.com)(.*)?/.exec(window.location.hostname),t=e?e[0]:window.location.hostname;return t},get path(){var e=this.articleId?window.location.pathname.split("/").slice(1,-1):window.location.pathname.split("/").slice(1);return e=e.filter(function(e){return"wwwMobileSite"!==e&&"whtzMobileSite"!==e}),e.map(function(e){return"."+e}).map(function(e,t,i){return i.slice(0,t+1).reduce(function(e,t){return e.concat(t)})})},get environment(){var e={dev:1,test:2,prod:3};return"8080"===window.location.port?e.dev:window.location.hostname.indexOf("pre.haaretz.co.il")>-1||window.location.hostname.indexOf("tmtest.themarker.com")>-1?e.test:window.location.pathname.indexOf("/cmlink/Haaretz.HomePage")>-1||window.location.pathname.indexOf("/cmlink/TheMarker.HomePage")>-1?e.prod:void 0},get articleId(){var e=/\d\.\d+/g.exec(window.location.pathname),t="0";return e&&(t=e.pop()),t},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(e){var t=RegExp("("+e+')(=)([^&"]+)').exec(window.location.search);return t&&t[3]?t[3]:void 0}},get adBlockRemoved(){var e=!1;try{localStorage.getItem("adblock_removed")&&(e=!0)}catch(e){}return e},get wifiLocation(){var e="",t=i();try{t&&t._htzwif&&(e="arcaffe"===t._htzwif?"ArCafe":"university")}catch(e){}return e},get gStatCampaignNumber(){var e=void 0;try{e=localStorage.getItem("GstatCampaign")?JSON.parse(localStorage.getItem("GstatCampaign")):void 0}catch(t){e=void 0}return e?e.CampaignNumber:void 0},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",responsive:!0,adSizeMapping:[["width1","height1"]].concat(["widthN","heightN"]),priority:"normal",fluid:!1,responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[["width1","height1"]].concat(["widthN","heightN"]),s:[["width1","height1"]].concat(["widthN","heightN"]),m:[["width1","height1"]].concat(["widthN","heightN"]),l:[["width1","height1"]].concat(["widthN","heightN"]),xl:[["width1","height1"]].concat(["widthN","heightN"]),xxl:[["width1","height1"]].concat(["widthN","heightN"])},blacklistReferrers:"comma, delimited, blacklisted, referrer, list",whitelistReferrers:"comma, delimited, referrer, list"}},adManagerConfig:{network:"9401",adUnitBase:"haaretz.co.il_Web"},breakpointsConfig:{get breakpoints(){var e=!0;return e?this.breakpoints1:this.breakpoints2},breakpoints1:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},breakpoints2:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920}},userConfig:{type:void 0,age:void 0,gender:void 0},conflictManagementConfig:{"blocking.ad.unit.name":[{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"},{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"}]},impressionManagerConfig:{"ad.unit.name":{target:"all|section|homepage",frequency:"$1/$2(day|hour)",exposed:0,expires:(new Date).getTime()}},sso:p},window.dfpConfig),y=v.breakpointsConfig.breakpoints,m=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),w={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",target:"target",maxImpressions:"maxImpressions",hours:"hour",days:"day",adSlotId:"id"},b=function(){function e(t){l(this,e),this.now=(new Date).getTime(),this.config=Object.assign({},t),this.impressions=this.retrieveImpressionsData(),this.initImpressionMap()}return m(e,[{key:"retrieveImpressionsData",value:function(){var e=this,t=this.migrateImpressionsData();Object.keys(t).map(function(i,n){return t[i]=Object.assign({},t[i],e.config[i]),e});for(var i in t)({}).hasOwnProperty.call(t,i)&&(t[i][w.frequency]||delete t[i]);return t}},{key:"migrateImpressionsData",value:function(){var e=this,t=void 0,i=void 0;try{i=window.localStorage.getItem(w.impressions)}catch(e){i=void 0}try{t=JSON.parse(i)}catch(r){t={};var n=i.split(";").filter(function(e){return e});n.forEach(function(i){try{var n=i.split(" = "),r=n[0],o=n[1],a=r.split("."),s=a.pop();s&&"hp"===s&&(s="homepage");var l=a.join("."),d=l+"_"+s,c=parseInt(o.split("/")[0],10)||0,u=parseInt(o.split("/")[1],10)||e.now;t[d]={},t[d][w.adSlotId]=l,t[d][w.target]=s,t[d][w.exposed]=c,t[d][w.expires]=u}catch(e){}})}return t||{}}},{key:"saveImpressionsToLocalStorage",value:function(){this.debouncedSave&&"function"==typeof this.debouncedSave?this.debouncedSave():(this.debouncedSave=o(this.saveImpressionsToLocalStorageImpl,250,!1),this.debouncedSave())}},{key:"saveImpressionsToLocalStorageImpl",value:function(){try{localStorage.setItem(w.impressions,JSON.stringify(this.impressions))}catch(e){console.error("localStorage isn't available:",e)}}},{key:"initImpressionMap",value:function(){var e=this;Object.keys(this.config).map(function(t,i){var n=t,r=e.impressions[n],o=!1;return r?e.config[n][w.frequency]!==r[w.frequency]?(o=!0,e.impressions[n][w.frequency]=e.config[n][w.frequency]):e.now>r[w.expires]&&(o=!0):e.initSlotFromConfig(n),o&&e.updateExpiryDate(n),e})}},{key:"updateExpiryDate",value:function(e){var t=new Date;if(!this.impressions[e]||!this.impressions[e][w.frequency])throw new Error("Unable to update expiry date for slot: "+e+"\n      - this.impressions[slotName]:",this.impressions[e]);var i=this.impressions[e][w.frequency].match(w.frequencyRegex);t.setMilliseconds(0),t.setSeconds(0),t.setMinutes(0),i.indexOf(w.days)>-1&&t.setHours(0),this.impressions[e][w.expires]=(i.indexOf(w.days)>-1?r(t,i[2]):n(t,i[2])).getTime(),this.impressions[e][w.maxImpressions]=parseInt(i[1],10),this.impressions[e][w.exposed]=0}},{key:"initSlotFromConfig",value:function(e){var t=this.impressions[e]||{};t[w.frequency]=this.config[e][w.frequency],t[w.target]=this.config[e][w.target],t[w.exposed]=0,this.impressions[e]=t,this.updateExpiryDate(e)}},{key:"registerImpression",value:function(e){if(e){var t=this.impressions[e];if(t){var i=t[w.exposed];if(isNaN(parseInt(i,10))===!1){this.impressions[e][w.exposed]+=1;try{this.saveImpressionsToLocalStorage()}catch(e){}return!0}}}return!1}},{key:"reachedQuota",value:function(e){var t=this.impressions[""+e+v.department]?""+e+v.department:e+"_all",i=this.impressions[t],n=!1;if(i){var r=(new Date).getTime(),o=this.impressions[t][w.expires];if(o<r)this.updateExpiryDate(t);else{var a=this.impressions[t][w.maxImpressions];a&&(n=this.impressions[t][w.exposed]>=a)}}return n}},{key:"resetImpressions",value:function(){var e=this.impressions;for(var t in e)({}).hasOwnProperty.call(e,t)&&e[t][w.exposed]&&(e[t][w.exposed]=0);this.saveImpressionsToLocalStorage()}}]),e}(),k=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),S={payer:"payer",registered:"registered",anonymous:"anonymous"},x=function(){function e(t){d(this,e),this.config=Object.assign({},t.userConfig);var n=i();this.ssoKey=v.sso,n[this.ssoKey]||(this.ssoKey="tmsso"===this.ssoKey?"engsso":"tmsso"),this.type=this.getUserType(n),this.impressionManager=new b(t.impressionManagerConfig),this.age=this.getUserAge(n),this.gender=this.getUserGender(n)}return k(e,[{key:"getUserType",value:function(e){var t=void 0;if(e&&e[this.ssoKey]){var i=window.location.hostname.indexOf("haaretz.com")>-1?"HdcPusr":"HtzPusr";t=e[i]?S.payer:S.registered}else t=S.anonymous;return t}},{key:"getUserAge",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].usrae;return i&&(t=parseInt(e[this.ssoKey].usrae,10),t=t>0?t:void 0),t}},{key:"getUserGender",value:function(e){var t=void 0,i=e[this.ssoKey]&&e[this.ssoKey].urgdr;return i&&(t=parseInt(e[this.ssoKey].urgdr,10),t=2===t||1===t?t:void 0),t}}]),e}(),O=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),M=function(){function e(t){c(this,e),this.dependencyMap=this.initializeDependencyMap(t),this.deferredSlots=new Set}return O(e,[{key:"initializeDependencyMap",value:function(e){var t=this,i=new Map;return Object.keys(e).map(function(n,r){var o=e[n];return o&&(o=o.filter(function(e){return e.onsize&&e.avoid})),i.set(n,{id:n,rules:o,resolvedWith:null}),t}),i}},{key:"updateResolvedSlot",value:function(e,t){if(!e)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!t)throw new Error("updateResolvedSlot must be called with a resolved size!");this.dependencyMap.has(e)&&(this.dependencyMap.get(e).resolvedWith=t)}},{key:"isBlocked",value:function e(t){var i=this;if(!t)throw new Error("isBlocked must be called with an adSlotId!");var e=!1,n=!0,r=!1,o=void 0;try{for(var a,s=this.dependencyMap.keys()[Symbol.iterator]();!(n=(a=s.next()).done);n=!0){var l=a.value,d=this.dependencyMap.get(l),c=!0,u=!1,g=void 0;try{for(var h,f=d.rules[Symbol.iterator]();!(c=(h=f.next()).done);c=!0){var p=h.value;p.avoid===t&&!function(){var n=d.resolvedWith;n||(e=!0,i.deferredSlots.add(t)),p.onsize.split(",").find(function(e){var t=e.split("x").map(function(e){return parseInt(e,10)});return i.arraysEqual(t,n)})&&(i.deferredSlots.add(t),e=!0)}()}}catch(e){u=!0,g=e}finally{try{!c&&f.return&&f.return()}finally{if(u)throw g}}}}catch(e){r=!0,o=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw o}}return e}},{key:"isBlocking",value:function e(t){if(!t)throw new Error("isBlocking must be called with an adSlotId!");var e=!1,i=!0,n=!1,r=void 0;try{for(var o,a=this.dependencyMap.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;s===t&&(e=!0)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return e}},{key:"getBlockedSlotsIds",value:function(e){var t=void 0;return this.dependencyMap.has(e)&&(t=Array.from(this.dependencyMap.get(e).rules.map(function(e){return e.avoid}))),t||[]}},{key:"arraysEqual",value:function(e,t){if(e===t)return!0;if(null===e||null===t)return!1;if(e.length!==t.length)return!1;for(var i=0;i<e.length;++i)if(e[i]!==t[i])return!1;return!0}}]),e}();M.EMPTY_SIZE=[];var R=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),T=function(){function e(t){if(u(this,e),this.config=Object.assign({},t),this.id=this.config.id,!this.config.id)throw new Error("an adSlot requires an id!");this.target=this.config.target,this.type=this.config.type,this.responsive=this.config.responsive,this.fluid=this.config.fluid,this.user=this.config.user,this.adManager=this.config.adManager,this.htmlElement=this.config.htmlElement,this.priority=this.config.priority,this.deferredSlot=this.config.deferredSlot,this.department=this.config.department,this.network=this.config.network,this.adUnitBase=this.config.adUnitBase,this.adSizeMapping=this.config.adSizeMapping,this.responsiveAdSizeMapping=this.config.responsiveAdSizeMapping,this.blacklistReferrers=this.config.blacklistReferrers?this.config.blacklistReferrers.split(","):[],this.whitelistReferrers=this.config.whitelistReferrers?this.config.whitelistReferrers.split(","):[],this.lastResolvedSize=void 0,this.lastResolvedWithBreakpoint=void 0,this.slot=void 0;try{this.deferredSlot||(this.slot=this.defineSlot())}catch(e){console.error(e)}}return R(e,[{key:"isOutOfPage",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case P.maavaron:return!0;case P.popunder:return!0;case P.talkback:return!1;case P.regular:return!1;default:return!1}}},{key:"isMaavaron",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(this.isMobile()===!0)return!1;switch(this.type){case P.maavaron:return!0;default:return!1}}},{key:"isMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")}},{key:"isWhitelisted",value:function(){var e=!1;if(0!==this.whitelistReferrers.length){var t=!0,i=!1,n=void 0;try{for(var r,o=this.whitelistReferrers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(v.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}else e=!0;return e}},{key:"isBlacklisted",value:function(){var e=!1;if(0!==this.blacklistReferrers.length){var t=!0,i=!1,n=void 0;try{for(var r,o=this.blacklistReferrers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(v.referrer.indexOf(a)>-1){e=!0;break}}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}return e}},{key:"show",value:function(){var e=this;!this.shown==!0&&(this.shown=!0,googletag.cmd.push(function(){e.deferredSlot&&(e.slot=e.defineSlot()),document.getElementById(e.id).classList.remove("h-hidden"),googletag.display(e.id)}))}},{key:"hide",value:function(){var e=this;googletag.cmd.push(function(){document.getElementById(e.id).classList.add("h-hidden")})}},{key:"defineSlot",value:function(){if(this.isMaavaron()){var e=this.defineMaavaron();return this.adManager.shouldSendRequestToDfp(this)&&(this.shown||(this.shown=!0,e.display())),e}var t=window.googletag,i=t.pubads(),n=[],r=this.isOutOfPage()?t.defineOutOfPageSlot:t.defineSlot;n.push(this.getPath()),this.isOutOfPage()===!1&&(this.fluid?n.push("fluid"):n.push(this.adSizeMapping)),n.push(this.id);var o=r.apply(r,n);if(o){if(this.responsive){var a=t.sizeMapping(),s=v.breakpointsConfig.breakpoints,l=Object.keys(this.responsiveAdSizeMapping),d=!0,c=!1,u=void 0;try{for(var g,h=l[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var f=g.value;a.addSize([s[f],100],this.responsiveAdSizeMapping[f])}}catch(e){c=!0,u=e}finally{try{!d&&h.return&&h.return()}finally{if(c)throw u}}a=a.build(),o=o.defineSizeMapping(a)}o=o.addService(i),this.isOutOfPage()===!1&&o.setCollapseEmptyDiv(!0)}return o}},{key:"getPath",value:function(){var e=this,t=v.path||[];t=t.filter(function(e){return"."!==e}),t=t.map(function(t){return""+e.id+e.department+t}).join("/"),t=t&&"_homepage"!==this.config.department?"/"+t:"";var i="/"+this.config.network+"/"+this.config.adUnitBase+"/"+this.id+"/"+this.id+this.department+t;return i.toLowerCase()}},{key:"slotRendered",value:function(e){e.slot.getAdUnitPath().split("/")[3],e.isEmpty,e.size}},{key:"refresh",value:function(){var e=this;googletag.cmd.push(function(){googletag.pubads().refresh([e.slot])})}},{key:"defineMaavaron",value:function(){if(!document.referrer.match("loc.haaretz")){var e=this.getPath(),t=[[2,1]],i=googletag.pubads().definePassback(e,t).setTargeting("UserType",[this.user.type]).setTargeting("age",[this.user.age]).setTargeting("urgdr",[this.user.gender]).setTargeting("articleId",[v.articleId]).setTargeting("stg",[v.environment]);return i}return null}}]),e}(),I=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),E={high:"high",normal:"normal",low:"low"},j={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},A={anonymous:"anonymous",registered:"registered",payer:"payer"},P={maavaron:".maavaron",popunder:".popunder",talkback:".talkback",regular:""},z=function(){function e(t){var i=this;h(this,e),this.config=Object.assign({},t),this.user=new x(t),this.conflictResolver=new M(t.conflictManagementConfig);try{googletag.cmd.push(function(){i.initGoogleTargetingParams(),i.initGoogleGlobalSettings(),i.initSlotRenderedCallback()}),googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,E.high)}),document.addEventListener("DOMContentLoaded",function(){googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,E.high),googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,E.normal)})})}),window.addEventListener("load",function(){googletag.cmd.push(function(){i.adSlots=i.initAdSlots(t.adSlotConfig,E.low)})})}catch(e){console.error(e)}}return I(e,[{key:"showAllSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.adSlots.keys()[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value,a=this.adSlots.get(o);a.type!==P.talkback&&this.shouldSendRequestToDfp(a)&&a.show()}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"getAdSlotsByPriority",value:function(e){function t(t){return t.priority===e}return Array.from(this.adSlots.values()).filter(t)}},{key:"showAllDeferredSlots",value:function(){var e=!0,t=!1,i=void 0;try{for(var n,r=this.conflictResolver.deferredSlots[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;if(this.adSlots.has(o)&&!this.conflictResolver.isBlocked(o)){var a=this.adSlots.get(o);this.shouldSendRequestToDfp(a)&&a.show()}}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}}},{key:"refreshAllSlots",value:function(){var e=a(),t=!0,i=!1,n=void 0;try{for(var r,o=this.adSlots.keys()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value,l=this.adSlots.get(s);l.responsive&&(l.lastResolvedWithBreakpoint!==e&&this.shouldSendRequestToDfp(l)?l.refresh():l.hide())}}catch(e){i=!0,n=e}finally{try{!t&&o.return&&o.return()}finally{if(i)throw n}}}},{key:"initAdSlots",value:function(e,t){var i=this,n=new Map(this.adSlots),r=Array.from(document.getElementsByClassName("js-dfp-ad"));r=r.filter(function(e){return e.id});var o=new Set;return r=Array.prototype.filter.call(r,function(e){return o.has(e.id)===!1&&(o.add(e.id),!0)}),r.forEach(function(r){var o=e[r.id]?e[r.id].priority||E.normal:void 0;if(e[r.id]&&n.has(r.id)===!1&&o===t)try{var a=Object.assign({},e[r.id],{id:r.id,target:r.attributes["data-audtarget"]?r.attributes["data-audtarget"].value:j.all,type:i.getAdType(r.id),responsive:e[r.id].responsive,fluid:e[r.id].fluid||!1,user:i.user,adManager:i,htmlElement:r,department:i.config.department,network:i.config.adManagerConfig.network,adUnitBase:i.config.adManagerConfig.adUnitBase,deferredSlot:i.conflictResolver.isBlocked(r.id),priority:o}),s=new T(a);n.set(r.id,s),s.type!==P.talkback&&s.priority===E.high&&i.shouldSendRequestToDfp(s)&&s.show()}catch(e){console.error(e)}}),n}},{key:"isPriority",value:function(e){return"string"==typeof e&&(e.indexOf("plazma")>0||e.indexOf("maavaron")>0||e.indexOf("popunder")>0)}},{key:"getAdType",value:function(e){if(!e)throw new Error("Missing argument: a call to getAdType must have an adSlotId");return e.indexOf(P.maavaron)>-1?P.maavaron:e.indexOf(P.popunder)>-1?P.popunder:e.indexOf(P.talkback)>-1?P.talkback:P.regular}},{key:"shouldSendRequestToDfp",value:function(e){return this.conflictResolver.isBlocked(e.id)===!1&&e.isWhitelisted()&&e.isBlacklisted()===!1&&this.shouldDisplayAdAfterAdBlockRemoval(e)&&this.doesBreakpointContainAd(e)&&this.doesUserTypeMatchBannerTargeting(e)&&this.user.impressionManager.reachedQuota(e.id)===!1}},{key:"shouldDisplayAdAfterAdBlockRemoval",value:function(e){return!(this.config.adBlockRemoved===!0&&(e.type===P.maavaron||e.type===P.popunder))}},{key:"doesUserTypeMatchBannerTargeting",value:function(e){var t=this.user.type,i="string"==typeof e?e:e.target;switch(i){case j.all:return!0;case j.nonPaying:return t===A.anonymous||t===A.registered;case j.anonymous:return t===A.anonymous;case j.registered:return t===A.registered;case j.paying:return t===A.payer;case j.digitalOnly:return t===A.payer;case j.digitalAndPrint:return t===A.payer;default:return!1}}},{key:"switchedToBreakpoint",value:function(e){if(!e)throw new Error("Missing argument: a call to switchedToBreakpoint must have an breakpoint");var t=0,i=!0,n=!1,r=void 0;try{for(var o,a=this.adSlots.keys()[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value,l=this.adSlots.get(s);l.responsive===!0&&l.lastResolvedWithBreakpoint&&l.lastResolvedWithBreakpoint!==e&&(l.refresh(),t++)}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}return t}},{key:"doesBreakpointContainAd",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?a():arguments[1];if(!e)throw new Error("Missing argument: a call to doesBreakpointContainAd must have an adSlot");var i=!0;if(e.responsive===!0){var n=e.responsiveAdSizeMapping[s(t)];if(Array.isArray(n)===!1)throw new Error("Invalid argument: breakpoint:"+t+" doesn't exist!",this);i=n.length>0&&!g(n,[0,0])}return i}},{key:"initSlotRenderedCallback",value:function(){var e=this;if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initSlotRenderedCallback' was called!");var t=window.googletag.pubads();t.addEventListener("slotRenderEnded",function(t){var i=t.slot.getAdUnitPath().split("/")[3],n=t.isEmpty,r=t.size;if(e.adSlots.has(i)){var o=e.adSlots.get(i);o.lastResolvedSize=r,o.lastResolvedWithBreakpoint=a(),n?(o.lastResolvedSize=M.EMPTY_SIZE,o.hide(),e.releaseSlotDependencies(o)):(e.user.impressionManager.registerImpression(""+o.id+e.config.department),e.user.impressionManager.registerImpression(o.id+"_all"),e.releaseSlotDependencies(o,o.lastResolvedSize))}})}},{key:"releaseSlotDependencies",value:function(e){try{var t=e.id;if(this.conflictResolver.updateResolvedSlot(t,e.lastResolvedSize),this.conflictResolver.isBlocking(t)){var i=!0,n=!1,r=void 0;try{for(var o,a=this.conflictResolver.getBlockedSlotsIds(t)[Symbol.iterator]();!(i=(o=a.next()).done);i=!0){var s=o.value;this.conflictResolver.isBlocked(s)&&this.adSlots.has(s)&&this.adSlots.get(s).hide()}}catch(e){n=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(n)throw r}}var l=!0,d=!1,c=void 0;try{for(var u,g=this.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(l=(u=g.next()).done);l=!0){var h=u.value,f=this.adSlots.get(h);f&&this.shouldSendRequestToDfp(f)&&(this.conflictResolver.deferredSlots.delete(h),f.deferredSlot&&(f.defineSlot(),f.deferredSlot=!1),f.show())}}catch(e){d=!0,c=e}finally{try{!l&&g.return&&g.return()}finally{if(d)throw c}}}}catch(t){console.error("Cannot updateSlotDependencies for adSlot: "+e.id)}}},{key:"initGoogleTargetingParams",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleTargetingParams' was called!");var e=googletag.pubads();this.config.environment&&e.setTargeting("stg",[this.config.environment]),this.user.type&&e.setTargeting("UserType",[this.user.type]),this.user.age&&e.setTargeting("age",[this.user.age]),this.user.gender&&e.setTargeting("urgdr",[this.user.gender]),this.config.articleId&&e.setTargeting("articleId",[this.config.articleId]),this.config.gStatCampaignNumber&&this.config.gStatCampaignNumber!==-1&&e.setTargeting("gstat_campaign_id",[this.config.gStatCampaignNumber]),this.config.utm_.content&&e.setTargeting("utm_content",[this.config.utm_.content]),this.config.utm_.source&&e.setTargeting("utm_source",[this.config.utm_.source]),this.config.utm_.medium&&e.setTargeting("utm_medium",[this.config.utm_.medium]),this.config.utm_.campaign&&e.setTargeting("utm_campaign",[this.config.utm_.campaign]),this.config.adBlockRemoved&&e.setTargeting("adblock_removed",[this.config.adBlockRemoved]),this.config.wifiLocation&&e.setTargeting("wifi",[this.config.wifiLocation]),e.setCentering(!0)}},{key:"initGoogleGlobalSettings",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api wasn't ready when 'initGoogleGlobalSettings' was called!");window.location.search&&window.location.search.indexOf("sraon")>0&&(console.log("enableSingleRequest mode: active"),googletag.pubads().enableSingleRequest()),this.config.isMobile?googletag.pubads().enableAsyncRendering():googletag.pubads().enableAsyncRendering(),googletag.enableServices()}}]),e}(),B=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),C=v||{},D=1e4,_=250,N=function(){function e(t){f(this,e),this.config=Object.assign({},C,t),this.wasInitialized=!1,this.breakpoint=a(),this.initWindowResizeListener()}return B(e,[{key:"resumeInit",value:function(){try{this.adManager=new z(this.config)}catch(e){console.error(e)}}},{key:"initGoogleTag",value:function(){var e=this,t=this;return new Promise(function(i,n){t.wasInitialized===!0||window.googletag&&window.googletag.apiReady?(e.adManager=e.adManager||new z(e.config),t.wasInitialized=!0,i(e.isGoogleTagReady)):(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var r=window.document.createElement("script");r.async=!1,r.type="text/javascript",r.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var o=window.document.getElementsByTagName("script")[0];r.onload=function(){t.wasInitialized=!0,t.resumeInit(),i(e.isGoogleTagReady)},r.onerror=function(e){t.wasInitialized=!1,n(e)},o.parentNode.insertBefore(r,o)}())})}},{key:"isGoogleTagReady",value:function(){var e=this,t=new Promise(function(t,i){googletag.cmd.push(function(){t(e)}),setTimeout(function(){googletag&&googletag.apiReady===!0||i(new Error("googletag failed to initialize on the page!"))},D)});return t}},{key:"initWindowResizeListener",value:function(){function e(){var e=a();if(t.breakpoint!==e){if(t.breakpoint=e,!t.adManager)throw new Error("initWindowResizeListener error - adManager instance is not available");t.adManager.refreshAllSlots()}}var t=this,i=o(e,_);window.onresize=i}}]),e}(),q="1.12.1";N.version=q||"1.12.1";var U=v,G=N.version;e.config=U,e.version=G,e.default=N,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=dfp.min.js.map
