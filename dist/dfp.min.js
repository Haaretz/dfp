!function(a){"use strict";function b(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},c=b.separator,d=void 0===c?";":c,e=b.operator,f=void 0===e?"=":e,g={};return a.split(d).forEach(function(a){if("string"==typeof a){var b=a.split(f);if(2===b.length)try{g[b[0]]=decodeURIComponent(b[1])}catch(a){}}}),g}function c(){var a=b(document.cookie,{separator:/;\s?/});return"string"==typeof a.tmsso&&(a.tmsso=b(a.tmsso,{separator:":"})),"string"==typeof a.engsso&&(a.engsso=b(a.engsso,{separator:":"})),a}function d(a,b){if(!a)throw new SyntaxError("addHours called without a required 'date' parameter!");if(!b)throw new SyntaxError("addHours called without a required 'hours' parameter!");if(isNaN(parseInt(b,10)))throw new TypeError("addHours called with an invalid integer 'hours' parameter!");var c=new Date(a);return c.setHours(c.getHours()+parseInt(b,10)),c}function e(a,b){if(!a)throw new SyntaxError("addDays called without a required 'date' parameter!");if(!b)throw new SyntaxError("addDays called without a required 'days' parameter!");if(isNaN(parseInt(b,10)))throw new TypeError("addDays called with an invalid integer 'days' parameter!");var c=new Date(a);return c.setDate(c.getDate()+parseInt(b,10)),c}function f(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,c=arguments[2],d=void 0;return function(){var e=this,f=arguments,g=function(){d=null,c||a.apply(e,f)},h=c&&!d;clearTimeout(d),d=setTimeout(g,b),h&&a.apply(e,f)}}function g(){var a=void 0,b=window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth;switch(!0){case b<p.xs:a=p.xxs;break;case b<p.s:a=p.xs;break;case b<p.m:a=p.s;break;case b<p.l:a=p.m;break;case b<p.xl:a=p.l;break;case b<p.xxl:a=p.xl;break;default:a=p.xxl}return a}function h(a){var b=void 0,c=a||window.innerWidth;switch(!0){case c<p.xs:b="xxs";break;case c<p.s:b="xs";break;case c<p.m:b="s";break;case c<p.l:b="m";break;case c<p.xl:b="l";break;case c<p.xxl:b="xl";break;default:b="xxl"}return b}function i(a,b){if(!a||!b)return!1;if(!Array.isArray(a)||!Array.isArray(b))return!1;if(a===b)return!0;if(a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(Array.isArray(a[c])&&Array.isArray(b[c])){if(!i(a[c],b[c]))return!1}else if(a[c]!==b[c])return!1;return!0}var j=function(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),l=function(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)},m=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",n=void 0;try{n=window.JSON.parse(document.getElementById("dfpConfig").textContent)}catch(a){n=window.dfpConfig}var o=Object.assign({get referrer(){return document.referrer?document.referrer:""},get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname||3===this.environment},get department(){return this.isHomepage?"_homepage":"_section"},get domain(){var a=/([\d|\w]+)(\.co\.il|\.com)(.*)?/.exec(window.location.hostname);return a?a[0]:window.location.hostname},get path(){var a=this.articleId&&"0"!==this.articleId?window.location.pathname.split("/").slice(1,-1):window.location.pathname.split("/").slice(1);return a=a.filter(function(a){return"wwwMobileSite"!==a&&"whtzMobileSite"!==a}),a.map(function(a){return"."+a}).map(function(a,b,c){return c.slice(0,b+1).reduce(function(a,b){return a.concat(b)})})},get site(){var a=void 0;return window.location.hostname.indexOf("haaretz.co.il")>-1?a="haaretz":window.location.hostname.indexOf("themarker.com")>-1?a="themarker":window.location.hostname.indexOf("mouse.co.il")>-1&&(a="mouse"),a||"haaretz"},get environment(){var a={dev:1,test:2,prod:3};return"8080"===window.location.port?a.dev:window.location.hostname.indexOf("pre.haaretz.co.il")>-1||window.location.hostname.indexOf("tmtest.themarker.com")>-1||window.location.hostname.indexOf("pre.haaretz.com")>-1||window.location.hostname.indexOf("prodmouse.mouse.co.il")>-1?a.test:window.location.pathname.indexOf("/cmlink/Haaretz.HomePage")>-1||window.location.pathname.indexOf("/cmlink/TheMarker.HomePage")>-1||window.location.pathname.indexOf("/cmlink/Mouse.HomePage")>-1?a.prod:void 0},get articleId(){var a=/\d\.\d+/g.exec(window.location.pathname),b="0";return a&&(b=a.pop()),b},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(a){var b=RegExp("("+a+')(=)([^&"]+)').exec(window.location.search);return b&&b[3]?b[3]:void 0}},get adBlockRemoved(){var a=!1;try{localStorage.getItem("adblock_removed")&&(a=!0)}catch(a){}return a},get ssoGroupKey(){return window.localStorage.getItem("_SsoGroupKey")},get anonymousId(){var a="anonymousId",b=c(),d="";return b&&b[a]&&(d=b[a]),d},get isWriterAlerts(){return location.search.indexOf("writerAlerts=true")>-1},get wifiLocation(){var a=void 0,b="_htzwif",d=c();try{d&&d[b]&&("arcaffe"===d[b].toLowerCase()&&(a="ArCafe"),"university"===d[b].toLowerCase()&&(a="university")),d&&d.fairs&&(a="fairs")}catch(a){}return a},get isValidForsmartPhone(){var a=!0,b=window.location.href,d=b.match("haaretzsmartphoneapp"),e=c();try{d&&e&&e.HtzPusr&&(void 0===e.tmsso||"pilosmadar@gmail.com"!==e.tmsso.userName)&&(a=!1)}catch(a){}return a},get gStatCampaignNumber(){var a=void 0;try{a=localStorage.getItem("GstatCampaign")?JSON.parse(localStorage.getItem("GstatCampaign")):void 0}catch(b){a=void 0}return a?a.CampaignNumber:void 0},get pageType(){var a="";try{var b=document.querySelector("html").classList;switch(!0){case/mouse_location/.test(b):a="mouse_location";break;case/mouse_event/.test(b):a="mouse_event";break;case/contentType-story/.test(b):a="mouse_article";break;default:if("0"!==this.articleId)switch(this.domain){case"haaretz.co.il":a="htz_article";break;case"haaretz.com":a="hdc_article";break;case"themarker.com":a="tm_article";break;default:a=""}else a=""}}catch(b){a=""}return a},get proposalNumber(){var a=void 0;try{a=localStorage.getItem("proposaltype")?localStorage.getItem("proposaltype"):void 0}catch(b){a=void 0}return a},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",responsive:!0,adSizeMapping:[["width1","height1"]].concat(["widthN","heightN"]),priority:"normal",fluid:!1,responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[["width1","height1"]].concat(["widthN","heightN"]),s:[["width1","height1"]].concat(["widthN","heightN"]),m:[["width1","height1"]].concat(["widthN","heightN"]),l:[["width1","height1"]].concat(["widthN","heightN"]),xl:[["width1","height1"]].concat(["widthN","heightN"]),xxl:[["width1","height1"]].concat(["widthN","heightN"])},blacklistReferrers:"comma, delimited, blacklisted, referrer, list",whitelistReferrers:"comma, delimited, referrer, list"}},adManagerConfig:{network:"9401",adUnitBase:"haaretz.co.il_Web"},breakpointsConfig:{get breakpoints(){var a=void 0;switch(o.googleGlobalSettings.breakpointType){case"type1":a=this.breakpoints1;break;case"type2":a=this.breakpoints2;break;case"type3":a=this.breakpoints3;break;case"type4":a=this.breakpoints4;break;default:a=this.breakpoints1}return a},breakpoints1:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},breakpoints2:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920},breakpoints3:{xxs:100,xs:480,s:600,m:768,l:1024,xl:1280,xxl:1900},breakpoints4:{xxs:600,xs:768,s:1024,m:1280,l:1900,xl:1900,xxl:1900}},userConfig:{type:void 0,age:void 0,gender:void 0},conflictManagementConfig:{"blocking.ad.unit.name":[{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"},{onsize:"1280x200,970x250,3x3",avoid:"blocked.ad.unit.name"}]},impressionManagerConfig:{"ad.unit.name":{target:"all|section|homepage",frequency:"$1/$2(day|hour)",exposed:0,expires:(new Date).getTime()}},googleGlobalSettings:{enableSingleRequest:!0,enableAsyncRendering:!0,refreshIntervalTime:1e3,breakpointType:"type1"},sso:m},n),p=o.breakpointsConfig.breakpoints,q={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",target:"target",maxImpressions:"maxImpressions",hours:"hour",days:"day",adSlotId:"id"},r=function(){function a(b){j(this,a),this.now=(new Date).getTime(),this.config=Object.assign({},b),this.impressions=this.retrieveImpressionsData(),this.initImpressionMap()}return k(a,[{key:"retrieveImpressionsData",value:function(){var a=this,b=this.migrateImpressionsData();Object.keys(b).map(function(c,d){return b[c]=Object.assign({},b[c],a.config[c]),a});for(var c in b)({}).hasOwnProperty.call(b,c)&&(b[c][q.frequency]||delete b[c]);return b}},{key:"migrateImpressionsData",value:function(){var a=this,b=void 0,c=void 0;try{c=window.localStorage.getItem(q.impressions)}catch(a){c=void 0}try{b=JSON.parse(c)}catch(e){b={};var d=c.split(";").filter(function(a){return a});d.forEach(function(c){try{var d=c.split(" = "),e=d[0],f=d[1],g=e.split("."),h=g.pop();h&&"hp"===h&&(h="homepage");var i=g.join("."),j=i+"_"+h,k=parseInt(f.split("/")[0],10)||0,l=parseInt(f.split("/")[1],10)||a.now;b[j]={},b[j][q.adSlotId]=i,b[j][q.target]=h,b[j][q.exposed]=k,b[j][q.expires]=l}catch(a){}})}return b||{}}},{key:"saveImpressionsToLocalStorage",value:function(){this.debouncedSave&&"function"==typeof this.debouncedSave?this.debouncedSave():(this.debouncedSave=f(this.saveImpressionsToLocalStorageImpl,250,!1),this.debouncedSave())}},{key:"saveImpressionsToLocalStorageImpl",value:function(){try{localStorage.setItem(q.impressions,JSON.stringify(this.impressions))}catch(a){console.error("localStorage isn't available:",a)}}},{key:"initImpressionMap",value:function(){var a=this;Object.keys(this.config).map(function(b,c){var d=b,e=a.impressions[d],f=!1;return e?a.config[d][q.frequency]!==e[q.frequency]?(f=!0,a.impressions[d][q.frequency]=a.config[d][q.frequency]):a.now>e[q.expires]&&(f=!0):a.initSlotFromConfig(d),f&&a.updateExpiryDate(d),a})}},{key:"updateExpiryDate",value:function(a){var b=new Date;if(!this.impressions[a]||!this.impressions[a][q.frequency])throw new Error("Unable to update expiry date for slot: "+a+"\n      - this.impressions[slotName]:",this.impressions[a]);var c=this.impressions[a][q.frequency].match(q.frequencyRegex);b.setMilliseconds(0),b.setSeconds(0),b.setMinutes(0),c.indexOf(q.days)>-1&&b.setHours(0),this.impressions[a][q.expires]=(c.indexOf(q.days)>-1?e(b,c[2]):d(b,c[2])).getTime(),this.impressions[a][q.maxImpressions]=parseInt(c[1],10),this.impressions[a][q.exposed]=0}},{key:"initSlotFromConfig",value:function(a){var b=this.impressions[a]||{};b[q.frequency]=this.config[a][q.frequency],b[q.target]=this.config[a][q.target],b[q.exposed]=0,this.impressions[a]=b,this.updateExpiryDate(a)}},{key:"registerImpression",value:function(a){if(a){var b=this.impressions[a];if(b){var c=b[q.exposed];if(!1===isNaN(parseInt(c,10))){this.impressions[a][q.exposed]+=1;try{this.saveImpressionsToLocalStorage()}catch(a){}return!0}}}return!1}},{key:"reachedQuota",value:function(a){var b=this.impressions[""+a+o.department]?""+a+o.department:a+"_all",c=this.impressions[b],d=!1;if(c){var e=(new Date).getTime();if(this.impressions[b][q.expires]<e)this.updateExpiryDate(b);else{var f=this.impressions[b][q.maxImpressions];f&&(d=this.impressions[b][q.exposed]>=f)}}return d}},{key:"resetImpressions",value:function(){var a=this.impressions;for(var b in a)({}).hasOwnProperty.call(a,b)&&a[b][q.exposed]&&(a[b][q.exposed]=0);this.saveImpressionsToLocalStorage()}}]),a}(),s={payer:"payer",registered:"registered",anonymous:"anonymous",trial:"trial",guest:"reg_guest"},t={htz:243,tm:273,hdc:239,htz_tm:274},u=function(){function a(b){j(this,a),this.config=Object.assign({},b.userConfig);var d=c();this.ssoKey=o.sso,d[this.ssoKey]||(this.ssoKey="tmsso"===this.ssoKey?"engsso":"tmsso"),this.type=this.getUserType(d),this.htz_type=this.getUserTypeByProduct(d,t.htz,"tmsso"),this.tm_type=this.getUserTypeByProduct(d,t.tm,"tmsso"),this.hdc_type=this.getUserTypeByProduct(d,t.hdc,"engsso"),this.impressionManager=new r(b.impressionManagerConfig),this.age=this.getUserAge(d),this.gender=this.getUserGender(d),this.sso=this.getUserSSO(d,this.ssoKey),this.country=this.getUserCountry()}return k(a,[{key:"getUserType",value:function(a){return a&&a[this.ssoKey]?a.HtzPusr||a.TmPusr||a.HdcPusr?s.payer:s.registered:s.anonymous}},{key:"getUserTypeByProduct",value:function(a,b,c){var d=s.anonymous;if(a&&a[c]&&a.userProducts){var e=decodeURIComponent(a.userProducts);e=JSON.parse(e),d=b===t.hdc?this.getHdcUserType(e):this.getHtzTmUserType(e,b),d===s.registered&&"guest"===a[c].firstName&&"guest"===a[c].lastName&&(d=s.guest)}return d}},{key:"getHdcUserType",value:function(a){return this.userHasProduct(a,t.hdc,!1)?s.payer:this.userHasProduct(a,t.hdc,!0)?s.trial:s.registered}},{key:"getHtzTmUserType",value:function(a,b){return this.userHasProduct(a,b,!1)||this.userHasProduct(a,t.htz_tm,!1)?s.payer:this.userHasProduct(a,b,!0)||this.userHasProduct(a,t.htz_tm,!0)?s.trial:s.registered}},{key:"userHasProduct",value:function(a,b,c){return a.products.filter(function(a){return a.prodNum===b&&a.trial===c}).length>0}},{key:"getUserAge",value:function(a){var b=void 0;return a[this.ssoKey]&&a[this.ssoKey].usrae&&(b=parseInt(a[this.ssoKey].usrae,10),b=b>0?b:void 0),b}},{key:"getUserGender",value:function(a){var b=void 0;return a[this.ssoKey]&&a[this.ssoKey].urgdr&&(b=parseInt(a[this.ssoKey].urgdr,10),b=2===b||1===b?b:void 0),b}},{key:"getUserSSO",value:function(a,b){return a[b]}},{key:"getUserCountry",value:function(){var a=window.localStorage.getItem("country");return a||(fetch("https://ms-apps.haaretz.co.il/ms-ip2country/get",{headers:{Accept:"application/json","Content-Type":"application/jsonp"}}).then(function(a){return a.json()}).then(function(a){window.localStorage.setItem("country",a.code)},function(a){}),null)}}]),a}(),v=function(){function a(b){j(this,a),this.dependencyMap=this.initializeDependencyMap(b),this.deferredSlots=new Set}return k(a,[{key:"initializeDependencyMap",value:function(a){var b=this,c=new Map;return Object.keys(a).map(function(d,e){var f=a[d];return f&&(f=f.filter(function(a){return a.onsize&&a.avoid})),c.set(d,{id:d,rules:f,resolvedWith:null}),b}),c}},{key:"updateResolvedSlot",value:function(a,b){if(!a)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!b)throw new Error("updateResolvedSlot must be called with a resolved size!");this.dependencyMap.has(a)&&(this.dependencyMap.get(a).resolvedWith=b)}},{key:"isBlocked",value:function(a){var b=this;if(!a)throw new Error("isBlocked must be called with an adSlotId!");var c=!1,d=!0,e=!1,f=void 0;try{for(var g,h=this.dependencyMap.keys()[Symbol.iterator]();!(d=(g=h.next()).done);d=!0){var i=g.value,j=this.dependencyMap.get(i),k=!0,l=!1,m=void 0;try{for(var n,o=j.rules[Symbol.iterator]();!(k=(n=o.next()).done);k=!0){var p=n.value;p.avoid===a&&function(){var d=j.resolvedWith;d&&p.onsize.split(",").find(function(a){var c=a.split("x").map(function(a){return parseInt(a,10)});return b.arraysEqual(c,d)})&&(b.deferredSlots.add(a),c=!0)}()}}catch(a){l=!0,m=a}finally{try{!k&&o.return&&o.return()}finally{if(l)throw m}}}}catch(a){e=!0,f=a}finally{try{!d&&h.return&&h.return()}finally{if(e)throw f}}return c}},{key:"isBlocking",value:function(a){if(!a)throw new Error("isBlocking must be called with an adSlotId!");var b=!1,c=!0,d=!1,e=void 0;try{for(var f,g=this.dependencyMap.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){f.value===a&&(b=!0)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return b}},{key:"getBlockedSlotsIds",value:function(a){var b=void 0;return this.dependencyMap.has(a)&&(b=Array.from(this.dependencyMap.get(a).rules.map(function(a){return a.avoid}))),b||[]}},{key:"arraysEqual",value:function(a,b){if(a===b)return!0;if(null===a||null===b)return!1;if(a.length!==b.length)return!1;for(var c=0;c<a.length;++c)if(a[c]!==b[c])return!1;return!0}}]),a}();v.EMPTY_SIZE=[];var w=o.site.indexOf("mouse")>-1?"u-is-hidden":"h-hidden",x=function(){function a(b){if(j(this,a),this.config=Object.assign({},b),this.id=this.config.id,!this.config.id)throw new Error("an adSlot requires an id!");this.target=this.config.target,this.type=this.config.type,this.responsive=this.config.responsive,this.fluid=this.config.fluid,this.user=this.config.user,this.adManager=this.config.adManager,this.htmlElement=this.config.htmlElement,this.priority=this.config.priority,this.deferredSlot=this.config.deferredSlot,this.department=this.config.department,this.network=this.config.network,this.adUnitBase=this.config.adUnitBase,this.adSizeMapping=this.config.adSizeMapping,this.responsiveAdSizeMapping=this.config.responsiveAdSizeMapping,this.blacklistReferrers=this.config.blacklistReferrers?this.config.blacklistReferrers.split(","):[],this.whitelistReferrers=this.config.whitelistReferrers?this.config.whitelistReferrers.split(","):[],this.lastResolvedSize=void 0,this.lastResolvedWithBreakpoint=void 0,this.slot=void 0;try{this.deferredSlot||(this.slot=this.defineSlot())}catch(a){console.error(a)}}return k(a,[{key:"isOutOfPage",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(!0===this.isMobile())return!1;switch(this.type){case B.maavaron:return!1;case B.popunder:return!0;case B.talkback:case B.regular:default:return!1}}},{key:"isMaavaron",value:function(){if("string"!=typeof this.type)throw new Error("An adSlot cannot by typeless!",this);if(!0===this.isMobile())return!1;switch(this.type){case B.maavaron:default:return!1}}},{key:"isMobile",value:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")}},{key:"isWhitelisted",value:function(){var a=!1;if(0!==this.whitelistReferrers.length){var b=!0,c=!1,d=void 0;try{for(var e,f=this.whitelistReferrers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(o.referrer.indexOf(g)>-1){a=!0;break}}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}else a=!0;return a}},{key:"isBlacklisted",value:function(){var a=!1;if(0!==this.blacklistReferrers.length){var b=!0,c=!1,d=void 0;try{for(var e,f=this.blacklistReferrers[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var g=e.value;if(o.referrer.indexOf(g)>-1){a=!0;break}}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}return a}},{key:"show",value:function(){var a=this;!0==!this.shown&&(this.shown=!0,googletag.cmd.push(function(){a.deferredSlot&&(a.slot=a.defineSlot()),document.getElementById(a.id).classList.remove(w),googletag.display(a.id)}))}},{key:"hide",value:function(){var a=this;googletag.cmd.push(function(){document.getElementById(a.id).classList.add(w)})}},{key:"defineSlot",value:function(){if(this.isMaavaron()){var a=this.defineMaavaron();return this.adManager.shouldSendRequestToDfp(this)&&(this.shown||(this.shown=!0,a.display())),a}var b=window.googletag,c=b.pubads(),d=[],e=this.isOutOfPage()?b.defineOutOfPageSlot:b.defineSlot;d.push(this.getPath()),!1===this.isOutOfPage()&&(this.fluid?d.push("fluid"):d.push(this.adSizeMapping)),d.push(this.id);var f=e.apply(e,d);if(f){if(this.responsive){var g=b.sizeMapping(),h=o.breakpointsConfig.breakpoints,j=Object.keys(this.responsiveAdSizeMapping),k=!0,l=!1,m=void 0;try{for(var n,p=j[Symbol.iterator]();!(k=(n=p.next()).done);k=!0){var q=n.value;g.addSize([h[q],100],i(this.responsiveAdSizeMapping[q],[[0,0]])?[]:this.responsiveAdSizeMapping[q])}}catch(a){l=!0,m=a}finally{try{!k&&p.return&&p.return()}finally{if(l)throw m}}g=g.build(),f=f.defineSizeMapping(g)}f=f.addService(c),!1===this.isOutOfPage()&&f.setCollapseEmptyDiv(!0)}return f}},{key:"getPath",value:function(){var a=this,b=o.path||[];return b=b.filter(function(a){return"."!==a}),b=b.map(function(b){return""+a.id+a.department+b}).join("/"),b=b&&"_homepage"!==this.config.department?"/"+b:"",("/"+this.config.network+"/"+this.config.adUnitBase+"/"+this.id+"/"+this.id+this.department+b).toLowerCase()}},{key:"slotRendered",value:function(a){a.slot.getAdUnitPath().split("/")[3],a.isEmpty,a.size}},{key:"refresh",value:function(){var a=this;googletag.cmd.push(function(){googletag.pubads().refresh([a.slot])})}},{key:"defineMaavaron",value:function(){if(!document.referrer.match("loc.haaretz")){var a=this.getPath(),b=[[2,1]];return googletag.pubads().definePassback(a,b).setTargeting("UserType",[this.user.type]).setTargeting("age",[this.user.age]).setTargeting("urgdr",[this.user.gender]).setTargeting("articleId",[o.articleId]).setTargeting("stg",[o.environment])}return null}}]),a}(),y={high:"high",normal:"normal",low:"low"},z={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},A={anonymous:"anonymous",registered:"registered",payer:"payer"},B={maavaron:".maavaron",popunder:".popunder",talkback:".talkback",regular:""},C=function(){function a(b){var c=this;j(this,a),this.config=Object.assign({},b),this.user=new u(b),this.conflictResolver=new v(b.conflictManagementConfig);try{googletag.cmd.push(function(){c.initGoogleTargetingParams(),c.initGoogleGlobalSettings(),c.initSlotRenderedCallback()});var d=h(g());this.config.adManagerConfig.adUnitBase.indexOf("mouse.co.il")>-1&&d.indexOf("xs")>-1&&(this.config.adManagerConfig.adUnitBase="mouse.co.il.mobile_web"),googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,y.high)});var e=function(){try{googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,y.high),googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,y.normal)})})}catch(a){console.log(a)}},f=function(){googletag.cmd.push(function(){c.adSlots=c.initAdSlots(b.adSlotConfig,y.low);var a=!0,d=!1,e=void 0;try{for(var f,g=c.conflictResolver.dependencyMap.keys()[Symbol.iterator]();!(a=(f=g.next()).done);a=!0){var h=f.value;c.adSlots.has(h)||c.conflictResolver.dependencyMap.delete(h)}}catch(a){d=!0,e=a}finally{try{!a&&g.return&&g.return()}finally{if(d)throw e}}c.showAllDeferredSlots()})};switch(document.readyState){case"loading":document.addEventListener("DOMContentLoaded",e),window.addEventListener("load",f);break;case"interactive":e(),window.addEventListener("load",f);break;default:e(),f()}}catch(a){console.error(a)}}return k(a,[{key:"showAllSlots",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.adSlots.keys()[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=this.adSlots.get(f);g.type!==B.talkback&&this.shouldSendRequestToDfp(g)&&g.show()}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}},{key:"getAdSlotsByPriority",value:function(a){function b(b){return b.priority===a}return Array.from(this.adSlots.values()).filter(b)}},{key:"showAllDeferredSlots",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.conflictResolver.deferredSlots[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value;if(this.adSlots.has(f)&&!this.conflictResolver.isBlocked(f)){var g=this.adSlots.get(f);this.shouldSendRequestToDfp(g)&&g.show()}}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}},{key:"refreshAllSlots",value:function(){var a=g(),b=!0,c=!1,d=void 0;try{for(var e,f=this.adSlots.keys()[Symbol.iterator]();!(b=(e=f.next()).done);b=!0){var h=e.value,i=this.adSlots.get(h);i.responsive&&i.type!==B.maavaron&&(i.lastResolvedWithBreakpoint!==a&&this.shouldSendRequestToDfp(i)?i.refresh():i.hide())}}catch(a){c=!0,d=a}finally{try{!b&&f.return&&f.return()}finally{if(c)throw d}}}},{key:"refreshAllSlotsInPage",value:function(){var a=!0,b=!1,c=void 0;try{for(var d,e=this.adSlots.keys()[Symbol.iterator]();!(a=(d=e.next()).done);a=!0){var f=d.value,g=this.adSlots.get(f);this.shouldSendRequestToDfp(g)?g.refresh():g.hide()}}catch(a){b=!0,c=a}finally{try{!a&&e.return&&e.return()}finally{if(b)throw c}}}},{key:"refreshSlot",value:function(a){var b=this.adSlots.get(a);this.shouldSendRequestToDfp(b)?b.refresh():b.hide()}},{key:"initAdSlots",value:function(a,b){var c=this,d=new Map(this.adSlots),e=Array.from(document.getElementsByClassName("js-dfp-ad"));e=e.filter(function(a){return a.id});var f=new Set;return e=Array.prototype.filter.call(e,function(a){return!1===f.has(a.id)&&(f.add(a.id),!0)}),e.forEach(function(e){var f=a[e.id]?a[e.id].priority||y.normal:void 0;if(a[e.id]&&!1===d.has(e.id)&&f===b)try{var g=Object.assign({},a[e.id],{id:e.id,target:e.attributes["data-audtarget"]?e.attributes["data-audtarget"].value:z.all,type:c.getAdType(e.id),responsive:a[e.id].responsive,fluid:a[e.id].fluid||!1,user:c.user,adManager:c,htmlElement:e,department:c.config.department,network:c.config.adManagerConfig.network,adUnitBase:c.config.adManagerConfig.adUnitBase,deferredSlot:c.conflictResolver.isBlocked(e.id),priority:f}),h=new x(g);d.set(e.id,h),h.type!==B.talkback&&h.priority===y.high&&c.shouldSendRequestToDfp(h)&&h.show()}catch(a){console.error(a)}}),d}},{key:"isPriority",value:function(a){return"string"==typeof a&&(a.indexOf("plazma")>0||a.indexOf("maavaron")>0||a.indexOf("popunder")>0)}},{key:"getAdType",value:function(a){if(!a)throw new Error("Missing argument: a call to getAdType must have an adSlotId");return a.indexOf(B.maavaron)>-1?B.maavaron:a.indexOf(B.popunder)>-1?B.popunder:a.indexOf(B.talkback)>-1?B.talkback:B.regular}},{key:"shouldSendRequestToDfp",value:function(a){return!1===this.conflictResolver.isBlocked(a.id)&&a.isWhitelisted()&&!1===a.isBlacklisted()&&this.shouldDisplayAdAfterAdBlockRemoval(a)&&this.shouldDisplayAdMaavaronAfterPayWallBanner(a)&&this.doesBreakpointContainAd(a)&&this.haveValidCookieForSmartphoneapp()&&this.doesUserTypeMatchBannerTargeting(a)&&!1===this.user.impressionManager.reachedQuota(a.id)&&!1===this.shouldAppPromotionElementPop()}},{key:"printShouldSendRequestToDfp",value:function(a){var b="";if(this.adSlots.has(a)){var c=this.adSlots.get(a);b+=!1===this.conflictResolver.isBlocked(c.id)?"":"isBlocked,",b+=c.isWhitelisted()?"":"isWhitelisted,",b+=!1===c.isBlacklisted()?"":"isBlacklisted,",b+=this.shouldDisplayAdAfterAdBlockRemoval(c)?"":"AdBlockRemoval,",b+=this.shouldDisplayAdMaavaronAfterPayWallBanner(c)?"":"PayWallBanner,",b+=this.doesBreakpointContainAd(c)?"":"Breakpoint,",b+=this.haveValidCookieForSmartphoneapp()?"":"Smartphoneapp,",b+=this.doesUserTypeMatchBannerTargeting(c)?"":"Targeting,",b+=!1===this.user.impressionManager.reachedQuota(c.id)?"":"reachedQuota,",b="<div>"+a+"<br>"+b+"</div>"}else b="id not exist: "+a;return document.write(b),b}},{key:"testShouldSendRequestToDfp",value:function(a){var b=c();b=JSON.stringify(b),b=b.replace(/,/g,"<br>");var d="<div>"+b+"</div>";return document.write(d),d}},{key:"shouldDisplayAdAfterAdBlockRemoval",value:function(a){return!(!0===this.config.adBlockRemoved&&(a.type===B.maavaron||a.type===B.popunder))}},{key:"shouldDisplayAdMaavaronAfterPayWallBanner",value:function(a){var b=!0;if("haaretz"===this.config.site&&a.type===B.maavaron)try{var c=JSON.parse(window.localStorage.getItem("_cobj"));b=!c||c.mc&&c.mc>=12||c.nextslotLocation&&!c.nextslotLocation.includes("pop")}catch(a){console.error("ERROR ON shouldDisplayAdMaavaronAfterPayWallBanner")}return b}},{key:"shouldAppPromotionElementPop",value:function(){return void 0!==window.appPromotionElement&&"function"==typeof window.appPromotionElement.getShouldPop&&window.appPromotionElement.getShouldPop()}},{key:"haveValidCookieForSmartphoneapp",value:function(){return this.config.isValidForsmartPhone}},{key:"doesUserTypeMatchBannerTargeting",value:function(a){var b=c();if("pilosmadar@gmail.com"===b.login)return!0;if(void 0!==b.tmsso&&"pilosmadar@gmail.com"===b.tmsso.userName)return!0;var d=this.user.type;switch("string"==typeof a?a:a.target){case z.all:return!0;case z.nonPaying:return d===A.anonymous||d===A.registered;case z.anonymous:return d===A.anonymous;case z.registered:return d===A.registered;case z.paying:case z.digitalOnly:case z.digitalAndPrint:return d===A.payer;default:return!1}}},{key:"switchedToBreakpoint",value:function(a){if(!a)throw new Error("Missing argument: a call to switchedToBreakpoint must have an breakpoint");var b=0,c=!0,d=!1,e=void 0;try{for(var f,g=this.adSlots.keys()[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value,i=this.adSlots.get(h);!0===i.responsive&&i.lastResolvedWithBreakpoint&&i.lastResolvedWithBreakpoint!==a&&(i.refresh(),b++)}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}return b}},{key:"doesBreakpointContainAd",value:function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:g();if(!a)throw new Error("Missing argument: a call to doesBreakpointContainAd must have an adSlot");var c=!0;if(!0===a.responsive){var d=a.responsiveAdSizeMapping[h(b)];if(!1===Array.isArray(d))throw new Error("Invalid argument: breakpoint:"+b+" doesn't exist!",this);c=d.length>0&&!i(d,[[0,0]])}return c}},{key:"initSlotRenderedCallback",value:function(){var a=this;if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initSlotRenderedCallback' was called!");window.googletag.pubads().addEventListener("slotRenderEnded",function(b){var c=b.slot.getAdUnitPath().split("/")[3],d=b.isEmpty,e=b.size;if(a.adSlots.has(c)){var f=a.adSlots.get(c);f.lastResolvedSize=e,f.lastResolvedWithBreakpoint=g(),d?(f.lastResolvedSize=v.EMPTY_SIZE,f.hide(),a.releaseSlotDependencies(f)):a.releaseSlotDependencies(f,f.lastResolvedSize),a.user.impressionManager.registerImpression(""+f.id+a.config.department),a.user.impressionManager.registerImpression(f.id+"_all")}})}},{key:"releaseSlotDependencies",value:function(a){try{var b=a.id;if(this.conflictResolver.updateResolvedSlot(b,a.lastResolvedSize),this.conflictResolver.isBlocking(b)){var c=!0,d=!1,e=void 0;try{for(var f,g=this.conflictResolver.getBlockedSlotsIds(b)[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var h=f.value;this.conflictResolver.isBlocked(h)&&this.adSlots.has(h)&&this.adSlots.get(h).hide()}}catch(a){d=!0,e=a}finally{try{!c&&g.return&&g.return()}finally{if(d)throw e}}var i=!0,j=!1,k=void 0;try{for(var l,m=this.conflictResolver.deferredSlots.keys()[Symbol.iterator]();!(i=(l=m.next()).done);i=!0){var n=l.value,o=this.adSlots.get(n);o&&this.shouldSendRequestToDfp(o)&&(this.conflictResolver.deferredSlots.delete(n),o.deferredSlot&&(o.defineSlot(),o.deferredSlot=!1),o.show())}}catch(a){j=!0,k=a}finally{try{!i&&m.return&&m.return()}finally{if(j)throw k}}}}catch(b){console.error("Cannot updateSlotDependencies for adSlot: "+a.id)}}},{key:"setSsoGroupKey",value:function(){fetch("/ssoGroupKey?value="+this.user.sso.userId,{method:"GET",cache:"no-cache"}).then(function(a){a&&a.json().then(function(a){a&&a.result&&"item not found"!==a.result&&"value is empty"!==a.result&&localStorage.setItem("_SsoGroupKey",a.result)})})}},{key:"initGoogleTargetingParams",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api was not ready when 'initGoogleTargetingParams' was called!");var a=null;try{a=localStorage.getItem("_SsoGroupKey"),!a&&this.user.sso.userId&&this.setSsoGroupKey()}catch(b){a=null}var b=googletag.pubads();if(this.config.environment&&b.setTargeting("stg",[this.config.environment]),this.user.htz_type&&b.setTargeting("htz_user_type",[this.user.htz_type]),this.user.tm_type&&b.setTargeting("tm_user_type",[this.user.tm_type]),this.user.hdc_type&&b.setTargeting("hdc_user_type",[this.user.hdc_type]),this.config.section&&b.setTargeting("section",[this.config.section]),this.config.sub_section&&b.setTargeting("sub_section",[this.config.sub_section]),this.config.articleId&&(b.setTargeting("articleId",[this.config.articleId]),b.setTargeting("react",["false"])),this.config.gStatCampaignNumber&&-1!==this.config.gStatCampaignNumber&&b.setTargeting("gstat_campaign_id",[this.config.gStatCampaignNumber]),this.config.proposalNumber&&b.setTargeting("proposaltype",[this.config.proposalNumber]),this.config.pageType&&b.setTargeting("pageType",[this.config.pageType]),this.config.isWriterAlerts&&b.setTargeting("WriterAlerts",["true"]),this.config.adBlockRemoved&&b.setTargeting("adblock_removed",[this.config.adBlockRemoved]),this.config.wifiLocation&&b.setTargeting("wifi",[this.config.wifiLocation]),this.config.tags&&Array.isArray(this.config.tags)&&b.setTargeting("tags",[].concat(l(this.config.tags))),this.user.sso&&this.user.sso.userId&&a&&b.setTargeting(a,this.user.sso.userId),this.config.anonymousId){b.setTargeting("anonymousIdKey",this.config.anonymousId)}this.user.country&&b.setTargeting("country",this.user.country);var c=this.getCityNames();c&&b.setTargeting("cityName",[].concat(l(c))),b.setCentering(!0)}},{key:"initGoogleGlobalSettings",value:function(){if(!window.googletag||!window.googletag.apiReady)throw new Error("googletag api wasn't ready when 'initGoogleGlobalSettings' was called!");var a=this.config.googleGlobalSettings;if(window.location.search){var b=window.location.search;b.indexOf("sraon")>0?(console.log("Single Request Mode: active"),a.enableSingleRequest=!0):b.indexOf("sraoff")>0&&(console.log("Single Request Mode: disabled"),a.enableSingleRequest=!1),b.indexOf("asyncrenderingon")>0?(console.log("Async rendering mode: active"),a.enableAsyncRendering=!0):b.indexOf("asyncrenderingonoff")>0&&(console.log("Sync rendering mode: active"),a.enableAsyncRendering=!1)}!0===a.enableSingleRequest&&googletag.pubads().enableSingleRequest(),googletag.enableServices()}},{key:"getCityNames",value:function(){var a=[];return document.querySelectorAll("[data-location-city-name]").forEach(function(b){a.includes(b.dataset.locationCityName)||a.push(b.dataset.locationCityName)}),a.length>0?a:null}}]),a}(),D=o||{},E=250,F=function(){function a(b){j(this,a),this.config=Object.assign({},D,b),this.wasInitialized=!1,this.initStarted=!1,this.breakpoint=g(),this.initWindowResizeListener()}return k(a,[{key:"resumeInit",value:function(){try{this.adManager=this.adManager||new C(this.config)}catch(a){console.error(a)}}},{key:"initGoogleTag",value:function(){var a=this,b=this;return new Promise(function(c,d){!0===b.initStarted?googletag.cmd.push(function(){b.wasInitialized=!0,c(b)}):(b.initStarted=!0,window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var e=window.document.createElement("script");e.async=!0,e.type="text/javascript",e.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var f=window.document.getElementsByTagName("script")[0];e.addEventListener("load",function(){b.resumeInit(),googletag.cmd.push(function(){b.wasInitialized=!0,c(a)})}),e.addEventListener("error",function(a){b.wasInitialized=!1,d(a)}),f.parentNode.insertBefore(e,f)}())})}},{key:"isGoogleTagReady",value:function(){return(!0===this.wasInitialized||window.googletag&&window.googletag.apiReady)&&(this.wasInitialized=!0),this.wasInitialized}},{key:"initWindowResizeListener",value:function(){function a(){var a=g();if(b.breakpoint!==a){if(b.breakpoint=a,!b.adManager)throw new Error("initWindowResizeListener error - adManager instance is not available");b.adManager.refreshAllSlots()}}var b=this,c=f(a,E);window.onresize=c}}]),a}();F.version="2.6.6";var G=o,H=F.version;a.config=G,a.version=H,a.default=F}(this.DFP=this.DFP||{});
//# sourceMappingURL=dfp.min.js.map