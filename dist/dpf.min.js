!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.DFP=t()}(this,function(){"use strict";function e(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],n=t.separator,i=void 0===n?";":n,r=t.operator,a=void 0===r?"=":r,o={},s=e.split(i);for(var u in s)if(s.hasOwnProperty(u)){var l=s[u].split(a);2==l.length&&(o[l[0]]=decodeURIComponent(l[1]))}return o}function t(t){var n=t||window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",i=e(document.cookie,{separator:/;\s?/});return"string"==typeof i[n]&&(i[n]=e(i[n],{separator:":"})),i}var n={};n.classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},n.createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}();var i=window.location.hostname.indexOf("haaretz.com")>-1?"engsso":"tmsso",r={impressions:"impressions",frequency:"frequency",frequencyRegex:/(\d+)\/(\d+)(day|hour)/,expires:"expires",exposed:"exposed",maxImpressions:"maxImpressions",hours:"hour",days:"day"},a=function(){function e(t){n.classCallCheck(this,e),this.now=(new Date).getTime(),this.config=t,this.impressions=JSON.parse(localStorage.getItem(r.impressions)||"{}"),this.initImpressionMap()}return n.createClass(e,[{key:"saveImpressionsToLocalStorage",value:function(){localStorage.setItem(r.impressions,JSON.stringify(this.impressions))}},{key:"initImpressionMap",value:function(){var e=this;Object.keys(this.config).map(function(t,n){var i=t,a=void 0,o=!1;(a=e.impressions[i])?(e.config[i]=!a[r.frequency])?(o=!0,e.impressions[r.frequency]=e.config[i]):e.now>a[r.expires]&&(o=!0):e.initSlotFromConfig(i),o&&e.updateExpiryDate(i)})}},{key:"updateExpiryDate",value:function(e){function t(e,t){var n=new Date(e);return n.setHours(n.getHours()+t),n}function n(e,t){var n=new Date(e);return n.setDate(n.getDate()+t),n}var i=new Date,a=this.impressions[e][r.frequency].match(r.frequencyRegex);i.setMilliseconds(0),i.setSeconds(0),i.setMinutes(0),a.indexOf(r.days)>-1&&i.setHours(0),this.impressions[e][r.expires]=(a.indexOf(r.days)>-1?n(i,a[2]):t(i,a[2])).getTime(),this.impressions[e][r.maxImpressions]=a[1]}},{key:"initSlotFromConfig",value:function(e){var t=this.impressions[e]||{};t[r.frequency]=this.config[e],t[r.exposed]=0,this.impressions[e]=t,this.updateExpiryDate(e)}},{key:"registerImpression",value:function(e){return this.impressions[e][r.exposed]+=1,!0}},{key:"reachedQuota",value:function(e){var t=(new Date).getTime(),n=this.impressions[e][r.maxImpressions];return this.impressions[e][r.expires]<t&&this.impressions[e][r.exposed]<=n}}]),e}(),o={payer:"payer",registered:"registered",anonymous:"anonymous"},s=function(){function e(){n.classCallCheck(this,e),this.type=this.getUserType(),this.impressionManager=this.initImpressionMap()}return n.createClass(e,[{key:"getUserType",value:function(){var e=t();if(e&&e[i]){var n=i.indexOf("haaretz.com")>-1?"HdcPusr":"HtzPusr";return e[n]?o.payer:o.registered}return o.anonymous}},{key:"initImpressionMap",value:function(){var e={};return window.adUnitsFrequencyMap&&Object.keys(adUnitsFrequencyMap).map(function(t,n){e[t]=adUnitsFrequencyMap[t]}),new a(e)}}]),e}(),u=function(){function e(){n.classCallCheck(this,e),this.blockingQueue=this.initQueueFromJson()}return n.createClass(e,[{key:"initQueueFromJson",value:function(){var e=[],t=window.conflicManagementJson||window.conflictManagementJson||{};return Object.keys(t).map(function(n,i){var r=t[n];r&&(r=r.filter(function(e){return e.onsize&&e.avoid})),e.push({id:n,rules:r,resolvedWith:null})}),e}},{key:"updateResolvedSlot",value:function(e,t){if(!e)throw new Error("updateResolvedSlot must be called with an adSlotId!");if(!t)throw new Error("updateResolvedSlot must be called with a resolved size!");var n=!0,i=!1,r=void 0;try{for(var a,o=this.blockingQueue[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;(s.id=e)&&(s.resolvedWith=t)}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}}},{key:"isBlocked",value:function e(t){if(!t)throw new Error("isBlocked must be called with an adSlotId!");var e=!1,n=!0,i=!1,r=void 0;try{for(var a,o=this.blockingQueue[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=!0,l=!1,c=void 0;try{for(var d,g=s.rules[Symbol.iterator]();!(u=(d=g.next()).done);u=!0){var p=d.value;p.avoid===t&&!function(){var t=s.resolvedWith;t||(e=!0),p.onsize.split(",").find(function(e){return e===t})&&(e=!0)}()}}catch(e){l=!0,c=e}finally{try{!u&&g.return&&g.return()}finally{if(l)throw c}}}}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return e}}]),e}(),l={all:"all",nonPaying:"nonPaying",anonymous:"anonymous",registered:"registered",paying:"paying",digitalOnly:"digitalOnly",digitalAndPrint:"digitalAndPrint"},c={anonymous:"anonymous",registered:"registered",payer:"payer"},d={maavaron:".web.maavaron",popunder:".web.popunder",talkback:".web.fullbanner.talkback",regular:""},g={target:l.all,type:d.regular,responsive:!1,get department(){return window.isHomepage?"homepage":"section"}},p=function(){function e(t){n.classCallCheck(this,e),this.config=Object.assign({},g,t),this.referrerBlacklist=this.initReferrerBlacklist(),this.user=new s,this.conflictResolver=new u,this.adSlots=this.initAdSlots(),this.adSlotDefinitions=this.initAdSlotDefinitions()}return n.createClass(e,[{key:"initAdSlots",value:function(){var e=[],t=document.getElementsByClassName("js-dfp-ad");return Array.prototype.forEach.call(t,function(t,n){e.push({id:t.id,target:t.attributes["data-audtarget"].value,responsive:t.classList.contains("js-dfp-resp-refresh")})}),[]}},{key:"initReferrerBlacklist",value:function(){var e=[];return e.push("paid.outbrain.com"),e}},{key:"shouldSendRequestToDfp",value:function(e){return this.coflictResolver.isBlocked(e.id)===!1&&this.isMaavaron(e)===!1&&this.doesBreakpointContainAd()&&this.doesUserTypeMatchBannerTargeting(e)&&this.user.impressionManager.reachedQuota(e.id)===!1}},{key:"doesUserTypeMatchBannerTargeting",value:function(e){var t=this.user.type,n=e.target;switch(n){case l.all:return!0;case l.nonPaying:return t===c.anonymous||t===c.registered;case l.anonymous:return t===c.anonymous;case l.registered:return t===c.registered;case l.paying:return t===c.payer;case l.digitalOnly:return t===c.payer;case l.digitalAndPrint:return t===c.payer;default:return!1}}},{key:"isMaavaron",value:function(e){return e.id.indexOf(d.maavaron)>-1}},{key:"switchedToBreakpoint",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=this.adSlots[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;o.responsive===!0}}catch(e){n=!0,i=e}finally{try{!t&&a.return&&a.return()}finally{if(n)throw i}}}},{key:"doesBreakpointContainAd",value:function(){return!0}},{key:"initAdSlotDefinitions",value:function(){}},{key:"addSlotRenderedCallback",value:function(e){googletag.pubads().addEventListener("slotRenderEnded",e)}},{key:"initGoogleTargetingParams",value:function(){"undefined"!=typeof dfpUserType&&googletag.pubads().setTargeting("UserType",[dfpUserType]),"undefined"!=typeof dfpUrAe&&googletag.pubads().setTargeting("age",[dfpUrAe]),"undefined"!=typeof dfpStg&&googletag.pubads().setTargeting("stg",[dfpStg]),"undefined"!=typeof dfpUrGdr&&googletag.pubads().setTargeting("urgdr",[dfpUrGdr]),"undefined"!=typeof dfpArticleId&&googletag.pubads().setTargeting("articleId",[dfpArticleId]),"undefined"!=typeof CampaignNumber&&-1!=CampaignNumber&&googletag.pubads().setTargeting("gstat_campaign_id",[CampaignNumber]),"undefined"!=typeof utm_content&&null!=utm_content&&googletag.pubads().setTargeting("utm_content",[utm_content]),"undefined"!=typeof utm_source&&null!=utm_source&&googletag.pubads().setTargeting("utm_source",[utm_source]),"undefined"!=typeof utm_medium&&null!=utm_medium&&googletag.pubads().setTargeting("utm_medium",[utm_medium]),"undefined"!=typeof utm_campaign&&null!=utm_campaign&&googletag.pubads().setTargeting("utm_campaign",[utm_campaign])}}]),e}(),f={get isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(window.navigator.userAgent||"")},get isHomepage(){return"/"===window.location.pathname},get domain(){return window.location.hostname.replace(/([\w|\d]+.)/,"")},get articleId(){var e=/\d\.\d+/g.exec(window.location.pathname),t=null;return e&&(t=e.pop()),t},utm_:{get content(){return this.getUrlParam("utm_content")},get source(){return this.getUrlParam("utm_source")},get medium(){return this.getUrlParam("utm_medium")},get campaign(){return this.getUrlParam("utm_campaign")},getUrlParam:function(e){var t=RegExp("("+e+')(=)([^&"]+)').exec(window.location.search);return t&&t[3]?t[3]:null}},get gStatCampaignNumber(){var e=JSON.parse(localStorage.GstatCampaign);return e?e.CampaignNumber:null},adSlotConfig:{"haaretz.co.il.example.slot":{id:"slotId",path:"/network/base/slotId/slotId_subsection",responsiveAdSizeMapping:{xxs:[["width1","height1"]].concat(["widthN","heightN"]),xs:[],s:[],m:[],l:[],xl:[],xxl:[]}}},adManagerConfig:{},breakpointsConfig:{breakpoints:{xxs:600,xs:761,s:993,m:1009,l:1291,xl:1600,xxl:1900},altBreakpoints:{xxs:600,xs:1e3,s:1150,m:1281,l:1600,xl:1920,xxl:1920}},userConfig:{age:"none",gender:"none"},sso:i},m=f||{},y=function(){function e(t){n.classCallCheck(this,e),this.config=Object.assign({},m,t),this.wasInitialized=!1,this.adManager=new p(t)}return n.createClass(e,[{key:"initGoogleTag",value:function(){var e=this,t=new Promise(function(t,n){1==e.wasInitialized?t():(window.googletag=window.googletag||{},window.googletag.cmd=window.googletag.cmd||[],function(){var e=this,i=document.createElement("script");i.async=!0,i.type="text/javascript",i.setAttribute("src","//www.googletagservices.com/tag/js/gpt.js");var r=document.getElementsByTagName("script")[0];r.parentNode.insertBefore(i,r),i.onload=function(){e.wasInitialized=!0,t()},i.onerror=function(t){e.wasInitialized=!0,n(t)}}())});return t}},{key:"initGoogleGlobalSettings",value:function(){googletag.pubads().enableAsyncRendering(),googletag.enableServices()}}]),e}();return y.version="0.0.2",y});